<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.24.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="æœ¬æ•™ç¨‹å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Solanaä¸Šå®ç°ETFä»£å¸çš„è´­ä¹°åŠŸèƒ½ï¼ŒåŒ…æ‹¬è´¦æˆ·éªŒè¯ã€èµ„äº§è½¬ç§»å’Œä»£å¸é“¸é€ çš„å®Œæ•´æµç¨‹">
<meta property="og:type" content="article">
<meta property="og:title" content="Solanaå®æˆ˜-ETFçš„è´­ä¹°">
<meta property="og:url" content="http://example.com/2025/09/21/Solana%E5%AE%9E%E6%88%98-ETF%E7%9A%84%E8%B4%AD%E4%B9%B0/index.html">
<meta property="og:site_name" content="samxie52">
<meta property="og:description" content="æœ¬æ•™ç¨‹å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Solanaä¸Šå®ç°ETFä»£å¸çš„è´­ä¹°åŠŸèƒ½ï¼ŒåŒ…æ‹¬è´¦æˆ·éªŒè¯ã€èµ„äº§è½¬ç§»å’Œä»£å¸é“¸é€ çš„å®Œæ•´æµç¨‹">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-09-21T07:34:11.000Z">
<meta property="article:modified_time" content="2025-09-21T10:37:35.212Z">
<meta property="article:author" content="samxie">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2025/09/21/Solana%E5%AE%9E%E6%88%98-ETF%E7%9A%84%E8%B4%AD%E4%B9%B0/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2025/09/21/Solana%E5%AE%9E%E6%88%98-ETF%E7%9A%84%E8%B4%AD%E4%B9%B0/","path":"2025/09/21/Solanaå®æˆ˜-ETFçš„è´­ä¹°/","title":"Solanaå®æˆ˜-ETFçš„è´­ä¹°"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Solanaå®æˆ˜-ETFçš„è´­ä¹° | samxie52</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">samxie52</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">æ¦‚è¿°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A41-%E5%AE%9A%E4%B9%89ETF%E4%BA%A4%E6%98%93%E8%B4%A6%E6%88%B7%E7%BB%93%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">æ­¥éª¤1: å®šä¹‰ETFäº¤æ˜“è´¦æˆ·ç»“æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-PDA%E8%B4%A6%E6%88%B7%E9%AA%8C%E8%AF%81"><span class="nav-number">2.1.</span> <span class="nav-text">1. PDAè´¦æˆ·éªŒè¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ATA%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%E6%9C%BA%E5%88%B6"><span class="nav-number">2.2.</span> <span class="nav-text">2. ATAè‡ªåŠ¨åˆ›å»ºæœºåˆ¶</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A42-%E5%AE%9E%E7%8E%B0ETF%E4%BB%A3%E5%B8%81%E9%93%B8%E9%80%A0%E9%80%BB%E8%BE%91"><span class="nav-number">3.</span> <span class="nav-text">æ­¥éª¤2: å®ç°ETFä»£å¸é“¸é€ é€»è¾‘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%9D%83%E9%87%8D%E8%AE%A1%E7%AE%97%E5%85%AC%E5%BC%8F"><span class="nav-number">3.1.</span> <span class="nav-text">1. æƒé‡è®¡ç®—å…¬å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%B4%A6%E6%88%B7%E6%9F%A5%E6%89%BE%E4%BC%98%E5%8C%96"><span class="nav-number">3.2.</span> <span class="nav-text">2. è´¦æˆ·æŸ¥æ‰¾ä¼˜åŒ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-CPI%E8%B0%83%E7%94%A8%E9%93%BE"><span class="nav-number">3.3.</span> <span class="nav-text">3. CPIè°ƒç”¨é“¾</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A43-%E6%B3%A8%E5%86%8CETF%E9%93%B8%E9%80%A0%E6%8C%87%E4%BB%A4"><span class="nav-number">4.</span> <span class="nav-text">æ­¥éª¤3: æ³¨å†ŒETFé“¸é€ æŒ‡ä»¤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A44-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B4%AD%E4%B9%B0%E5%AE%9E%E7%8E%B0"><span class="nav-number">5.</span> <span class="nav-text">æ­¥éª¤4: å®¢æˆ·ç«¯è´­ä¹°å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%B4%A6%E6%88%B7%E9%A2%84%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6"><span class="nav-number">5.1.</span> <span class="nav-text">1. è´¦æˆ·é¢„æ£€æŸ¥æœºåˆ¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%AE%A1%E7%AE%97%E5%8D%95%E5%85%83%E9%99%90%E5%88%B6"><span class="nav-number">5.2.</span> <span class="nav-text">2. è®¡ç®—å•å…ƒé™åˆ¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%89%A9%E4%BD%99%E8%B4%A6%E6%88%B7%E7%AE%A1%E7%90%86"><span class="nav-number">5.3.</span> <span class="nav-text">3. å‰©ä½™è´¦æˆ·ç®¡ç†</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A45-%E5%AE%8C%E6%95%B4%E8%B4%AD%E4%B9%B0%E6%B5%81%E7%A8%8B%E7%A4%BA%E4%BE%8B"><span class="nav-number">6.</span> <span class="nav-text">æ­¥éª¤5: å®Œæ•´è´­ä¹°æµç¨‹ç¤ºä¾‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%80%E6%9C%AF%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-number">7.</span> <span class="nav-text">æŠ€æœ¯æ·±åº¦è§£æ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%B5%84%E4%BA%A7%E8%BD%AC%E7%A7%BB%E6%9C%BA%E5%88%B6"><span class="nav-number">7.1.</span> <span class="nav-text">1. èµ„äº§è½¬ç§»æœºåˆ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-%E5%8E%9F%E5%AD%90%E6%80%A7%E4%BF%9D%E8%AF%81"><span class="nav-number">7.1.1.</span> <span class="nav-text">A. åŸå­æ€§ä¿è¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-%E6%9D%83%E9%99%90%E9%AA%8C%E8%AF%81%E9%93%BE"><span class="nav-number">7.1.2.</span> <span class="nav-text">B. æƒé™éªŒè¯é“¾</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%B4%A6%E6%88%B7%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="nav-number">7.2.</span> <span class="nav-text">2. è´¦æˆ·çŠ¶æ€ç®¡ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-ATA%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">7.2.1.</span> <span class="nav-text">A. ATAç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-%E7%A7%9F%E9%87%91%E8%80%83%E8%99%91"><span class="nav-number">7.2.2.</span> <span class="nav-text">B. ç§Ÿé‡‘è€ƒè™‘</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5"><span class="nav-number">7.3.</span> <span class="nav-text">3. é”™è¯¯å¤„ç†ç­–ç•¥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E5%9C%BA%E6%99%AF"><span class="nav-number">7.3.1.</span> <span class="nav-text">A. å¸¸è§é”™è¯¯åœºæ™¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-%E9%94%99%E8%AF%AF%E6%81%A2%E5%A4%8D%E6%9C%BA%E5%88%B6"><span class="nav-number">7.3.2.</span> <span class="nav-text">B. é”™è¯¯æ¢å¤æœºåˆ¶</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">7.4.</span> <span class="nav-text">4. æ€§èƒ½ä¼˜åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%E4%BC%98%E5%8C%96"><span class="nav-number">7.4.1.</span> <span class="nav-text">A. æ‰¹é‡æ“ä½œä¼˜åŒ–</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-%E8%AE%A1%E7%AE%97%E5%8D%95%E5%85%83%E4%BC%98%E5%8C%96"><span class="nav-number">7.4.2.</span> <span class="nav-text">B. è®¡ç®—å•å…ƒä¼˜åŒ–</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7%E8%80%83%E8%99%91"><span class="nav-number">8.</span> <span class="nav-text">å®‰å…¨æ€§è€ƒè™‘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%87%8D%E5%85%A5%E6%94%BB%E5%87%BB%E9%98%B2%E6%8A%A4"><span class="nav-number">8.1.</span> <span class="nav-text">1. é‡å…¥æ”»å‡»é˜²æŠ¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BB%B7%E6%A0%BC%E6%93%8D%E7%BA%B5%E9%98%B2%E6%8A%A4"><span class="nav-number">8.2.</span> <span class="nav-text">2. ä»·æ ¼æ“çºµé˜²æŠ¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%BB%91%E7%82%B9%E4%BF%9D%E6%8A%A4"><span class="nav-number">8.3.</span> <span class="nav-text">3. æ»‘ç‚¹ä¿æŠ¤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD%E5%BB%BA%E8%AE%AE"><span class="nav-number">9.</span> <span class="nav-text">æ‰©å±•åŠŸèƒ½å»ºè®®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%8A%A8%E6%80%81%E6%9D%83%E9%87%8D%E8%B0%83%E6%95%B4"><span class="nav-number">9.1.</span> <span class="nav-text">1. åŠ¨æ€æƒé‡è°ƒæ•´</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%83%A8%E5%88%86%E8%B5%8E%E5%9B%9E%E5%8A%9F%E8%83%BD"><span class="nav-number">9.2.</span> <span class="nav-text">2. éƒ¨åˆ†èµå›åŠŸèƒ½</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%B4%B9%E7%94%A8%E6%94%B6%E5%8F%96%E6%9C%BA%E5%88%B6"><span class="nav-number">9.3.</span> <span class="nav-text">3. è´¹ç”¨æ”¶å–æœºåˆ¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E4%BB%B7%E6%A0%BC%E9%A2%84%E8%A8%80%E6%9C%BA%E9%9B%86%E6%88%90"><span class="nav-number">9.4.</span> <span class="nav-text">4. ä»·æ ¼é¢„è¨€æœºé›†æˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%B5%81%E5%8A%A8%E6%80%A7%E6%B1%A0%E9%9B%86%E6%88%90"><span class="nav-number">9.5.</span> <span class="nav-text">5. æµåŠ¨æ€§æ± é›†æˆ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4%E6%8C%87%E5%8D%97"><span class="nav-number">10.</span> <span class="nav-text">æ•…éšœæ’é™¤æŒ‡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">10.1.</span> <span class="nav-text">1. å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-%E2%80%9CTokenAccountNotFoundError%E2%80%9D"><span class="nav-number">10.1.1.</span> <span class="nav-text">A. â€œTokenAccountNotFoundErrorâ€</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-%E2%80%9CInsufficientBalance%E2%80%9D"><span class="nav-number">10.1.2.</span> <span class="nav-text">B. â€œInsufficientBalanceâ€</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#C-%E2%80%9CInvalidAccounts%E2%80%9D"><span class="nav-number">10.1.3.</span> <span class="nav-text">C. â€œInvalidAccountsâ€</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7"><span class="nav-number">10.2.</span> <span class="nav-text">2. è°ƒè¯•æŠ€å·§</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-%E4%BA%A4%E6%98%93%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="nav-number">10.2.1.</span> <span class="nav-text">A. äº¤æ˜“æ—¥å¿—åˆ†æ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-%E8%B4%A6%E6%88%B7%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5"><span class="nav-number">10.2.2.</span> <span class="nav-text">B. è´¦æˆ·çŠ¶æ€æ£€æŸ¥</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7"><span class="nav-number">10.3.</span> <span class="nav-text">3. æ€§èƒ½ç›‘æ§</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-%E4%BA%A4%E6%98%93%E6%88%90%E6%9C%AC%E5%88%86%E6%9E%90"><span class="nav-number">10.3.1.</span> <span class="nav-text">A. äº¤æ˜“æˆæœ¬åˆ†æ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-Gas%E4%BD%BF%E7%94%A8%E4%BC%98%E5%8C%96"><span class="nav-number">10.3.2.</span> <span class="nav-text">B. Gasä½¿ç”¨ä¼˜åŒ–</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93"><span class="nav-number">11.</span> <span class="nav-text">æœ€ä½³å®è·µæ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84"><span class="nav-number">11.1.</span> <span class="nav-text">1. ä»£ç ç»“æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91"><span class="nav-number">11.2.</span> <span class="nav-text">2. å®‰å…¨è€ƒè™‘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C"><span class="nav-number">11.3.</span> <span class="nav-text">3. ç”¨æˆ·ä½“éªŒ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%89%A9%E5%B1%95%E6%80%A7"><span class="nav-number">11.4.</span> <span class="nav-text">4. æ‰©å±•æ€§</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">12.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">samxie</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">65</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/21/Solana%E5%AE%9E%E6%88%98-ETF%E7%9A%84%E8%B4%AD%E4%B9%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="samxie">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samxie52">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Solanaå®æˆ˜-ETFçš„è´­ä¹° | samxie52">
      <meta itemprop="description" content="æœ¬æ•™ç¨‹å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Solanaä¸Šå®ç°ETFä»£å¸çš„è´­ä¹°åŠŸèƒ½ï¼ŒåŒ…æ‹¬è´¦æˆ·éªŒè¯ã€èµ„äº§è½¬ç§»å’Œä»£å¸é“¸é€ çš„å®Œæ•´æµç¨‹">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Solanaå®æˆ˜-ETFçš„è´­ä¹°
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-21 15:34:11 / ä¿®æ”¹æ—¶é—´ï¼š18:37:35" itemprop="dateCreated datePublished" datetime="2025-09-21T15:34:11+08:00">2025-09-21</time>
    </span>

  
    <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

            <div class="post-description">æœ¬æ•™ç¨‹å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Solanaä¸Šå®ç°ETFä»£å¸çš„è´­ä¹°åŠŸèƒ½ï¼ŒåŒ…æ‹¬è´¦æˆ·éªŒè¯ã€èµ„äº§è½¬ç§»å’Œä»£å¸é“¸é€ çš„å®Œæ•´æµç¨‹</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>ETFè´­ä¹°çš„æ ¸å¿ƒæœºåˆ¶</strong></p>
<p>åœ¨åŒºå—é“¾ETFç³»ç»Ÿä¸­ï¼Œè´­ä¹°ETFä»£å¸çš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯ä¸€ä¸ª<strong>èµ„äº§å…‘æ¢</strong>è¿‡ç¨‹ï¼š</p>
<ol>
<li><strong>èµ„äº§æŠ•å…¥</strong>ï¼šç”¨æˆ·æŒ‰ç…§ETFçš„ç»„æˆæ¯”ä¾‹æŠ•å…¥ç›¸åº”çš„åº•å±‚ä»£å¸</li>
<li><strong>èµ„äº§æ‰˜ç®¡</strong>ï¼šåº•å±‚ä»£å¸è½¬ç§»åˆ°ETFåˆçº¦æ§åˆ¶çš„è´¦æˆ·ä¸­</li>
<li><strong>ä»£å¸é“¸é€ </strong>ï¼šæ ¹æ®æŠ•å…¥èµ„äº§çš„ä»·å€¼é“¸é€ ç›¸åº”æ•°é‡çš„ETFä»£å¸ç»™ç”¨æˆ·</li>
</ol>
<p><strong>æœ¬æ•™ç¨‹å®ç°çš„åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>éªŒè¯ç”¨æˆ·æŒæœ‰è¶³å¤Ÿçš„åº•å±‚ä»£å¸ä½™é¢</li>
<li>æŒ‰æƒé‡æ¯”ä¾‹è½¬ç§»åº•å±‚ä»£å¸åˆ°ETFåˆçº¦è´¦æˆ·</li>
<li>é“¸é€ ç›¸åº”æ•°é‡çš„ETFä»£å¸ç»™ç”¨æˆ·</li>
<li>å¤„ç†å…³è”ä»£å¸è´¦æˆ·(ATA)çš„è‡ªåŠ¨åˆ›å»º</li>
</ul>
<h2 id="æ­¥éª¤1-å®šä¹‰ETFäº¤æ˜“è´¦æˆ·ç»“æ„"><a href="#æ­¥éª¤1-å®šä¹‰ETFäº¤æ˜“è´¦æˆ·ç»“æ„" class="headerlink" title="æ­¥éª¤1: å®šä¹‰ETFäº¤æ˜“è´¦æˆ·ç»“æ„"></a>æ­¥éª¤1: å®šä¹‰ETFäº¤æ˜“è´¦æˆ·ç»“æ„</h2><p><strong>ç›®çš„</strong>ï¼šå®šä¹‰ETFè´­ä¹°äº¤æ˜“æ‰€éœ€çš„æ‰€æœ‰è´¦æˆ·ï¼Œç¡®ä¿å®‰å…¨çš„èµ„äº§è½¬ç§»å’Œä»£å¸é“¸é€ ã€‚</p>
<p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<code>../ibuidl-etf-dapp/anchor/programs/counter/src/accounts_ix/etf_token_transaction.rs</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"><span class="keyword">use</span> anchor_spl::&#123;associated_token::AssociatedToken, token::&#123;Mint, Token, TokenAccount&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::states::EtfToken;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ—ï¸ ETFäº¤æ˜“æ‰€éœ€çš„è´¦æˆ·ç»“æ„ä½“</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªç»“æ„ä½“å®šä¹‰äº†ETFè´­ä¹°æ“ä½œéœ€è¦çš„æ‰€æœ‰è´¦æˆ·</span></span><br><span class="line"><span class="meta">#[derive(Accounts)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">EtfTokenTransaction</span>&lt;<span class="symbol">&#x27;info</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// ETFä¿¡æ¯è´¦æˆ·ï¼ˆåªè¯»ï¼‰</span></span><br><span class="line">    <span class="comment">// å­˜å‚¨ETFçš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç»„æˆä»£å¸å’Œæƒé‡é…ç½®</span></span><br><span class="line">    <span class="meta">#[account(  </span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            EtfToken::SEED_PREFIX.as_bytes(),    // <span class="string">&quot;etf_token_v3&quot;</span> - å›ºå®šå‰ç¼€</span></span><br><span class="line"><span class="meta">            etf_token_mint_account.key().as_ref(), // mintè´¦æˆ·åœ°å€ä½œä¸ºç§å­</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,  <span class="comment">// è‡ªåŠ¨å¯»æ‰¾æœ‰æ•ˆçš„bumpå€¼ï¼Œç¡®ä¿PDAåœ°å€æ­£ç¡®</span></span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> etf_token_info: Account&lt;<span class="symbol">&#x27;info</span>, EtfToken&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨æˆ·çš„ETFä»£å¸å…³è”è´¦æˆ·ï¼ˆATAï¼‰</span></span><br><span class="line">    <span class="comment">// ç”¨äºæ¥æ”¶æ–°é“¸é€ çš„ETFä»£å¸</span></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        init_if_needed,                              // å¦‚æœè´¦æˆ·ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line"><span class="meta">        payer = authority,                           // åˆ›å»ºè´¹ç”¨ç”±äº¤æ˜“å‘èµ·è€…æ”¯ä»˜</span></span><br><span class="line"><span class="meta">        associated_token::mint = etf_token_mint_account,  // æŒ‡å®šå…³è”çš„mintè´¦æˆ·</span></span><br><span class="line"><span class="meta">        associated_token::authority = authority,     // è´¦æˆ·æ‰€æœ‰è€…ä¸ºäº¤æ˜“å‘èµ·è€…</span></span><br><span class="line"><span class="meta">    )]</span></span><br><span class="line">    <span class="keyword">pub</span> etf_token_ata: Account&lt;<span class="symbol">&#x27;info</span>, TokenAccount&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ETFä»£å¸çš„mintè´¦æˆ·ï¼ˆå¯å˜ï¼‰</span></span><br><span class="line">    <span class="comment">// éœ€è¦å¯å˜æƒé™ç”¨äºé“¸é€ æ–°çš„ETFä»£å¸</span></span><br><span class="line">    <span class="meta">#[account(mut)]</span></span><br><span class="line">    <span class="keyword">pub</span> etf_token_mint_account: Account&lt;<span class="symbol">&#x27;info</span>, Mint&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº¤æ˜“å‘èµ·è€…å’Œç­¾åè€…ï¼ˆå¯å˜ï¼‰</span></span><br><span class="line">    <span class="comment">// éœ€è¦å¯å˜æƒé™ç”¨äºæ”¯ä»˜äº¤æ˜“è´¹ç”¨å’Œè½¬ç§»ä»£å¸</span></span><br><span class="line">    <span class="meta">#[account(mut)]</span></span><br><span class="line">    <span class="keyword">pub</span> authority: Signer&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¿…éœ€çš„ç¨‹åºè´¦æˆ·</span></span><br><span class="line">    <span class="keyword">pub</span> token_program: Program&lt;<span class="symbol">&#x27;info</span>, Token&gt;,              <span class="comment">// SPL Tokenç¨‹åº</span></span><br><span class="line">    <span class="keyword">pub</span> associated_token_program: Program&lt;<span class="symbol">&#x27;info</span>, AssociatedToken&gt;, <span class="comment">// å…³è”ä»£å¸ç¨‹åº</span></span><br><span class="line">    <span class="keyword">pub</span> system_program: Program&lt;<span class="symbol">&#x27;info</span>, System&gt;,            <span class="comment">// ç³»ç»Ÿç¨‹åºï¼ˆç”¨äºåˆ›å»ºè´¦æˆ·ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è´¦æˆ·è®¾è®¡è¦ç‚¹è§£æ</strong>ï¼š</p>
<h3 id="1-PDAè´¦æˆ·éªŒè¯"><a href="#1-PDAè´¦æˆ·éªŒè¯" class="headerlink" title="1. PDAè´¦æˆ·éªŒè¯"></a>1. PDAè´¦æˆ·éªŒè¯</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">seeds = [</span><br><span class="line">    EtfToken::SEED_PREFIX.<span class="title function_ invoke__">as_bytes</span>(),    <span class="comment">// å›ºå®šç±»å‹æ ‡è¯†</span></span><br><span class="line">    etf_token_mint_account.<span class="title function_ invoke__">key</span>().<span class="title function_ invoke__">as_ref</span>(), <span class="comment">// åŠ¨æ€å…³è”æ ‡è¯†</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li>ç¡®ä¿ETFä¿¡æ¯è´¦æˆ·åœ°å€çš„å”¯ä¸€æ€§å’Œç¡®å®šæ€§</li>
<li>åªæœ‰çŸ¥é“æ­£ç¡®ç§å­çš„ç¨‹åºæ‰èƒ½ç”Ÿæˆæœ‰æ•ˆåœ°å€</li>
<li>é˜²æ­¢æ¶æ„è´¦æˆ·å†’å……ETFä¿¡æ¯</li>
</ul>
<h3 id="2-ATAè‡ªåŠ¨åˆ›å»ºæœºåˆ¶"><a href="#2-ATAè‡ªåŠ¨åˆ›å»ºæœºåˆ¶" class="headerlink" title="2. ATAè‡ªåŠ¨åˆ›å»ºæœºåˆ¶"></a>2. ATAè‡ªåŠ¨åˆ›å»ºæœºåˆ¶</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">init_if_needed,                          <span class="comment">// æ™ºèƒ½åˆ›å»ºç­–ç•¥</span></span><br><span class="line">payer = authority,                       <span class="comment">// æ˜ç¡®è´¹ç”¨æ‰¿æ‹…è€…</span></span><br></pre></td></tr></table></figure>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·æ— éœ€é¢„å…ˆåˆ›å»ºä»£å¸è´¦æˆ·</li>
<li>ç®€åŒ–ç”¨æˆ·æ“ä½œæµç¨‹</li>
<li>è‡ªåŠ¨å¤„ç†è´¦æˆ·ç§Ÿé‡‘</li>
</ul>
<h2 id="æ­¥éª¤2-å®ç°ETFä»£å¸é“¸é€ é€»è¾‘"><a href="#æ­¥éª¤2-å®ç°ETFä»£å¸é“¸é€ é€»è¾‘" class="headerlink" title="æ­¥éª¤2: å®ç°ETFä»£å¸é“¸é€ é€»è¾‘"></a>æ­¥éª¤2: å®ç°ETFä»£å¸é“¸é€ é€»è¾‘</h2><p><strong>ç›®çš„</strong>ï¼šå®ç°å®Œæ•´çš„ETFè´­ä¹°æµç¨‹ï¼ŒåŒ…æ‹¬åº•å±‚èµ„äº§éªŒè¯ã€è½¬ç§»å’ŒETFä»£å¸é“¸é€ ã€‚</p>
<p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<code>../ibuidl-etf-dapp/anchor/programs/counter/src/instructions/etf_token_mint.rs</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"><span class="keyword">use</span> anchor_spl::&#123;</span><br><span class="line">    associated_token::get_associated_token_address,</span><br><span class="line">    token::&#123;mint_to, transfer, MintTo, Transfer&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::states::EtfToken;</span><br><span class="line"><span class="keyword">use</span> crate::&#123;accounts_ix::EtfTokenTransaction, states::TokenMintError&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸš€ ETFä»£å¸é“¸é€ çš„æ ¸å¿ƒå®ç°å‡½æ•°</span></span><br><span class="line"><span class="comment">// è¿™æ˜¯ETFè´­ä¹°åŠŸèƒ½çš„ä¸»è¦ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">etf_token_mint</span>&lt;<span class="symbol">&#x27;info</span>&gt;(</span><br><span class="line">    ctx: Context&lt;<span class="symbol">&#x27;_</span>, <span class="symbol">&#x27;_</span>, <span class="symbol">&#x27;_</span>, <span class="symbol">&#x27;info</span>, EtfTokenTransaction&lt;<span class="symbol">&#x27;info</span>&gt;&gt;,</span><br><span class="line">    lamports: <span class="type">u64</span>,  <span class="comment">// ç”¨æˆ·æƒ³è¦è´­ä¹°çš„ETFä»£å¸æ•°é‡ï¼ˆä»¥æœ€å°å•ä½è®¡ç®—ï¼‰</span></span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// ğŸ“‹ æ„å»ºå‰©ä½™è´¦æˆ·çš„å¿«é€ŸæŸ¥æ‰¾æ˜ å°„è¡¨</span></span><br><span class="line">    <span class="comment">// remaining_accountsåŒ…å«æ‰€æœ‰åº•å±‚ä»£å¸çš„ç”¨æˆ·è´¦æˆ·å’ŒETFæ‰˜ç®¡è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">accounts</span> = ctx</span><br><span class="line">        .remaining_accounts</span><br><span class="line">        .<span class="title function_ invoke__">iter</span>()</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|x| (x.<span class="title function_ invoke__">key</span>(), x.<span class="title function_ invoke__">to_owned</span>()))    <span class="comment">// å°†è´¦æˆ·åœ°å€ä½œä¸ºkeyï¼Œè´¦æˆ·ä¿¡æ¯ä½œä¸ºvalue</span></span><br><span class="line">        .collect::&lt;HashMap&lt;_, _&gt;&gt;();        <span class="comment">// åˆ›å»ºHashMapç”¨äºO(1)æ—¶é—´å¤æ‚åº¦çš„æŸ¥æ‰¾</span></span><br><span class="line"></span><br><span class="line">    msg!(<span class="string">&quot;ğŸ“Š Processing accounts: &#123;:?&#125;&quot;</span>, accounts);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ”„ éå†ETFçš„æ¯ä¸ªç»„æˆä»£å¸ï¼Œæ‰§è¡Œèµ„äº§è½¬ç§»</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">x</span> <span class="keyword">in</span> &amp;ctx.accounts.etf_token_info.constituent &#123;</span><br><span class="line">        <span class="comment">// ğŸ’° è®¡ç®—ç”¨æˆ·éœ€è¦è½¬ç§»çš„åº•å±‚ä»£å¸æ•°é‡</span></span><br><span class="line">        <span class="comment">// å…¬å¼: (æƒé‡ / 100) * è´­ä¹°æ•°é‡</span></span><br><span class="line">        <span class="comment">// æ³¨æ„: è¿™é‡Œå‡è®¾æƒé‡ä»¥ç™¾åˆ†æ¯”å½¢å¼å­˜å‚¨(å¦‚æƒé‡20è¡¨ç¤º20%)</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">amounts</span> = x.weight <span class="keyword">as</span> <span class="type">u64</span> * lamports / <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ğŸ” è·å–ç”¨æˆ·çš„åº•å±‚ä»£å¸å…³è”è´¦æˆ·åœ°å€</span></span><br><span class="line">        <span class="comment">// è¿™æ˜¯ç”¨æˆ·æŒæœ‰è¯¥åº•å±‚ä»£å¸çš„è´¦æˆ·</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">user_token_ata</span> = <span class="title function_ invoke__">get_associated_token_address</span>(</span><br><span class="line">            &amp;ctx.accounts.authority.<span class="title function_ invoke__">key</span>(),  <span class="comment">// ç”¨æˆ·åœ°å€</span></span><br><span class="line">            &amp;x.token,                       <span class="comment">// åº•å±‚ä»£å¸mintåœ°å€</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ğŸ” è·å–ETFåˆçº¦çš„åº•å±‚ä»£å¸å…³è”è´¦æˆ·åœ°å€  </span></span><br><span class="line">        <span class="comment">// è¿™æ˜¯ETFåˆçº¦æ‰˜ç®¡è¯¥åº•å±‚ä»£å¸çš„è´¦æˆ·</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">etf_token_ata</span> = <span class="title function_ invoke__">get_associated_token_address</span>(</span><br><span class="line">            &amp;ctx.accounts.etf_token_info.<span class="title function_ invoke__">key</span>(),  <span class="comment">// ETFä¿¡æ¯è´¦æˆ·åœ°å€ï¼ˆä½œä¸ºæ‰˜ç®¡æ–¹ï¼‰</span></span><br><span class="line">            &amp;x.token,                            <span class="comment">// åº•å±‚ä»£å¸mintåœ°å€</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ğŸ“¦ ä»æ˜ å°„è¡¨ä¸­è·å–ç”¨æˆ·çš„åº•å±‚ä»£å¸è´¦æˆ·</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">from_ata</span> = accounts</span><br><span class="line">            .<span class="title function_ invoke__">get</span>(&amp;user_token_ata)</span><br><span class="line">            .<span class="title function_ invoke__">ok_or</span>(TokenMintError::InvalidAccounts)?;  <span class="comment">// å¦‚æœæ‰¾ä¸åˆ°è´¦æˆ·ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ğŸ“¦ ä»æ˜ å°„è¡¨ä¸­è·å–ETFçš„åº•å±‚ä»£å¸æ‰˜ç®¡è´¦æˆ·</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">to_ata</span> = accounts</span><br><span class="line">            .<span class="title function_ invoke__">get</span>(&amp;etf_token_ata)</span><br><span class="line">            .<span class="title function_ invoke__">ok_or</span>(TokenMintError::InvalidAccounts)?;  <span class="comment">// å¦‚æœæ‰¾ä¸åˆ°è´¦æˆ·ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ğŸ’¸ æ‰§è¡Œåº•å±‚ä»£å¸è½¬ç§»æ“ä½œ</span></span><br><span class="line">        <span class="comment">// ä»ç”¨æˆ·è´¦æˆ·è½¬ç§»åˆ°ETFæ‰˜ç®¡è´¦æˆ·</span></span><br><span class="line">        <span class="title function_ invoke__">transfer</span>(</span><br><span class="line">            CpiContext::<span class="title function_ invoke__">new</span>(</span><br><span class="line">                ctx.accounts.token_program.<span class="title function_ invoke__">to_account_info</span>(),  <span class="comment">// SPL Tokenç¨‹åº</span></span><br><span class="line">                Transfer &#123;</span><br><span class="line">                    from: from_ata.<span class="title function_ invoke__">to_account_info</span>(),          <span class="comment">// è½¬å‡ºè´¦æˆ·ï¼ˆç”¨æˆ·ï¼‰</span></span><br><span class="line">                    to: to_ata.<span class="title function_ invoke__">to_account_info</span>(),              <span class="comment">// è½¬å…¥è´¦æˆ·ï¼ˆETFæ‰˜ç®¡ï¼‰</span></span><br><span class="line">                    authority: ctx.accounts.authority.<span class="title function_ invoke__">to_account_info</span>(), <span class="comment">// è½¬ç§»æˆæƒè€…ï¼ˆç”¨æˆ·ï¼‰</span></span><br><span class="line">                &#125;,</span><br><span class="line">            ),</span><br><span class="line">            amounts,  <span class="comment">// è½¬ç§»æ•°é‡</span></span><br><span class="line">        )?;</span><br><span class="line"></span><br><span class="line">        msg!(<span class="string">&quot;âœ… Successfully transferred &#123;&#125; units of token: &#123;&#125;&quot;</span>, amounts, x.token);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ” å‡†å¤‡ETF mintæƒé™çš„PDAç­¾å</span></span><br><span class="line">    <span class="comment">// åªæœ‰ETFä¿¡æ¯è´¦æˆ·ï¼ˆPDAï¼‰æœ‰æƒé™é“¸é€ ETFä»£å¸</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">m</span> = ctx.accounts.etf_token_mint_account.<span class="title function_ invoke__">key</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">signer_seeds</span>: &amp;[&amp;[&amp;[<span class="type">u8</span>]]] = &amp;[&amp;[</span><br><span class="line">        EtfToken::SEED_PREFIX.<span class="title function_ invoke__">as_bytes</span>(),    <span class="comment">// &quot;etf_token_v3&quot;</span></span><br><span class="line">        m.<span class="title function_ invoke__">as_ref</span>(),                          <span class="comment">// mintè´¦æˆ·åœ°å€</span></span><br><span class="line">        &amp;[ctx.bumps.etf_token_info],        <span class="comment">// bumpå€¼ï¼Œç¡®ä¿PDAç­¾åæœ‰æ•ˆ</span></span><br><span class="line">    ]];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸª™ é“¸é€ ETFä»£å¸ç»™ç”¨æˆ·</span></span><br><span class="line">    <span class="comment">// æ ¹æ®ç”¨æˆ·æŠ•å…¥çš„èµ„äº§ä»·å€¼é“¸é€ ç›¸åº”æ•°é‡çš„ETFä»£å¸</span></span><br><span class="line">    <span class="title function_ invoke__">mint_to</span>(</span><br><span class="line">        CpiContext::<span class="title function_ invoke__">new_with_signer</span>(</span><br><span class="line">            ctx.accounts.token_program.<span class="title function_ invoke__">to_account_info</span>(),   <span class="comment">// SPL Tokenç¨‹åº</span></span><br><span class="line">            MintTo &#123;</span><br><span class="line">                mint: ctx.accounts.etf_token_mint_account.<span class="title function_ invoke__">to_account_info</span>(),  <span class="comment">// ETFä»£å¸mint</span></span><br><span class="line">                to: ctx.accounts.etf_token_ata.<span class="title function_ invoke__">to_account_info</span>(),            <span class="comment">// ç”¨æˆ·çš„ETFä»£å¸è´¦æˆ·</span></span><br><span class="line">                authority: ctx.accounts.etf_token_info.<span class="title function_ invoke__">to_account_info</span>(),    <span class="comment">// mintæƒé™ï¼ˆPDAï¼‰</span></span><br><span class="line">            &#125;, </span><br><span class="line">            signer_seeds  <span class="comment">// PDAç­¾åï¼Œè¯æ˜æœ‰æƒé™è¿›è¡Œmintæ“ä½œ</span></span><br><span class="line">        ), </span><br><span class="line">        lamports  <span class="comment">// é“¸é€ çš„ETFä»£å¸æ•°é‡</span></span><br><span class="line">    )?;</span><br><span class="line"></span><br><span class="line">    msg!(<span class="string">&quot;ğŸ‰ Successfully minted &#123;&#125; ETF tokens to &#123;&#125;&quot;</span>, lamports, ctx.accounts.etf_token_ata.<span class="title function_ invoke__">key</span>());</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ ¸å¿ƒç®—æ³•è§£æ</strong>ï¼š</p>
<h3 id="1-æƒé‡è®¡ç®—å…¬å¼"><a href="#1-æƒé‡è®¡ç®—å…¬å¼" class="headerlink" title="1. æƒé‡è®¡ç®—å…¬å¼"></a>1. æƒé‡è®¡ç®—å…¬å¼</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">amounts</span> = x.weight <span class="keyword">as</span> <span class="type">u64</span> * lamports / <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<p><strong>å®é™…ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å‡è®¾ç”¨æˆ·è¦è´­ä¹°1000ä¸ªETFä»£å¸ï¼ŒæŸåº•å±‚ä»£å¸æƒé‡ä¸º30%:</span><br><span class="line">è®¡ç®—: 30 * 1000 / 100 = 300ä¸ªåº•å±‚ä»£å¸</span><br><span class="line"></span><br><span class="line">æƒé‡é…ç½®ç¤ºä¾‹:</span><br><span class="line">- SOL: 40% â†’ éœ€è¦ 400ä¸ªSOL</span><br><span class="line">- USDC: 30% â†’ éœ€è¦ 300ä¸ªUSDC  </span><br><span class="line">- BTC: 20% â†’ éœ€è¦ 200ä¸ªBTC</span><br><span class="line">- ETH: 10% â†’ éœ€è¦ 100ä¸ªETH</span><br></pre></td></tr></table></figure>

<h3 id="2-è´¦æˆ·æŸ¥æ‰¾ä¼˜åŒ–"><a href="#2-è´¦æˆ·æŸ¥æ‰¾ä¼˜åŒ–" class="headerlink" title="2. è´¦æˆ·æŸ¥æ‰¾ä¼˜åŒ–"></a>2. è´¦æˆ·æŸ¥æ‰¾ä¼˜åŒ–</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">accounts</span> = ctx.remaining_accounts</span><br><span class="line">    .<span class="title function_ invoke__">iter</span>()</span><br><span class="line">    .<span class="title function_ invoke__">map</span>(|x| (x.<span class="title function_ invoke__">key</span>(), x.<span class="title function_ invoke__">to_owned</span>()))</span><br><span class="line">    .collect::&lt;HashMap&lt;_, _&gt;&gt;();</span><br></pre></td></tr></table></figure>

<p><strong>æ€§èƒ½ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>O(1)æŸ¥æ‰¾æ—¶é—´</strong>ï¼šHashMapæä¾›å¸¸æ•°æ—¶é—´å¤æ‚åº¦æŸ¥æ‰¾</li>
<li><strong>å†…å­˜æ•ˆç‡</strong>ï¼šé¿å…é‡å¤éå†è´¦æˆ·åˆ—è¡¨</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šç¼–è¯‘æ—¶ç¡®ä¿è´¦æˆ·ç±»å‹æ­£ç¡®</li>
</ul>
<h3 id="3-CPIè°ƒç”¨é“¾"><a href="#3-CPIè°ƒç”¨é“¾" class="headerlink" title="3. CPIè°ƒç”¨é“¾"></a>3. CPIè°ƒç”¨é“¾</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·è°ƒç”¨ â†’ ETFç¨‹åº â†’ SPL Tokenç¨‹åº</span><br><span class="line">         â†“</span><br><span class="line">    1. transfer() - è½¬ç§»åº•å±‚ä»£å¸</span><br><span class="line">    2. mint_to() - é“¸é€ ETFä»£å¸</span><br></pre></td></tr></table></figure>

<p><strong>å®‰å…¨æ€§ä¿éšœ</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªCPIè°ƒç”¨éƒ½éœ€è¦æ­£ç¡®çš„æƒé™éªŒè¯</li>
<li>PDAç­¾åç¡®ä¿åªæœ‰ç¨‹åºèƒ½æ‰§è¡Œå…³é”®æ“ä½œ</li>
<li>åŸå­æ€§ï¼šè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥</li>
</ul>
<h2 id="æ­¥éª¤3-æ³¨å†ŒETFé“¸é€ æŒ‡ä»¤"><a href="#æ­¥éª¤3-æ³¨å†ŒETFé“¸é€ æŒ‡ä»¤" class="headerlink" title="æ­¥éª¤3: æ³¨å†ŒETFé“¸é€ æŒ‡ä»¤"></a>æ­¥éª¤3: æ³¨å†ŒETFé“¸é€ æŒ‡ä»¤</h2><p><strong>ç›®çš„</strong>ï¼šåœ¨ä¸»ç¨‹åºä¸­æš´éœ²ETFè´­ä¹°åŠŸèƒ½çš„å…¬å…±æ¥å£ã€‚</p>
<p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<code>../ibuidl-etf-dapp/anchor/programs/counter/src/lib.rs</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ğŸŒ ETFä»£å¸é“¸é€ çš„å…¬å…±æ¥å£</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªå‡½æ•°æš´éœ²ç»™å®¢æˆ·ç«¯ï¼Œç”¨äºè´­ä¹°ETFä»£å¸</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">etf_token_mint</span>&lt;<span class="symbol">&#x27;info</span>&gt;(</span><br><span class="line">    ctx: Context&lt;<span class="symbol">&#x27;_</span>, <span class="symbol">&#x27;_</span>, <span class="symbol">&#x27;_</span>,<span class="symbol">&#x27;info</span>, EtfTokenTransaction&lt;<span class="symbol">&#x27;info</span>&gt;&gt;,</span><br><span class="line">    lamports: <span class="type">u64</span>,  <span class="comment">// è´­ä¹°æ•°é‡å‚æ•°</span></span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨å…·ä½“çš„ä¸šåŠ¡é€»è¾‘å®ç°</span></span><br><span class="line">    <span class="comment">// ä¿æŒæ¥å£ç®€æ´ï¼Œå°†å¤æ‚é€»è¾‘å°è£…åœ¨ç‹¬ç«‹æ¨¡å—ä¸­</span></span><br><span class="line">    instructions::<span class="title function_ invoke__">etf_token_mint</span>(ctx, lamports)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ¥å£è®¾è®¡åŸåˆ™</strong>ï¼š</p>
<ul>
<li><strong>ç®€æ´æ€§</strong>ï¼šå…¬å…±æ¥å£ä¿æŒæœ€å°åŒ–</li>
<li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šä¸šåŠ¡é€»è¾‘ä¸æ¥å£åˆ†ç¦»</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šä¾¿äºæ·»åŠ ä¸­é—´ä»¶å’ŒéªŒè¯é€»è¾‘</li>
</ul>
<h2 id="æ­¥éª¤4-å®¢æˆ·ç«¯è´­ä¹°å®ç°"><a href="#æ­¥éª¤4-å®¢æˆ·ç«¯è´­ä¹°å®ç°" class="headerlink" title="æ­¥éª¤4: å®¢æˆ·ç«¯è´­ä¹°å®ç°"></a>æ­¥éª¤4: å®¢æˆ·ç«¯è´­ä¹°å®ç°</h2><p><strong>ç›®çš„</strong>ï¼šæä¾›å®Œæ•´çš„å®¢æˆ·ç«¯è°ƒç”¨ç¤ºä¾‹ï¼Œå¤„ç†è´¦æˆ·åˆ›å»ºå’Œäº¤æ˜“å‘é€ã€‚</p>
<p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<code>../ibuidl-etf-dapp/anchor/example/api/etf_token.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; program, provider &#125; <span class="keyword">from</span> <span class="string">&quot;./const&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">BN</span> &#125; <span class="keyword">from</span> <span class="string">&quot;bn.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PublicKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@solana/web3.js&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  createAssociatedTokenAccountInstruction,</span><br><span class="line">  getAccount,</span><br><span class="line">  getAssociatedTokenAddressSync,</span><br><span class="line">  getMint,</span><br><span class="line">  <span class="title class_">TokenAccountNotFoundError</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@solana/spl-token&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; deriveEtfTokenMintAccount, deriveEtfokenInfoAccount &#125; <span class="keyword">from</span> <span class="string">&quot;./address&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ›’ ETFä»£å¸è´­ä¹°çš„å®Œæ•´å®¢æˆ·ç«¯å®ç°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">etfTokenMint</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">wallet</span>: anchor.<span class="title class_">Wallet</span>,      <span class="comment">// ç”¨æˆ·é’±åŒ…</span></span></span><br><span class="line"><span class="params">    <span class="attr">etfAddress</span>: <span class="title class_">PublicKey</span>,      <span class="comment">// ETFä»£å¸çš„mintåœ°å€</span></span></span><br><span class="line"><span class="params">    <span class="attr">lamports</span>: <span class="built_in">number</span>,           <span class="comment">// è´­ä¹°æ•°é‡ï¼ˆæœ€å°å•ä½ï¼‰</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ğŸ“ æ´¾ç”ŸETFä¿¡æ¯è´¦æˆ·åœ°å€</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç¡®å®šæ€§ç®—æ³•ç”ŸæˆETFé…ç½®ä¿¡æ¯çš„å­˜å‚¨åœ°å€</span></span><br><span class="line">    <span class="keyword">const</span> [etfCoreAddress] = <span class="title function_">deriveEtfokenInfoAccount</span>(etfAddress);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ“– è·å–ETFé…ç½®ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">// ä»é“¾ä¸Šè¯»å–ETFçš„ç»„æˆä»£å¸å’Œæƒé‡é…ç½®</span></span><br><span class="line">    <span class="keyword">const</span> etfInfo = <span class="keyword">await</span> program.<span class="property">account</span>.<span class="property">etfToken</span>.<span class="title function_">fetch</span>(etfCoreAddress);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ğŸ“Š ETF Configuration:&quot;</span>, etfInfo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ—ï¸ å‡†å¤‡è´¦æˆ·åˆ›å»ºäº¤æ˜“</span></span><br><span class="line">    <span class="comment">// ç”¨äºåˆ›å»ºç¼ºå¤±çš„å…³è”ä»£å¸è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">const</span> setupTx = <span class="keyword">new</span> anchor.<span class="property">web3</span>.<span class="title class_">Transaction</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ“ æ„å»ºå‰©ä½™è´¦æˆ·åˆ—è¡¨</span></span><br><span class="line">    <span class="comment">// åŒ…å«æ‰€æœ‰åº•å±‚ä»£å¸çš„ç”¨æˆ·è´¦æˆ·å’ŒETFæ‰˜ç®¡è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">const</span> remainingAccounts = etfInfo.<span class="property">constituent</span>.<span class="title function_">flatMap</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="comment">// ç”¨æˆ·çš„åº•å±‚ä»£å¸è´¦æˆ·åœ°å€</span></span><br><span class="line">            <span class="title function_">getAssociatedTokenAddressSync</span>(item.<span class="property">token</span>, wallet.<span class="property">publicKey</span>),</span><br><span class="line">            <span class="comment">// ETFåˆçº¦çš„åº•å±‚ä»£å¸æ‰˜ç®¡è´¦æˆ·åœ°å€ï¼ˆallowOwnerOffCurve=trueï¼‰</span></span><br><span class="line">            <span class="title function_">getAssociatedTokenAddressSync</span>(item.<span class="property">token</span>, etfCoreAddress, <span class="literal">true</span>),</span><br><span class="line">        ]</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ” ç¡®ä¿æ‰€æœ‰å¿…è¦çš„å…³è”ä»£å¸è´¦æˆ·éƒ½å­˜åœ¨</span></span><br><span class="line">    <span class="comment">// éå†æ¯ä¸ªåº•å±‚ä»£å¸ï¼Œæ£€æŸ¥å¹¶åˆ›å»ºETFæ‰˜ç®¡è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> &#123;token&#125; <span class="keyword">of</span> etfInfo.<span class="property">constituent</span>) &#123;</span><br><span class="line">        <span class="comment">// è®¡ç®—ETFæ‰˜ç®¡è´¦æˆ·åœ°å€</span></span><br><span class="line">        <span class="keyword">const</span> etfAta = <span class="title function_">getAssociatedTokenAddressSync</span>(token, etfCoreAddress, <span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å°è¯•è·å–è´¦æˆ·ä¿¡æ¯ï¼ŒéªŒè¯è´¦æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">getAccount</span>(provider.<span class="property">connection</span>, etfAta);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`âœ… Found ETF associated token account: <span class="subst">$&#123;etfAta&#125;</span>`</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœè´¦æˆ·ä¸å­˜åœ¨ï¼Œåˆ›å»ºè´¦æˆ·åˆ›å»ºæŒ‡ä»¤</span></span><br><span class="line">            <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="title class_">TokenAccountNotFoundError</span>) &#123;</span><br><span class="line">                setupTx.<span class="title function_">add</span>(</span><br><span class="line">                    <span class="title function_">createAssociatedTokenAccountInstruction</span>(</span><br><span class="line">                        wallet.<span class="property">payer</span>.<span class="property">publicKey</span>,  <span class="comment">// è´¹ç”¨æ”¯ä»˜è€…</span></span><br><span class="line">                        etfAta,                  <span class="comment">// è¦åˆ›å»ºçš„è´¦æˆ·åœ°å€</span></span><br><span class="line">                        etfCoreAddress,          <span class="comment">// è´¦æˆ·æ‰€æœ‰è€…ï¼ˆETFåˆçº¦ï¼‰</span></span><br><span class="line">                        token,                   <span class="comment">// ä»£å¸mintåœ°å€</span></span><br><span class="line">                    )</span><br><span class="line">                );</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸ—ï¸ Will create ETF associated token account: <span class="subst">$&#123;etfAta&#125;</span>`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ğŸ“‹ Remaining accounts:&quot;</span>, remainingAccounts);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ› ï¸ æ„å»ºETFè´­ä¹°æŒ‡ä»¤</span></span><br><span class="line">    <span class="keyword">const</span> ix = <span class="keyword">await</span> program.<span class="property">methods</span></span><br><span class="line">        .<span class="title function_">etfTokenMint</span>(<span class="keyword">new</span> <span class="title function_">BN</span>(lamports))           <span class="comment">// è´­ä¹°æ•°é‡</span></span><br><span class="line">        .<span class="title function_">accounts</span>(&#123;</span><br><span class="line">            <span class="attr">etfTokenMintAccount</span>: etfAddress,      <span class="comment">// ETFä»£å¸mintåœ°å€</span></span><br><span class="line">            <span class="attr">authority</span>: wallet.<span class="property">publicKey</span>,          <span class="comment">// äº¤æ˜“å‘èµ·è€…</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">remainingAccounts</span>(</span><br><span class="line">            <span class="comment">// æ·»åŠ æ‰€æœ‰åº•å±‚ä»£å¸ç›¸å…³è´¦æˆ·</span></span><br><span class="line">            remainingAccounts.<span class="title function_">map</span>(<span class="function">(<span class="params">address</span>) =&gt;</span> (&#123; </span><br><span class="line">                <span class="attr">pubkey</span>: address, </span><br><span class="line">                <span class="attr">isWritable</span>: <span class="literal">true</span>,    <span class="comment">// éœ€è¦å†™å…¥æƒé™ï¼ˆè½¬ç§»ä»£å¸ï¼‰</span></span><br><span class="line">                <span class="attr">isSigner</span>: <span class="literal">false</span>      <span class="comment">// ä¸éœ€è¦ç­¾å</span></span><br><span class="line">            &#125;)),</span><br><span class="line">        )</span><br><span class="line">        .<span class="title function_">transaction</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ”§ å¦‚æœéœ€è¦åˆ›å»ºå…³è”ä»£å¸è´¦æˆ·ï¼Œå…ˆæ‰§è¡Œè®¾ç½®äº¤æ˜“</span></span><br><span class="line">    <span class="keyword">if</span> (setupTx.<span class="property">instructions</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ğŸš€ Sending setup transaction to create associated token accounts...&quot;</span>);</span><br><span class="line">        <span class="keyword">await</span> anchor.<span class="property">web3</span>.<span class="title function_">sendAndConfirmTransaction</span>(</span><br><span class="line">            provider.<span class="property">connection</span>,</span><br><span class="line">            setupTx,</span><br><span class="line">            [wallet.<span class="property">payer</span>]  <span class="comment">// ç­¾åè€…</span></span><br><span class="line">        );</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;âœ… Setup transaction completed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âš¡ è®¾ç½®è®¡ç®—å•å…ƒé™åˆ¶</span></span><br><span class="line">    <span class="comment">// ETFè´­ä¹°æ¶‰åŠå¤šä¸ªä»£å¸è½¬ç§»ï¼Œéœ€è¦æ›´å¤šè®¡ç®—èµ„æº</span></span><br><span class="line">    <span class="keyword">const</span> modifyComputeUnits = anchor.<span class="property">web3</span>.<span class="property">ComputeBudgetProgram</span>.<span class="title function_">setComputeUnitLimit</span>(&#123;</span><br><span class="line">        <span class="attr">units</span>: <span class="number">400_000</span>,  <span class="comment">// 40ä¸‡è®¡ç®—å•å…ƒï¼Œè¶³å¤Ÿå¤„ç†å¤æ‚çš„å¤šä»£å¸æ“ä½œ</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ“¦ æ„å»ºå¹¶å‘é€æœ€ç»ˆäº¤æ˜“</span></span><br><span class="line">    <span class="keyword">const</span> tx = <span class="keyword">new</span> anchor.<span class="property">web3</span>.<span class="title class_">Transaction</span>().<span class="title function_">add</span>(ix).<span class="title function_">add</span>(modifyComputeUnits);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> anchor.<span class="property">web3</span>.<span class="title function_">sendAndConfirmTransaction</span>(</span><br><span class="line">        provider.<span class="property">connection</span>,</span><br><span class="line">        tx,</span><br><span class="line">        [wallet.<span class="property">payer</span>]  <span class="comment">// äº¤æ˜“ç­¾åè€…</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å®¢æˆ·ç«¯å®ç°è¦ç‚¹</strong>ï¼š</p>
<h3 id="1-è´¦æˆ·é¢„æ£€æŸ¥æœºåˆ¶"><a href="#1-è´¦æˆ·é¢„æ£€æŸ¥æœºåˆ¶" class="headerlink" title="1. è´¦æˆ·é¢„æ£€æŸ¥æœºåˆ¶"></a>1. è´¦æˆ·é¢„æ£€æŸ¥æœºåˆ¶</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">getAccount</span>(provider.<span class="property">connection</span>, etfAta);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Found account: <span class="subst">$&#123;etfAta&#125;</span>`</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="title class_">TokenAccountNotFoundError</span>) &#123;</span><br><span class="line">        <span class="comment">// è‡ªåŠ¨åˆ›å»ºç¼ºå¤±è´¦æˆ·</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>ç”¨æˆ·ä½“éªŒä¼˜åŒ–</strong>ï¼šè‡ªåŠ¨å¤„ç†è´¦æˆ·åˆ›å»º</li>
<li><strong>äº¤æ˜“æˆåŠŸç‡æå‡</strong>ï¼šé¿å…å› ç¼ºå°‘è´¦æˆ·å¯¼è‡´å¤±è´¥</li>
<li><strong>Gasè´¹ä¼˜åŒ–</strong>ï¼šåªåˆ›å»ºå¿…è¦çš„è´¦æˆ·</li>
</ul>
<h3 id="2-è®¡ç®—å•å…ƒé™åˆ¶"><a href="#2-è®¡ç®—å•å…ƒé™åˆ¶" class="headerlink" title="2. è®¡ç®—å•å…ƒé™åˆ¶"></a>2. è®¡ç®—å•å…ƒé™åˆ¶</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> modifyComputeUnits = anchor.<span class="property">web3</span>.<span class="property">ComputeBudgetProgram</span>.<span class="title function_">setComputeUnitLimit</span>(&#123;</span><br><span class="line">    <span class="attr">units</span>: <span class="number">400_000</span>,  <span class="comment">// æ ¹æ®ETFå¤æ‚åº¦è°ƒæ•´</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆéœ€è¦</strong>ï¼š</p>
<ul>
<li>ETFè´­ä¹°æ¶‰åŠå¤šä¸ªåº•å±‚ä»£å¸æ“ä½œ</li>
<li>æ¯ä¸ªä»£å¸è½¬ç§»éƒ½éœ€è¦æ¶ˆè€—è®¡ç®—å•å…ƒ</li>
<li>é»˜è®¤é™åˆ¶å¯èƒ½ä¸è¶³ä»¥å®Œæˆå¤æ‚äº¤æ˜“</li>
</ul>
<h3 id="3-å‰©ä½™è´¦æˆ·ç®¡ç†"><a href="#3-å‰©ä½™è´¦æˆ·ç®¡ç†" class="headerlink" title="3. å‰©ä½™è´¦æˆ·ç®¡ç†"></a>3. å‰©ä½™è´¦æˆ·ç®¡ç†</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> remainingAccounts = etfInfo.<span class="property">constituent</span>.<span class="title function_">flatMap</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="title function_">getAssociatedTokenAddressSync</span>(item.<span class="property">token</span>, wallet.<span class="property">publicKey</span>),</span><br><span class="line">        <span class="title function_">getAssociatedTokenAddressSync</span>(item.<span class="property">token</span>, etfCoreAddress, <span class="literal">true</span>),</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>è®¾è®¡è€ƒè™‘</strong>ï¼š</p>
<ul>
<li><strong>åŠ¨æ€è´¦æˆ·åˆ—è¡¨</strong>ï¼šæ ¹æ®ETFé…ç½®åŠ¨æ€ç”Ÿæˆ</li>
<li><strong>æˆå¯¹ç»„ç»‡</strong>ï¼šç”¨æˆ·è´¦æˆ·å’Œæ‰˜ç®¡è´¦æˆ·æˆå¯¹å‡ºç°</li>
<li><strong>æƒé™æ ‡è®°</strong>ï¼šæ­£ç¡®è®¾ç½®å¯å†™å’Œç­¾åæƒé™</li>
</ul>
<h2 id="æ­¥éª¤5-å®Œæ•´è´­ä¹°æµç¨‹ç¤ºä¾‹"><a href="#æ­¥éª¤5-å®Œæ•´è´­ä¹°æµç¨‹ç¤ºä¾‹" class="headerlink" title="æ­¥éª¤5: å®Œæ•´è´­ä¹°æµç¨‹ç¤ºä¾‹"></a>æ­¥éª¤5: å®Œæ•´è´­ä¹°æµç¨‹ç¤ºä¾‹</h2><p><strong>ç›®çš„</strong>ï¼šå±•ç¤ºä»ETFåˆ›å»ºåˆ°è´­ä¹°çš„å®Œæ•´ä½¿ç”¨æµç¨‹ã€‚</p>
<p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<code>../ibuidl-etf-dapp/anchor/example/index.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; deriveEtfTokenMintAccount &#125; <span class="keyword">from</span> <span class="string">&quot;./api/address&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useDefaultWallet, useVisitorWallet &#125; <span class="keyword">from</span> <span class="string">&quot;./api/const&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createTokenMintAccount, etfTokenMint &#125; <span class="keyword">from</span> <span class="string">&quot;./api/etf_token&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ğŸ”‘ åˆå§‹åŒ–é’±åŒ…</span></span><br><span class="line">    <span class="keyword">const</span> defaultWallet = <span class="title function_">useDefaultWallet</span>();  <span class="comment">// ETFåˆ›å»ºè€…é’±åŒ…</span></span><br><span class="line">    <span class="keyword">const</span> visitorWallet = <span class="title function_">useVisitorWallet</span>();  <span class="comment">// ETFè´­ä¹°è€…é’±åŒ…</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ“‹ å®šä¹‰ETFå‚æ•°</span></span><br><span class="line">    <span class="keyword">const</span> [name, <span class="built_in">symbol</span>, description, url] = [</span><br><span class="line">        <span class="string">&quot;yama4&quot;</span>,                    <span class="comment">// ETFåç§°</span></span><br><span class="line">        <span class="string">&quot;YAMA4&quot;</span>,                   <span class="comment">// ETFç¬¦å·  </span></span><br><span class="line">        <span class="string">&quot;yama4 description&quot;</span>,       <span class="comment">// ETFæè¿°</span></span><br><span class="line">        <span class="string">&quot;https://note-public-img.oss-cn-beijing.aliyuncs.com/nya/nya.json&quot;</span>  <span class="comment">// å…ƒæ•°æ®URL</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ—ï¸ ETFåˆ›å»ºç¤ºä¾‹ï¼ˆæ³¨é‡Šæ‰çš„ä»£ç ï¼‰</span></span><br><span class="line">    <span class="comment">// è¿™éƒ¨åˆ†å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸¤ç§åº•å±‚ä»£å¸çš„ETF</span></span><br><span class="line">    <span class="comment">// const r1 = await createTokenMintAccount(</span></span><br><span class="line">    <span class="comment">//     defaultWallet,</span></span><br><span class="line">    <span class="comment">//     name,</span></span><br><span class="line">    <span class="comment">//     symbol, </span></span><br><span class="line">    <span class="comment">//     description,</span></span><br><span class="line">    <span class="comment">//     url,</span></span><br><span class="line">    <span class="comment">//     [</span></span><br><span class="line">    <span class="comment">//         &#123;</span></span><br><span class="line">    <span class="comment">//             // åº•å±‚ä»£å¸1ï¼šæƒé‡20%</span></span><br><span class="line">    <span class="comment">//             token: new anchor.web3.PublicKey(&quot;7mAKyqdEovoH5VJaRCFRVAuo4dHH2sk79s2pvxjF24mM&quot;),</span></span><br><span class="line">    <span class="comment">//             weight: 20,</span></span><br><span class="line">    <span class="comment">//         &#125;,</span></span><br><span class="line">    <span class="comment">//         &#123;</span></span><br><span class="line">    <span class="comment">//             // åº•å±‚ä»£å¸2ï¼šæƒé‡80%</span></span><br><span class="line">    <span class="comment">//             token: new anchor.web3.PublicKey(&quot;9z65UmYiVSpFbLHqA5di8K8ZvHkqAXdKd7NroNWdemZJ&quot;),</span></span><br><span class="line">    <span class="comment">//             weight: 80,</span></span><br><span class="line">    <span class="comment">//         &#125;</span></span><br><span class="line">    <span class="comment">//     ]);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ¯ è·å–ETFåœ°å€</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç¬¦å·æ´¾ç”ŸETF mintè´¦æˆ·åœ°å€</span></span><br><span class="line">    <span class="keyword">const</span> [etf,] = <span class="title function_">deriveEtfTokenMintAccount</span>(<span class="built_in">symbol</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸ·ï¸ ETF Address: <span class="subst">$&#123;etf&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ’° æ‰§è¡ŒETFè´­ä¹°</span></span><br><span class="line">    <span class="comment">// è´­ä¹°600,000,000ä¸ªæœ€å°å•ä½çš„ETFä»£å¸ï¼ˆç›¸å½“äº0.6ä¸ªETFä»£å¸ï¼Œå‡è®¾9ä½å°æ•°ï¼‰</span></span><br><span class="line">    <span class="keyword">const</span> r2 = <span class="keyword">await</span> <span class="title function_">etfTokenMint</span>(</span><br><span class="line">        defaultWallet,      <span class="comment">// è´­ä¹°è€…é’±åŒ…</span></span><br><span class="line">        etf,               <span class="comment">// ETFä»£å¸åœ°å€</span></span><br><span class="line">        <span class="number">600000000</span>          <span class="comment">// è´­ä¹°æ•°é‡ï¼ˆlamportsï¼‰</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`âœ… ETF Mint Transaction: <span class="subst">$&#123;r2&#125;</span>`</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p><strong>æ•°é‡è®¡ç®—ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è´­ä¹°600,000,000 lamports = 0.6 ETFä»£å¸ï¼ˆ9ä½å°æ•°ï¼‰</span><br><span class="line"></span><br><span class="line">å¦‚æœETFåŒ…å«ä»¥ä¸‹åº•å±‚ä»£å¸ï¼š</span><br><span class="line">- ä»£å¸A (æƒé‡20%): éœ€è¦ 600,000,000 * 20 / 100 = 120,000,000ä¸ªæœ€å°å•ä½</span><br><span class="line">- ä»£å¸B (æƒé‡80%): éœ€è¦ 600,000,000 * 80 / 100 = 480,000,000ä¸ªæœ€å°å•ä½</span><br></pre></td></tr></table></figure>

<h2 id="æŠ€æœ¯æ·±åº¦è§£æ"><a href="#æŠ€æœ¯æ·±åº¦è§£æ" class="headerlink" title="æŠ€æœ¯æ·±åº¦è§£æ"></a>æŠ€æœ¯æ·±åº¦è§£æ</h2><h3 id="1-èµ„äº§è½¬ç§»æœºåˆ¶"><a href="#1-èµ„äº§è½¬ç§»æœºåˆ¶" class="headerlink" title="1. èµ„äº§è½¬ç§»æœºåˆ¶"></a>1. èµ„äº§è½¬ç§»æœºåˆ¶</h3><h4 id="A-åŸå­æ€§ä¿è¯"><a href="#A-åŸå­æ€§ä¿è¯" class="headerlink" title="A. åŸå­æ€§ä¿è¯"></a>A. åŸå­æ€§ä¿è¯</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰€æœ‰è½¬ç§»æ“ä½œåœ¨å•ä¸€äº¤æ˜“ä¸­å®Œæˆ</span></span><br><span class="line"><span class="keyword">for</span> <span class="variable">x</span> <span class="keyword">in</span> &amp;ctx.accounts.etf_token_info.constituent &#123;</span><br><span class="line">    <span class="comment">// è½¬ç§»åº•å±‚ä»£å¸</span></span><br><span class="line">    <span class="title function_ invoke__">transfer</span>(<span class="comment">/* ... */</span>)?;  <span class="comment">// å¦‚æœå¤±è´¥ï¼Œæ•´ä¸ªäº¤æ˜“å›æ»š</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é“¸é€ ETFä»£å¸</span></span><br><span class="line"><span class="title function_ invoke__">mint_to</span>(<span class="comment">/* ... */</span>)?;  <span class="comment">// å¦‚æœå¤±è´¥ï¼Œæ•´ä¸ªäº¤æ˜“å›æ»š</span></span><br></pre></td></tr></table></figure>

<p><strong>é‡è¦æ€§</strong>ï¼š</p>
<ul>
<li>é˜²æ­¢éƒ¨åˆ†æ‰§è¡Œå¯¼è‡´çš„èµ„äº§æŸå¤±</li>
<li>ç¡®ä¿ç”¨æˆ·è¦ä¹ˆè·å¾—å®Œæ•´çš„ETFï¼Œè¦ä¹ˆä¿æŒåŸå§‹çŠ¶æ€</li>
<li>é¿å…å¥—åˆ©æœºä¼šå’Œä»·æ ¼æ“çºµ</li>
</ul>
<h4 id="B-æƒé™éªŒè¯é“¾"><a href="#B-æƒé™éªŒè¯é“¾" class="headerlink" title="B. æƒé™éªŒè¯é“¾"></a>B. æƒé™éªŒè¯é“¾</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·ç­¾å â†’ æˆæƒä»£å¸è½¬ç§» â†’ ç¨‹åºéªŒè¯ â†’ æ‰§è¡Œè½¬ç§»</span><br><span class="line">PDAç­¾å â†’ æˆæƒä»£å¸é“¸é€  â†’ ç¨‹åºéªŒè¯ â†’ æ‰§è¡Œé“¸é€ </span><br></pre></td></tr></table></figure>

<h3 id="2-è´¦æˆ·çŠ¶æ€ç®¡ç†"><a href="#2-è´¦æˆ·çŠ¶æ€ç®¡ç†" class="headerlink" title="2. è´¦æˆ·çŠ¶æ€ç®¡ç†"></a>2. è´¦æˆ·çŠ¶æ€ç®¡ç†</h3><h4 id="A-ATAç”Ÿå‘½å‘¨æœŸ"><a href="#A-ATAç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="A. ATAç”Ÿå‘½å‘¨æœŸ"></a>A. ATAç”Ÿå‘½å‘¨æœŸ</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. æ£€æŸ¥è´¦æˆ·å­˜åœ¨æ€§</span></span><br><span class="line"><span class="keyword">await</span> <span class="title function_">getAccount</span>(provider.<span class="property">connection</span>, etfAta);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºè´¦æˆ·</span></span><br><span class="line"><span class="title function_">createAssociatedTokenAccountInstruction</span>(<span class="comment">/* ... */</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. åœ¨ä¸»äº¤æ˜“ä¸­ä½¿ç”¨è´¦æˆ·</span></span><br><span class="line">.<span class="title function_">remainingAccounts</span>([&#123; <span class="attr">pubkey</span>: etfAta, <span class="attr">isWritable</span>: <span class="literal">true</span>, <span class="attr">isSigner</span>: <span class="literal">false</span> &#125;])</span><br></pre></td></tr></table></figure>

<h4 id="B-ç§Ÿé‡‘è€ƒè™‘"><a href="#B-ç§Ÿé‡‘è€ƒè™‘" class="headerlink" title="B. ç§Ÿé‡‘è€ƒè™‘"></a>B. ç§Ÿé‡‘è€ƒè™‘</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ¯ä¸ªATAè´¦æˆ·éœ€è¦çº¦0.00203928 SOLçš„ç§Ÿé‡‘</span><br><span class="line">ETFåŒ…å«nä¸ªåº•å±‚ä»£å¸ï¼Œæœ€å¤šéœ€è¦åˆ›å»ºnä¸ªæ‰˜ç®¡è´¦æˆ·</span><br><span class="line">æ€»ç§Ÿé‡‘æˆæœ¬ â‰ˆ n * 0.00203928 SOL</span><br></pre></td></tr></table></figure>

<h3 id="3-é”™è¯¯å¤„ç†ç­–ç•¥"><a href="#3-é”™è¯¯å¤„ç†ç­–ç•¥" class="headerlink" title="3. é”™è¯¯å¤„ç†ç­–ç•¥"></a>3. é”™è¯¯å¤„ç†ç­–ç•¥</h3><h4 id="A-å¸¸è§é”™è¯¯åœºæ™¯"><a href="#A-å¸¸è§é”™è¯¯åœºæ™¯" class="headerlink" title="A. å¸¸è§é”™è¯¯åœºæ™¯"></a>A. å¸¸è§é”™è¯¯åœºæ™¯</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. è´¦æˆ·ç¼ºå¤±</span></span><br><span class="line">.<span class="title function_ invoke__">ok_or</span>(TokenMintError::InvalidAccounts)?</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä½™é¢ä¸è¶³</span></span><br><span class="line"><span class="comment">// SPL Tokenç¨‹åºä¼šè‡ªåŠ¨éªŒè¯ä½™é¢</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æƒé™ä¸è¶³  </span></span><br><span class="line"><span class="comment">// Anchoræ¡†æ¶ä¼šè‡ªåŠ¨éªŒè¯ç­¾åæƒé™</span></span><br></pre></td></tr></table></figure>

<h4 id="B-é”™è¯¯æ¢å¤æœºåˆ¶"><a href="#B-é”™è¯¯æ¢å¤æœºåˆ¶" class="headerlink" title="B. é”™è¯¯æ¢å¤æœºåˆ¶"></a>B. é”™è¯¯æ¢å¤æœºåˆ¶</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯é‡è¯•é€»è¾‘</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">etfTokenMint</span>(<span class="comment">/* ... */</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">message</span>.<span class="title function_">includes</span>(<span class="string">&quot;TokenAccountNotFoundError&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// å…ˆåˆ›å»ºç¼ºå¤±è´¦æˆ·ï¼Œç„¶åé‡è¯•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-æ€§èƒ½ä¼˜åŒ–"><a href="#4-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="4. æ€§èƒ½ä¼˜åŒ–"></a>4. æ€§èƒ½ä¼˜åŒ–</h3><h4 id="A-æ‰¹é‡æ“ä½œä¼˜åŒ–"><a href="#A-æ‰¹é‡æ“ä½œä¼˜åŒ–" class="headerlink" title="A. æ‰¹é‡æ“ä½œä¼˜åŒ–"></a>A. æ‰¹é‡æ“ä½œä¼˜åŒ–</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨HashMapé¿å…O(nÂ²)å¤æ‚åº¦</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">accounts</span> = ctx.remaining_accounts</span><br><span class="line">    .<span class="title function_ invoke__">iter</span>()</span><br><span class="line">    .<span class="title function_ invoke__">map</span>(|x| (x.<span class="title function_ invoke__">key</span>(), x.<span class="title function_ invoke__">to_owned</span>()))</span><br><span class="line">    .collect::&lt;HashMap&lt;_, _&gt;&gt;();  <span class="comment">// O(n)æ—¶é—´æ„å»ºï¼ŒO(1)æŸ¥æ‰¾</span></span><br></pre></td></tr></table></figure>

<h4 id="B-è®¡ç®—å•å…ƒä¼˜åŒ–"><a href="#B-è®¡ç®—å•å…ƒä¼˜åŒ–" class="headerlink" title="B. è®¡ç®—å•å…ƒä¼˜åŒ–"></a>B. è®¡ç®—å•å…ƒä¼˜åŒ–</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ®ETFå¤æ‚åº¦åŠ¨æ€è°ƒæ•´</span></span><br><span class="line"><span class="keyword">const</span> computeUnits = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">200_000</span>, etfInfo.<span class="property">constituent</span>.<span class="property">length</span> * <span class="number">50_000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="å®‰å…¨æ€§è€ƒè™‘"><a href="#å®‰å…¨æ€§è€ƒè™‘" class="headerlink" title="å®‰å…¨æ€§è€ƒè™‘"></a>å®‰å…¨æ€§è€ƒè™‘</h2><h3 id="1-é‡å…¥æ”»å‡»é˜²æŠ¤"><a href="#1-é‡å…¥æ”»å‡»é˜²æŠ¤" class="headerlink" title="1. é‡å…¥æ”»å‡»é˜²æŠ¤"></a>1. é‡å…¥æ”»å‡»é˜²æŠ¤</h3><ul>
<li><strong>åŸå­æ€§æ“ä½œ</strong>ï¼šæ‰€æœ‰è½¬ç§»åœ¨å•ä¸€äº¤æ˜“ä¸­å®Œæˆ</li>
<li><strong>çŠ¶æ€æ£€æŸ¥</strong>ï¼šæ“ä½œå‰éªŒè¯æ‰€æœ‰å‰ç½®æ¡ä»¶</li>
<li><strong>PDAæ§åˆ¶</strong>ï¼šå…³é”®æ“ä½œåªèƒ½ç”±ç¨‹åºPDAæ‰§è¡Œ</li>
</ul>
<h3 id="2-ä»·æ ¼æ“çºµé˜²æŠ¤"><a href="#2-ä»·æ ¼æ“çºµé˜²æŠ¤" class="headerlink" title="2. ä»·æ ¼æ“çºµé˜²æŠ¤"></a>2. ä»·æ ¼æ“çºµé˜²æŠ¤</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å»ºè®®æ·»åŠ ä»·æ ¼éªŒè¯æœºåˆ¶</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">EtfToken</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">validate_fair_value</span>(&amp;<span class="keyword">self</span>, oracle_prices: &amp;[<span class="type">u64</span>]) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        <span class="comment">// éªŒè¯ETFä»·æ ¼ä¸åº•å±‚èµ„äº§ä»·æ ¼çš„åˆç†æ€§</span></span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-æ»‘ç‚¹ä¿æŠ¤"><a href="#3-æ»‘ç‚¹ä¿æŠ¤" class="headerlink" title="3. æ»‘ç‚¹ä¿æŠ¤"></a>3. æ»‘ç‚¹ä¿æŠ¤</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å»ºè®®æ·»åŠ æœ€å¤§æ»‘ç‚¹é™åˆ¶</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">etf_token_mint_with_slippage</span>(</span><br><span class="line">    ctx: Context&lt;EtfTokenTransaction&gt;,</span><br><span class="line">    lamports: <span class="type">u64</span>,</span><br><span class="line">    max_slippage_bps: <span class="type">u16</span>,  <span class="comment">// æœ€å¤§æ»‘ç‚¹ï¼ˆåŸºç‚¹ï¼‰</span></span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// è®¡ç®—é¢„æœŸæˆæœ¬å’Œå®é™…æˆæœ¬ï¼ŒéªŒè¯æ»‘ç‚¹èŒƒå›´</span></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ‰©å±•åŠŸèƒ½å»ºè®®"><a href="#æ‰©å±•åŠŸèƒ½å»ºè®®" class="headerlink" title="æ‰©å±•åŠŸèƒ½å»ºè®®"></a>æ‰©å±•åŠŸèƒ½å»ºè®®</h2><h3 id="1-åŠ¨æ€æƒé‡è°ƒæ•´"><a href="#1-åŠ¨æ€æƒé‡è°ƒæ•´" class="headerlink" title="1. åŠ¨æ€æƒé‡è°ƒæ•´"></a>1. åŠ¨æ€æƒé‡è°ƒæ•´</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">rebalance_etf</span>(</span><br><span class="line">    ctx: Context&lt;RebalanceETF&gt;,</span><br><span class="line">    new_weights: <span class="type">Vec</span>&lt;EtfTokenConstituent&gt;,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// å®ç°ETFæƒé‡çš„åŠ¨æ€è°ƒæ•´</span></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-éƒ¨åˆ†èµå›åŠŸèƒ½"><a href="#2-éƒ¨åˆ†èµå›åŠŸèƒ½" class="headerlink" title="2. éƒ¨åˆ†èµå›åŠŸèƒ½"></a>2. éƒ¨åˆ†èµå›åŠŸèƒ½</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">etf_token_redeem</span>(</span><br><span class="line">    ctx: Context&lt;EtfTokenRedeem&gt;,</span><br><span class="line">    etf_amount: <span class="type">u64</span>,  <span class="comment">// è¦èµå›çš„ETFä»£å¸æ•°é‡</span></span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// æŒ‰æ¯”ä¾‹èµå›åº•å±‚èµ„äº§</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">constituent</span> <span class="keyword">in</span> &amp;ctx.accounts.etf_token_info.constituent &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">redeem_amount</span> = constituent.weight <span class="keyword">as</span> <span class="type">u64</span> * etf_amount / <span class="number">100</span>;</span><br><span class="line">        <span class="comment">// ä»ETFæ‰˜ç®¡è´¦æˆ·è½¬ç§»åˆ°ç”¨æˆ·è´¦æˆ·</span></span><br><span class="line">        <span class="title function_ invoke__">transfer</span>(<span class="comment">/* ... */</span>, redeem_amount)?;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é”€æ¯ç›¸åº”æ•°é‡çš„ETFä»£å¸</span></span><br><span class="line">    <span class="title function_ invoke__">burn</span>(<span class="comment">/* ... */</span>, etf_amount)?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-è´¹ç”¨æ”¶å–æœºåˆ¶"><a href="#3-è´¹ç”¨æ”¶å–æœºåˆ¶" class="headerlink" title="3. è´¹ç”¨æ”¶å–æœºåˆ¶"></a>3. è´¹ç”¨æ”¶å–æœºåˆ¶</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">EtfFees</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> management_fee_bps: <span class="type">u16</span>,    <span class="comment">// ç®¡ç†è´¹ï¼ˆå¹´åŒ–åŸºç‚¹ï¼‰</span></span><br><span class="line">    <span class="keyword">pub</span> performance_fee_bps: <span class="type">u16</span>,   <span class="comment">// ç»©æ•ˆè´¹ï¼ˆåŸºç‚¹ï¼‰</span></span><br><span class="line">    <span class="keyword">pub</span> entry_fee_bps: <span class="type">u16</span>,         <span class="comment">// ç”³è´­è´¹ï¼ˆåŸºç‚¹ï¼‰</span></span><br><span class="line">    <span class="keyword">pub</span> exit_fee_bps: <span class="type">u16</span>,          <span class="comment">// èµå›è´¹ï¼ˆåŸºç‚¹ï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">calculate_fees</span>(</span><br><span class="line">    etf_amount: <span class="type">u64</span>,</span><br><span class="line">    fees: &amp;EtfFees,</span><br><span class="line">    operation_type: OperationType,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">u64</span> &#123;</span><br><span class="line">    <span class="keyword">match</span> operation_type &#123;</span><br><span class="line">        OperationType::Purchase =&gt; etf_amount * fees.entry_fee_bps <span class="keyword">as</span> <span class="type">u64</span> / <span class="number">10000</span>,</span><br><span class="line">        OperationType::Redeem =&gt; etf_amount * fees.exit_fee_bps <span class="keyword">as</span> <span class="type">u64</span> / <span class="number">10000</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-ä»·æ ¼é¢„è¨€æœºé›†æˆ"><a href="#4-ä»·æ ¼é¢„è¨€æœºé›†æˆ" class="headerlink" title="4. ä»·æ ¼é¢„è¨€æœºé›†æˆ"></a>4. ä»·æ ¼é¢„è¨€æœºé›†æˆ</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> pyth_solana_receiver_sdk::price_update::PriceUpdateV2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">etf_token_mint_with_oracle</span>(</span><br><span class="line">    ctx: Context&lt;EtfTokenMintWithOracle&gt;,</span><br><span class="line">    lamports: <span class="type">u64</span>,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// éªŒè¯ä»·æ ¼æ•°æ®çš„æœ‰æ•ˆæ€§</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">price_feed</span> <span class="keyword">in</span> &amp;ctx.remaining_accounts &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">price_update</span> = PriceUpdateV2::<span class="title function_ invoke__">try_deserialize</span>(&amp;<span class="keyword">mut</span> price_feed.data.<span class="title function_ invoke__">borrow</span>())?;</span><br><span class="line">        require!(price_update.<span class="title function_ invoke__">verify_price_feeds</span>().<span class="title function_ invoke__">is_ok</span>(), TokenMintError::InvalidPriceData);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰§è¡Œè´­ä¹°é€»è¾‘</span></span><br><span class="line">    <span class="title function_ invoke__">etf_token_mint</span>(ctx, lamports)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-æµåŠ¨æ€§æ± é›†æˆ"><a href="#5-æµåŠ¨æ€§æ± é›†æˆ" class="headerlink" title="5. æµåŠ¨æ€§æ± é›†æˆ"></a>5. æµåŠ¨æ€§æ± é›†æˆ</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">etf_token_mint_via_swap</span>(</span><br><span class="line">    ctx: Context&lt;EtfTokenMintViaSwap&gt;,</span><br><span class="line">    input_token: Pubkey,</span><br><span class="line">    input_amount: <span class="type">u64</span>,</span><br><span class="line">    minimum_etf_output: <span class="type">u64</span>,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// 1. å°†è¾“å…¥ä»£å¸æŒ‰æ¯”ä¾‹å…‘æ¢ä¸ºåº•å±‚èµ„äº§</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">constituent</span> <span class="keyword">in</span> &amp;ctx.accounts.etf_token_info.constituent &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">target_amount</span> = constituent.weight <span class="keyword">as</span> <span class="type">u64</span> * minimum_etf_output / <span class="number">100</span>;</span><br><span class="line">        <span class="comment">// é€šè¿‡DEXå…‘æ¢è·å¾—ç›®æ ‡ä»£å¸</span></span><br><span class="line">        <span class="title function_ invoke__">swap_via_dex</span>(input_token, constituent.token, target_amount)?;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. ä½¿ç”¨å…‘æ¢å¾—åˆ°çš„åº•å±‚èµ„äº§é“¸é€ ETF</span></span><br><span class="line">    <span class="title function_ invoke__">etf_token_mint</span>(ctx, minimum_etf_output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ•…éšœæ’é™¤æŒ‡å—"><a href="#æ•…éšœæ’é™¤æŒ‡å—" class="headerlink" title="æ•…éšœæ’é™¤æŒ‡å—"></a>æ•…éšœæ’é™¤æŒ‡å—</h2><h3 id="1-å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ"><a href="#1-å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="1. å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ"></a>1. å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ</h3><h4 id="A-â€œTokenAccountNotFoundErrorâ€"><a href="#A-â€œTokenAccountNotFoundErrorâ€" class="headerlink" title="A. â€œTokenAccountNotFoundErrorâ€"></a>A. â€œTokenAccountNotFoundErrorâ€</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯åŸå› ï¼šç¼ºå°‘å¿…è¦çš„å…³è”ä»£å¸è´¦æˆ·</span></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿æ‰€æœ‰åº•å±‚ä»£å¸çš„æ‰˜ç®¡è´¦æˆ·éƒ½å·²åˆ›å»º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥ä»£ç ï¼š</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> &#123;token&#125; <span class="keyword">of</span> etfInfo.<span class="property">constituent</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> etfAta = <span class="title function_">getAssociatedTokenAddressSync</span>(token, etfCoreAddress, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">getAccount</span>(provider.<span class="property">connection</span>, etfAta);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="title class_">TokenAccountNotFoundError</span>) &#123;</span><br><span class="line">            <span class="comment">// éœ€è¦åˆ›å»ºè´¦æˆ·</span></span><br><span class="line">            setupTx.<span class="title function_">add</span>(<span class="title function_">createAssociatedTokenAccountInstruction</span>(<span class="comment">/* ... */</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="B-â€œInsufficientBalanceâ€"><a href="#B-â€œInsufficientBalanceâ€" class="headerlink" title="B. â€œInsufficientBalanceâ€"></a>B. â€œInsufficientBalanceâ€</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯åŸå› ï¼šç”¨æˆ·åº•å±‚ä»£å¸ä½™é¢ä¸è¶³</span></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ç”¨æˆ·ä½™é¢å¹¶æä¾›æ˜ç¡®æç¤º</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">validate_user_balances</span>(</span><br><span class="line">    user_accounts: &amp;[TokenAccount],</span><br><span class="line">    required_amounts: &amp;[<span class="type">u64</span>],</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (account, &amp;required) <span class="keyword">in</span> user_accounts.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">zip</span>(required_amounts) &#123;</span><br><span class="line">        require!(account.amount &gt;= required, TokenMintError::InsufficientBalance);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="C-â€œInvalidAccountsâ€"><a href="#C-â€œInvalidAccountsâ€" class="headerlink" title="C. â€œInvalidAccountsâ€"></a>C. â€œInvalidAccountsâ€</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯åŸå› ï¼šä¼ å…¥çš„è´¦æˆ·ä¸åŒ¹é…æˆ–é¡ºåºé”™è¯¯</span></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿remaining_accountsçš„é¡ºåºä¸ETFé…ç½®ä¸€è‡´</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯éªŒè¯ä»£ç ï¼š</span></span><br><span class="line"><span class="keyword">const</span> validateAccountOrder = (etfInfo: EtfToken, accounts: PublicKey[]) =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> <span class="variable">i</span> = <span class="number">0</span>; i &lt; etfInfo.constituent.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> expectedUserAta = <span class="title function_ invoke__">getAssociatedTokenAddressSync</span>(</span><br><span class="line">            etfInfo.constituent[i].token, </span><br><span class="line">            wallet.publicKey</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">const</span> expectedEtfAta = <span class="title function_ invoke__">getAssociatedTokenAddressSync</span>(</span><br><span class="line">            etfInfo.constituent[i].token, </span><br><span class="line">            etfCoreAddress, </span><br><span class="line">            <span class="literal">true</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="title function_ invoke__">assert</span>(accounts[i * <span class="number">2</span>].<span class="title function_ invoke__">equals</span>(expectedUserAta), <span class="string">&quot;User ATA mismatch&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">assert</span>(accounts[i * <span class="number">2</span> + <span class="number">1</span>].<span class="title function_ invoke__">equals</span>(expectedEtfAta), <span class="string">&quot;ETF ATA mismatch&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-è°ƒè¯•æŠ€å·§"><a href="#2-è°ƒè¯•æŠ€å·§" class="headerlink" title="2. è°ƒè¯•æŠ€å·§"></a>2. è°ƒè¯•æŠ€å·§</h3><h4 id="A-äº¤æ˜“æ—¥å¿—åˆ†æ"><a href="#A-äº¤æ˜“æ—¥å¿—åˆ†æ" class="headerlink" title="A. äº¤æ˜“æ—¥å¿—åˆ†æ"></a>A. äº¤æ˜“æ—¥å¿—åˆ†æ</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯ç”¨è¯¦ç»†æ—¥å¿—</span></span><br><span class="line"><span class="keyword">const</span> tx = <span class="keyword">await</span> anchor.<span class="property">web3</span>.<span class="title function_">sendAndConfirmTransaction</span>(</span><br><span class="line">    provider.<span class="property">connection</span>,</span><br><span class="line">    transaction,</span><br><span class="line">    signers,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">skipPreflight</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">preflightCommitment</span>: <span class="string">&quot;confirmed&quot;</span>,</span><br><span class="line">        <span class="attr">commitment</span>: <span class="string">&quot;confirmed&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–äº¤æ˜“è¯¦æƒ…</span></span><br><span class="line"><span class="keyword">const</span> txDetails = <span class="keyword">await</span> provider.<span class="property">connection</span>.<span class="title function_">getTransaction</span>(tx, &#123;</span><br><span class="line">    <span class="attr">commitment</span>: <span class="string">&quot;confirmed&quot;</span>,</span><br><span class="line">    <span class="attr">maxSupportedTransactionVersion</span>: <span class="number">0</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Transaction logs:&quot;</span>, txDetails?.<span class="property">meta</span>?.<span class="property">logMessages</span>);</span><br></pre></td></tr></table></figure>

<h4 id="B-è´¦æˆ·çŠ¶æ€æ£€æŸ¥"><a href="#B-è´¦æˆ·çŠ¶æ€æ£€æŸ¥" class="headerlink" title="B. è´¦æˆ·çŠ¶æ€æ£€æŸ¥"></a>B. è´¦æˆ·çŠ¶æ€æ£€æŸ¥</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ£€æŸ¥ETFä¿¡æ¯</span></span><br><span class="line"><span class="keyword">const</span> etfInfo = <span class="keyword">await</span> program.<span class="property">account</span>.<span class="property">etfToken</span>.<span class="title function_">fetch</span>(etfInfoAddress);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ETF Configuration:&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">creator</span>: etfInfo.<span class="property">creator</span>.<span class="title function_">toString</span>(),</span><br><span class="line">    <span class="attr">mintAccount</span>: etfInfo.<span class="property">mintAccount</span>.<span class="title function_">toString</span>(),</span><br><span class="line">    <span class="attr">constituent</span>: etfInfo.<span class="property">constituent</span>.<span class="title function_">map</span>(<span class="function"><span class="params">c</span> =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">token</span>: c.<span class="property">token</span>.<span class="title function_">toString</span>(),</span><br><span class="line">        <span class="attr">weight</span>: c.<span class="property">weight</span>,</span><br><span class="line">    &#125;)),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥ç”¨æˆ·ä½™é¢</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> &#123;token&#125; <span class="keyword">of</span> etfInfo.<span class="property">constituent</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> userAta = <span class="title function_">getAssociatedTokenAddressSync</span>(token, wallet.<span class="property">publicKey</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> account = <span class="keyword">await</span> <span class="title function_">getAccount</span>(provider.<span class="property">connection</span>, userAta);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`User balance for <span class="subst">$&#123;token&#125;</span>: <span class="subst">$&#123;account.amount&#125;</span>`</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`No account found for token <span class="subst">$&#123;token&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-æ€§èƒ½ç›‘æ§"><a href="#3-æ€§èƒ½ç›‘æ§" class="headerlink" title="3. æ€§èƒ½ç›‘æ§"></a>3. æ€§èƒ½ç›‘æ§</h3><h4 id="A-äº¤æ˜“æˆæœ¬åˆ†æ"><a href="#A-äº¤æ˜“æˆæœ¬åˆ†æ" class="headerlink" title="A. äº¤æ˜“æˆæœ¬åˆ†æ"></a>A. äº¤æ˜“æˆæœ¬åˆ†æ</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼°ç®—äº¤æ˜“æˆæœ¬</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">estimateTransactionCost</span> = <span class="keyword">async</span> (<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">etfInfo</span>: <span class="title class_">EtfToken</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">lamports</span>: <span class="built_in">number</span></span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> baseFee = <span class="number">5000</span>; <span class="comment">// åŸºç¡€äº¤æ˜“è´¹ç”¨ï¼ˆlamportsï¼‰</span></span><br><span class="line">    <span class="keyword">const</span> accountCreationFee = <span class="number">2039280</span>; <span class="comment">// ATAåˆ›å»ºè´¹ç”¨</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> totalCost = baseFee;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥éœ€è¦åˆ›å»ºçš„è´¦æˆ·æ•°é‡</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> &#123;token&#125; <span class="keyword">of</span> etfInfo.<span class="property">constituent</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> etfAta = <span class="title function_">getAssociatedTokenAddressSync</span>(token, etfCoreAddress, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">getAccount</span>(provider.<span class="property">connection</span>, etfAta);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="title class_">TokenAccountNotFoundError</span>) &#123;</span><br><span class="line">                totalCost += accountCreationFee;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> totalCost;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="B-Gasä½¿ç”¨ä¼˜åŒ–"><a href="#B-Gasä½¿ç”¨ä¼˜åŒ–" class="headerlink" title="B. Gasä½¿ç”¨ä¼˜åŒ–"></a>B. Gasä½¿ç”¨ä¼˜åŒ–</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€è®¡ç®—æ‰€éœ€è®¡ç®—å•å…ƒ</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">calculateComputeUnits</span> = (<span class="params"><span class="attr">constituentCount</span>: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> baseUnits = <span class="number">100_000</span>;</span><br><span class="line">    <span class="keyword">const</span> perTokenUnits = <span class="number">50_000</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="number">1_400_000</span>, baseUnits + constituentCount * perTokenUnits);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> computeUnits = <span class="title function_">calculateComputeUnits</span>(etfInfo.<span class="property">constituent</span>.<span class="property">length</span>);</span><br><span class="line"><span class="keyword">const</span> modifyComputeUnits = anchor.<span class="property">web3</span>.<span class="property">ComputeBudgetProgram</span>.<span class="title function_">setComputeUnitLimit</span>(&#123;</span><br><span class="line">    <span class="attr">units</span>: computeUnits,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="æœ€ä½³å®è·µæ€»ç»“"><a href="#æœ€ä½³å®è·µæ€»ç»“" class="headerlink" title="æœ€ä½³å®è·µæ€»ç»“"></a>æœ€ä½³å®è·µæ€»ç»“</h2><h3 id="1-ä»£ç ç»“æ„"><a href="#1-ä»£ç ç»“æ„" class="headerlink" title="1. ä»£ç ç»“æ„"></a>1. ä»£ç ç»“æ„</h3><ul>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šå°†ä¸åŒåŠŸèƒ½åˆ†ç¦»åˆ°ç‹¬ç«‹æ¨¡å—</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œæ¢å¤æœºåˆ¶</li>
<li><strong>æ–‡æ¡£æ³¨é‡Š</strong>ï¼šä¸ºæ¯ä¸ªå…³é”®å‡½æ•°æä¾›è¯¦ç»†è¯´æ˜</li>
</ul>
<h3 id="2-å®‰å…¨è€ƒè™‘"><a href="#2-å®‰å…¨è€ƒè™‘" class="headerlink" title="2. å®‰å…¨è€ƒè™‘"></a>2. å®‰å…¨è€ƒè™‘</h3><ul>
<li><strong>æƒé™éªŒè¯</strong>ï¼šæ¯ä¸ªæ“ä½œéƒ½è¦éªŒè¯è°ƒç”¨è€…æƒé™</li>
<li><strong>æ•°æ®éªŒè¯</strong>ï¼šéªŒè¯æ‰€æœ‰è¾“å…¥å‚æ•°çš„æœ‰æ•ˆæ€§</li>
<li><strong>åŸå­æ€§</strong>ï¼šç¡®ä¿å¤æ‚æ“ä½œçš„åŸå­æ€§</li>
</ul>
<h3 id="3-ç”¨æˆ·ä½“éªŒ"><a href="#3-ç”¨æˆ·ä½“éªŒ" class="headerlink" title="3. ç”¨æˆ·ä½“éªŒ"></a>3. ç”¨æˆ·ä½“éªŒ</h3><ul>
<li><strong>è‡ªåŠ¨åŒ–</strong>ï¼šè‡ªåŠ¨å¤„ç†è´¦æˆ·åˆ›å»ºç­‰å¤æ‚æ“ä½œ</li>
<li><strong>é€æ˜æ€§</strong>ï¼šæä¾›æ¸…æ™°çš„æ“ä½œåé¦ˆå’ŒçŠ¶æ€ä¿¡æ¯</li>
<li><strong>é”™è¯¯æ¢å¤</strong>ï¼šæä¾›å‹å¥½çš„é”™è¯¯æç¤ºå’Œæ¢å¤å»ºè®®</li>
</ul>
<h3 id="4-æ‰©å±•æ€§"><a href="#4-æ‰©å±•æ€§" class="headerlink" title="4. æ‰©å±•æ€§"></a>4. æ‰©å±•æ€§</h3><ul>
<li><strong>é…ç½®åŒ–</strong>ï¼šä½¿ç”¨é…ç½®å‚æ•°è€Œéç¡¬ç¼–ç å€¼</li>
<li><strong>æ¥å£è®¾è®¡</strong>ï¼šè®¾è®¡æ¸…æ™°çš„å…¬å…±æ¥å£</li>
<li><strong>ç‰ˆæœ¬ç®¡ç†</strong>ï¼šæ”¯æŒç¨‹åºå’Œæ•°æ®ç»“æ„çš„ç‰ˆæœ¬å‡çº§</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ•™ç¨‹è¯¦ç»†ä»‹ç»äº†Solanaä¸ŠETFä»£å¸è´­ä¹°åŠŸèƒ½çš„å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>è´¦æˆ·ç»“æ„è®¾è®¡</strong>ï¼šå®šä¹‰äº†å®‰å…¨å¯é çš„è´¦æˆ·éªŒè¯æœºåˆ¶</li>
<li><strong>æ ¸å¿ƒä¸šåŠ¡é€»è¾‘</strong>ï¼šå®ç°äº†åŸå­æ€§çš„èµ„äº§è½¬ç§»å’Œä»£å¸é“¸é€ </li>
<li><strong>å®¢æˆ·ç«¯é›†æˆ</strong>ï¼šæä¾›äº†å®Œæ•´çš„å‰ç«¯è°ƒç”¨ç¤ºä¾‹</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šå»ºç«‹äº†å®Œå–„çš„é”™è¯¯æ£€æµ‹å’Œæ¢å¤æœºåˆ¶</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé€šè¿‡ç®—æ³•ä¼˜åŒ–å’Œèµ„æºç®¡ç†æå‡æ•ˆç‡</li>
</ol>
<p>é€šè¿‡è¿™ä¸ªå®ç°ï¼Œç”¨æˆ·å¯ä»¥å®‰å…¨ã€é«˜æ•ˆåœ°è´­ä¹°ETFä»£å¸ï¼Œè€Œå¼€å‘è€…ä¹Ÿè·å¾—äº†ä¸€ä¸ªå¯æ‰©å±•ã€å¯ç»´æŠ¤çš„ä»£ç åŸºç¡€ã€‚è¿™ä¸ºæ„å»ºæ›´å¤æ‚çš„DeFiäº§å“å¥ å®šäº†åšå®åŸºç¡€ã€‚</p>
<p><strong>å…³é”®æŠ€æœ¯è¦ç‚¹å›é¡¾</strong>ï¼š</p>
<ul>
<li>âœ… PDAæƒé™æ§åˆ¶ç¡®ä¿å®‰å…¨æ€§</li>
<li>âœ… åŸå­æ€§æ“ä½œé˜²æ­¢éƒ¨åˆ†æ‰§è¡Œ</li>
<li>âœ… è‡ªåŠ¨è´¦æˆ·ç®¡ç†æå‡ç”¨æˆ·ä½“éªŒ</li>
<li>âœ… çµæ´»çš„æƒé‡é…ç½®æ”¯æŒå¤šæ ·åŒ–æŠ•èµ„ç­–ç•¥</li>
<li>âœ… å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶æé«˜ç¨³å®šæ€§</li>
</ul>
<p>è¿™ä¸ªETFè´­ä¹°ç³»ç»Ÿä¸ä»…å±•ç¤ºäº†Solanaç¨‹åºå¼€å‘çš„æœ€ä½³å®è·µï¼Œä¹Ÿä¸ºç†è§£å¤æ‚DeFiåè®®çš„å†…éƒ¨æœºåˆ¶æä¾›äº†å®è´µçš„å­¦ä¹ ææ–™ã€‚</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/09/20/Solana%E5%AE%9E%E6%88%98-%E5%88%9B%E5%BB%BAETF%E6%8C%87%E4%BB%A4%E7%9A%84%E8%B0%83%E7%94%A8/" rel="prev" title="Solanaå®æˆ˜-åˆ›å»ºETFæŒ‡ä»¤çš„è°ƒç”¨">
                  <i class="fa fa-angle-left"></i> Solanaå®æˆ˜-åˆ›å»ºETFæŒ‡ä»¤çš„è°ƒç”¨
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/09/22/Solana%E5%AE%9E%E6%88%98-ETF%E7%9A%84%E8%B5%8E%E5%9B%9E/" rel="next" title="Solanaå®æˆ˜-ETFçš„èµå›">
                  Solanaå®æˆ˜-ETFçš„èµå› <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">samxie</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
