<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.24.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="本教程将详细介绍如何在Solana上创建ETF代币，包括结构设计、元数据管理和完整的创建流程">
<meta property="og:type" content="article">
<meta property="og:title" content="Solana实战-ETF的介绍和创建指令实现">
<meta property="og:url" content="http://example.com/2025/09/20/Solana%E5%AE%9E%E6%88%98-ETF%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0/index.html">
<meta property="og:site_name" content="samxie52">
<meta property="og:description" content="本教程将详细介绍如何在Solana上创建ETF代币，包括结构设计、元数据管理和完整的创建流程">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-09-20T02:28:48.000Z">
<meta property="article:modified_time" content="2025-09-20T09:11:36.477Z">
<meta property="article:author" content="samxie">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2025/09/20/Solana%E5%AE%9E%E6%88%98-ETF%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2025/09/20/Solana%E5%AE%9E%E6%88%98-ETF%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0/","path":"2025/09/20/Solana实战-ETF的介绍和创建指令实现/","title":"Solana实战-ETF的介绍和创建指令实现"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Solana实战-ETF的介绍和创建指令实现 | samxie52</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">samxie52</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A41-%E5%AE%9A%E4%B9%89ETF%E4%BB%A3%E5%B8%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">步骤1: 定义ETF代币数据结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A42-%E5%AE%9E%E7%8E%B0ETF%E4%BB%A3%E5%B8%81%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4"><span class="nav-number">3.</span> <span class="nav-text">步骤2: 实现ETF代币创建指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-PDA%EF%BC%88Program-Derived-Address%EF%BC%89%E6%9C%BA%E5%88%B6"><span class="nav-number">3.1.</span> <span class="nav-text">1. PDA（Program Derived Address）机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%85%83%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E9%9B%86%E6%88%90"><span class="nav-number">3.2.</span> <span class="nav-text">2. 元数据标准集成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.3.</span> <span class="nav-text">3. 权限控制设计</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A43-%E6%B3%A8%E5%86%8CETF%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4"><span class="nav-number">4.</span> <span class="nav-text">步骤3: 注册ETF创建指令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%80%E6%9C%AF%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-number">5.</span> <span class="nav-text">技术深度解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%B4%A6%E6%88%B7%E7%A9%BA%E9%97%B4%E8%AE%A1%E7%AE%97"><span class="nav-number">5.1.</span> <span class="nav-text">1. 账户空间计算</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-InitSpace%E5%AE%8F%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">5.1.1.</span> <span class="nav-text">A. InitSpace宏的工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-8%E5%AD%97%E8%8A%82discriminator"><span class="nav-number">5.1.2.</span> <span class="nav-text">B. 8字节discriminator</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%A7%8D%E5%AD%90%E8%AE%BE%E8%AE%A1%E7%AD%96%E7%95%A5"><span class="nav-number">5.2.</span> <span class="nav-text">2. 种子设计策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-%E5%A4%9A%E5%B1%82%E6%AC%A1%E7%A7%8D%E5%AD%90"><span class="nav-number">5.2.1.</span> <span class="nav-text">A. 多层次种子</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6"><span class="nav-number">5.3.</span> <span class="nav-text">3. 错误处理机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-%E8%B4%A6%E6%88%B7%E9%AA%8C%E8%AF%81"><span class="nav-number">5.3.1.</span> <span class="nav-text">A. 账户验证</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF"><span class="nav-number">5.3.2.</span> <span class="nav-text">B. 自定义错误</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%85%83%E6%95%B0%E6%8D%AE%E9%9B%86%E6%88%90"><span class="nav-number">5.4.</span> <span class="nav-text">4. 元数据集成</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-Metaplex%E6%A0%87%E5%87%86"><span class="nav-number">5.4.1.</span> <span class="nav-text">A. Metaplex标准</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%9D%83%E9%87%8D%E9%85%8D%E7%BD%AE%E8%AE%BE%E8%AE%A1"><span class="nav-number">5.5.</span> <span class="nav-text">5. 权重配置设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-%E7%99%BE%E5%88%86%E6%AF%94%E7%B3%BB%E7%BB%9F"><span class="nav-number">5.5.1.</span> <span class="nav-text">A. 百分比系统</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD%E5%BB%BA%E8%AE%AE"><span class="nav-number">6.</span> <span class="nav-text">扩展功能建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%9D%83%E9%87%8D%E9%AA%8C%E8%AF%81"><span class="nav-number">6.1.</span> <span class="nav-text">1. 权重验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%87%8D%E5%A4%8D%E4%BB%A3%E5%B8%81%E6%A3%80%E6%9F%A5"><span class="nav-number">6.2.</span> <span class="nav-text">2. 重复代币检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%B4%B9%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">6.3.</span> <span class="nav-text">3. 费用配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%8A%A8%E6%80%81%E6%9D%83%E9%87%8D%E8%B0%83%E6%95%B4"><span class="nav-number">6.4.</span> <span class="nav-text">4. 动态权重调整</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7%E8%80%83%E8%99%91"><span class="nav-number">7.</span> <span class="nav-text">安全性考虑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="nav-number">7.1.</span> <span class="nav-text">1. 权限控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="nav-number">7.2.</span> <span class="nav-text">2. 数据完整性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BB%8F%E6%B5%8E%E5%AE%89%E5%85%A8"><span class="nav-number">7.3.</span> <span class="nav-text">3. 经济安全</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">8.</span> <span class="nav-text">使用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E7%A7%91%E6%8A%80%E8%82%A1ETF"><span class="nav-number">8.1.</span> <span class="nav-text">1. 创建科技股ETF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%88%9B%E5%BB%BA%E7%A8%B3%E5%AE%9A%E5%B8%81ETF"><span class="nav-number">8.2.</span> <span class="nav-text">2. 创建稳定币ETF</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">samxie</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/20/Solana%E5%AE%9E%E6%88%98-ETF%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="samxie">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samxie52">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Solana实战-ETF的介绍和创建指令实现 | samxie52">
      <meta itemprop="description" content="本教程将详细介绍如何在Solana上创建ETF代币，包括结构设计、元数据管理和完整的创建流程">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Solana实战-ETF的介绍和创建指令实现
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-09-20 10:28:48 / 修改时间：17:11:36" itemprop="dateCreated datePublished" datetime="2025-09-20T10:28:48+08:00">2025-09-20</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

            <div class="post-description">本教程将详细介绍如何在Solana上创建ETF代币，包括结构设计、元数据管理和完整的创建流程</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>什么是ETF（Exchange Traded Fund）</strong>？<br>ETF是交易所交易基金，是一种可以在交易所买卖的投资基金。在区块链世界中，ETF代币代表一篮子底层资产的组合投资产品。</p>
<p><strong>区块链ETF的核心特点</strong>：</p>
<ol>
<li><strong>资产组合</strong>：一个ETF代币包含多种底层代币的权重配置</li>
<li><strong>自动化管理</strong>：通过智能合约自动执行投资策略</li>
<li><strong>流动性</strong>：可以像普通代币一样自由交易</li>
<li><strong>透明度</strong>：所有组合和操作都在链上公开透明</li>
</ol>
<p><strong>本教程实现的功能</strong>：</p>
<ul>
<li>创建ETF代币的mint账户</li>
<li>设置ETF的组成代币和权重配置</li>
<li>生成代币元数据（名称、符号、描述等）</li>
<li>建立完整的ETF信息存储结构</li>
</ul>
<h2 id="步骤1-定义ETF代币数据结构"><a href="#步骤1-定义ETF代币数据结构" class="headerlink" title="步骤1: 定义ETF代币数据结构"></a>步骤1: 定义ETF代币数据结构</h2><p><strong>目的</strong>：定义ETF代币的核心数据结构，包括基本信息和组成代币配置。</p>
<p><strong>文件位置</strong>：<code>../ibuidl-etf-dapp/anchor/programs/counter/src/states/etf_token.rs</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ETF代币的核心信息结构体</span></span><br><span class="line"><span class="comment">// 这个结构体存储了ETF的所有重要信息</span></span><br><span class="line"><span class="meta">#[account]</span></span><br><span class="line"><span class="meta">#[derive(InitSpace)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">EtfToken</span> &#123;</span><br><span class="line">    <span class="comment">// ETF代币的mint账户地址</span></span><br><span class="line">    <span class="comment">// mint账户是SPL Token标准中代表代币类型的账户</span></span><br><span class="line">    <span class="keyword">pub</span> mint_account: Pubkey,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ETF创建者的公钥地址</span></span><br><span class="line">    <span class="comment">// 用于权限控制和管理操作</span></span><br><span class="line">    <span class="keyword">pub</span> creator: Pubkey,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ETF创建时间戳（Unix时间戳）</span></span><br><span class="line">    <span class="comment">// 用于记录创建时间，便于排序和查询</span></span><br><span class="line">    <span class="keyword">pub</span> create_at: <span class="type">i64</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ETF的描述信息</span></span><br><span class="line">    <span class="comment">// 最大长度50个字符，用于详细说明ETF的投资策略</span></span><br><span class="line">    <span class="meta">#[max_len(50)]</span></span><br><span class="line">    <span class="keyword">pub</span> description: <span class="type">String</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ETF的组成代币列表</span></span><br><span class="line">    <span class="comment">// 最多包含10个不同的代币，每个代币有不同的权重</span></span><br><span class="line">    <span class="meta">#[max_len(10)]</span></span><br><span class="line">    <span class="keyword">pub</span> constitunent: <span class="type">Vec</span>&lt;EtfTokenConstituent&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ETF组成代币的结构体</span></span><br><span class="line"><span class="comment">// 定义了ETF中每个底层资产的配置</span></span><br><span class="line"><span class="meta">#[account]</span></span><br><span class="line"><span class="meta">#[derive(InitSpace)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">EtfTokenConstituent</span> &#123;</span><br><span class="line">    <span class="comment">// 组成代币的mint账户地址</span></span><br><span class="line">    <span class="comment">// 指向具体的SPL Token</span></span><br><span class="line">    <span class="keyword">pub</span> token: Pubkey,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 该代币在ETF中的权重（百分比）</span></span><br><span class="line">    <span class="comment">// 例如：权重为30表示该代币占ETF总价值的30%</span></span><br><span class="line">    <span class="comment">// 使用u16类型，支持0-65535的范围，足够表示百分比</span></span><br><span class="line">    <span class="keyword">pub</span> weight: <span class="type">u16</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">EtfToken</span> &#123;</span><br><span class="line">    <span class="comment">// PDA（Program Derived Address）种子前缀</span></span><br><span class="line">    <span class="comment">// 用于生成确定性的账户地址，确保每个ETF都有唯一地址</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">const</span> SEED_PREFIX: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> = <span class="string">&quot;etf_token_v3&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ETF代币的小数位数</span></span><br><span class="line">    <span class="comment">// 9位小数是Solana生态中的标准配置</span></span><br><span class="line">    <span class="comment">// 1个代币 = 1,000,000,000个最小单位</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">const</span> TOKEN_DECIMALS: <span class="type">u8</span> = <span class="number">9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义错误类型，用于处理ETF操作中的各种异常情况</span></span><br><span class="line"><span class="meta">#[error_code]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">TokenMintError</span> &#123;</span><br><span class="line">    <span class="comment">// 缺少必要账户的错误</span></span><br><span class="line">    <span class="comment">// 当指令执行时缺少必需的账户时抛出</span></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Lack of necessary accounts&quot;</span>)]</span></span><br><span class="line">    InvalidAccounts,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 余额不足错误</span></span><br><span class="line">    <span class="comment">// 当用户尝试操作但余额不够时抛出</span></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Insufficient balance&quot;</span>)]</span></span><br><span class="line">    InsufficientBalance,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>数据结构设计要点</strong>：</p>
<ul>
<li><strong>InitSpace宏</strong>：自动计算结构体所需的存储空间</li>
<li><strong>max_len属性</strong>：限制字符串和数组的最大长度，防止存储溢出</li>
<li><strong>权重设计</strong>：使用u16类型支持精确的百分比配置</li>
<li><strong>版本化种子</strong>：使用”v3”后缀支持未来的结构升级</li>
</ul>
<h2 id="步骤2-实现ETF代币创建指令"><a href="#步骤2-实现ETF代币创建指令" class="headerlink" title="步骤2: 实现ETF代币创建指令"></a>步骤2: 实现ETF代币创建指令</h2><p><strong>目的</strong>：实现完整的ETF创建流程，包括参数验证、mint账户创建、元数据设置等。</p>
<p><strong>文件位置</strong>：<code>../ibuidl-etf-dapp/anchor/programs/counter/src/instructions/etf_token_create.rs</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::states::&#123;EtfToken, EtfTokenConstituent&#125;;</span><br><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"><span class="keyword">use</span> anchor_spl::&#123;</span><br><span class="line">    metadata::&#123;</span><br><span class="line">        create_metadata_accounts_v3, mpl_token_metadata::types::DataV2, CreateMetadataAccountsV3,</span><br><span class="line">        Metadata,</span><br><span class="line">    &#125;,</span><br><span class="line">    token::&#123;Mint, Token&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ETF代币创建时需要的参数结构体</span></span><br><span class="line"><span class="comment">// 这些参数由客户端传入，用于配置新创建的ETF</span></span><br><span class="line"><span class="meta">#[account]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">EtfTokenArgs</span> &#123;</span><br><span class="line">    <span class="comment">// ETF代币的名称，例如：&quot;科技股ETF&quot;</span></span><br><span class="line">    <span class="keyword">pub</span> name: <span class="type">String</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ETF代币的交易符号，例如：&quot;TECH&quot;</span></span><br><span class="line">    <span class="comment">// 通常是3-5个字符的简短标识符</span></span><br><span class="line">    <span class="keyword">pub</span> symbol: <span class="type">String</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ETF的详细描述，解释投资策略和目标</span></span><br><span class="line">    <span class="keyword">pub</span> description: <span class="type">String</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ETF的元数据URL，指向包含详细信息的JSON文件</span></span><br><span class="line">    <span class="comment">// 遵循Metaplex元数据标准</span></span><br><span class="line">    <span class="keyword">pub</span> url: <span class="type">String</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ETF的组成代币配置列表</span></span><br><span class="line">    <span class="comment">// 定义了哪些代币以什么比例组成这个ETF</span></span><br><span class="line">    <span class="keyword">pub</span> constitunent: <span class="type">Vec</span>&lt;EtfTokenConstituent&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">EtfTokenArgs</span> &#123;</span><br><span class="line">    <span class="comment">// 🏗️ 从参数创建EtfToken实例的工厂方法</span></span><br><span class="line">    <span class="comment">// 将客户端传入的参数转换为链上存储的数据结构</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_account</span>(<span class="keyword">self</span>, creator: Pubkey, mint_account: Pubkey) <span class="punctuation">-&gt;</span> EtfToken &#123;</span><br><span class="line">        <span class="comment">// 获取当前区块链时间戳</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">clock</span> = Clock::<span class="title function_ invoke__">get</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建ETF代币信息结构体</span></span><br><span class="line">        EtfToken &#123;</span><br><span class="line">            creator,                           <span class="comment">// 设置创建者</span></span><br><span class="line">            mint_account,                      <span class="comment">// 设置mint账户地址</span></span><br><span class="line">            description: <span class="keyword">self</span>.description,     <span class="comment">// 使用传入的描述</span></span><br><span class="line">            constitunent: <span class="keyword">self</span>.constitunent,   <span class="comment">// 使用传入的组成配置</span></span><br><span class="line">            create_at: clock.unix_timestamp,   <span class="comment">// 记录创建时间</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🚀 ETF代币创建的核心实现函数</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">etf_token_create</span>(ctx: Context&lt;EtfTokenCreate&gt;, args: EtfTokenArgs) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// 获取ETF mint账户的公钥，用于生成PDA签名</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">m</span> = ctx.accounts.etf_token_mint_account.<span class="title function_ invoke__">key</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 🔐 构建PDA签名种子</span></span><br><span class="line">    <span class="comment">// PDA允许程序代表特定账户执行操作，这里用于mint权限控制</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">signer_seeds</span>: &amp;[&amp;[&amp;[<span class="type">u8</span>]]] = &amp;[&amp;[</span><br><span class="line">        EtfToken::SEED_PREFIX.<span class="title function_ invoke__">as_bytes</span>(),    <span class="comment">// &quot;etf_token_v3&quot;</span></span><br><span class="line">        m.<span class="title function_ invoke__">as_ref</span>(),                          <span class="comment">// mint账户地址</span></span><br><span class="line">        &amp;[ctx.bumps.etf_token_info],         <span class="comment">// bump值，确保PDA有效</span></span><br><span class="line">    ]];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 📝 创建代币元数据账户</span></span><br><span class="line">    <span class="comment">// 元数据包含代币的名称、符号、图片等信息，遵循Metaplex标准</span></span><br><span class="line">    <span class="title function_ invoke__">create_metadata_accounts_v3</span>(</span><br><span class="line">        CpiContext::<span class="title function_ invoke__">new_with_signer</span>(</span><br><span class="line">            <span class="comment">// 调用Metaplex Token Metadata程序</span></span><br><span class="line">            ctx.accounts.token_metadata_program.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">            CreateMetadataAccountsV3 &#123;</span><br><span class="line">                <span class="comment">// 元数据存储账户</span></span><br><span class="line">                metadata: ctx.accounts.metadata_account.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                <span class="comment">// 代币mint账户</span></span><br><span class="line">                mint: ctx.accounts.etf_token_mint_account.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                <span class="comment">// mint权限账户（由ETF信息PDA控制）</span></span><br><span class="line">                mint_authority: ctx.accounts.etf_token_info.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                <span class="comment">// 更新权限账户（同样由PDA控制）</span></span><br><span class="line">                update_authority: ctx.accounts.etf_token_info.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                <span class="comment">// 交易费用支付者</span></span><br><span class="line">                payer: ctx.accounts.authority.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                <span class="comment">// 系统程序（用于创建账户）</span></span><br><span class="line">                system_program: ctx.accounts.system_program.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                <span class="comment">// 租金程序（计算账户租金）</span></span><br><span class="line">                rent: ctx.accounts.rent.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">            &#125;,</span><br><span class="line">            signer_seeds <span class="comment">// 使用PDA签名授权操作</span></span><br><span class="line">        ),</span><br><span class="line">        <span class="comment">// 📋 元数据内容配置</span></span><br><span class="line">        DataV2 &#123;</span><br><span class="line">            name: args.name.<span class="title function_ invoke__">to_string</span>(),       <span class="comment">// 代币名称</span></span><br><span class="line">            symbol: args.symbol.<span class="title function_ invoke__">to_string</span>(),   <span class="comment">// 代币符号</span></span><br><span class="line">            uri: args.url.<span class="title function_ invoke__">to_string</span>(),         <span class="comment">// 元数据URI</span></span><br><span class="line">            seller_fee_basis_points: <span class="number">0</span>,        <span class="comment">// 创作者版税（0表示无版税）</span></span><br><span class="line">            creators: <span class="literal">None</span>,                    <span class="comment">// 创作者列表（暂不设置）</span></span><br><span class="line">            collection: <span class="literal">None</span>,                  <span class="comment">// 所属集合（暂不设置）</span></span><br><span class="line">            uses: <span class="literal">None</span>,                        <span class="comment">// 使用限制（暂不设置）</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="literal">false</span>,  <span class="comment">// is_mutable: 是否可变（false表示元数据不可更改）</span></span><br><span class="line">        <span class="literal">true</span>,   <span class="comment">// update_authority_is_signer: 更新权限是否为签名者</span></span><br><span class="line">        <span class="literal">None</span>    <span class="comment">// collection_details: 集合详情（暂不设置）</span></span><br><span class="line">    )?;</span><br><span class="line"></span><br><span class="line">    msg!(<span class="string">&quot;✅ Token mint and metadata created successfully&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 💾 保存ETF信息到链上账户</span></span><br><span class="line">    <span class="comment">// 使用set_inner方法将数据写入账户存储</span></span><br><span class="line">    ctx.accounts.etf_token_info.<span class="title function_ invoke__">set_inner</span>(</span><br><span class="line">        args.<span class="title function_ invoke__">create_account</span>(</span><br><span class="line">            ctx.accounts.etf_token_info.<span class="title function_ invoke__">key</span>(),      <span class="comment">// ETF信息账户地址作为创建者</span></span><br><span class="line">            ctx.accounts.etf_token_mint_account.<span class="title function_ invoke__">key</span>() <span class="comment">// mint账户地址</span></span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    msg!(<span class="string">&quot;🎉 ETF token creation completed successfully!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🏛️ ETF代币创建指令所需的账户结构</span></span><br><span class="line"><span class="comment">// 定义了创建ETF时需要传入的所有账户</span></span><br><span class="line"><span class="meta">#[derive(Accounts)]</span></span><br><span class="line"><span class="meta">#[instruction(args: EtfTokenArgs)]</span> <span class="comment">// 指令参数，用于账户验证</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">EtfTokenCreate</span>&lt;<span class="symbol">&#x27;info</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// ETF信息存储账户</span></span><br><span class="line">    <span class="comment">// 用于存储ETF的配置、组成代币等信息</span></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        init_if_needed,                         // 如果不存在则创建</span></span><br><span class="line"><span class="meta">        payer = authority,                      // 创建费用由authority支付</span></span><br><span class="line"><span class="meta">        space = 8 + EtfToken::INIT_SPACE,      // 账户大小（8字节discriminator + 数据大小）</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            EtfToken::SEED_PREFIX.as_bytes(),   // PDA种子：<span class="string">&quot;etf_token_v3&quot;</span></span></span><br><span class="line"><span class="meta">            etf_token_mint_account.key().as_ref(), // mint账户地址作为种子</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,                                   <span class="comment">// 自动寻找有效的bump值</span></span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> etf_token_info: Account&lt;<span class="symbol">&#x27;info</span>, EtfToken&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 代币元数据账户</span></span><br><span class="line">    <span class="comment">// 存储代币的名称、符号、图片等信息</span></span><br><span class="line">    <span class="comment">/// CHECK: 通过PDA派生验证地址的有效性</span></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        mut,                                    // 可变，因为要写入元数据</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            b<span class="string">&quot;metadata&quot;</span>,                        // Metaplex标准种子</span></span><br><span class="line"><span class="meta">            token_metadata_program.key().as_ref(), // Token Metadata程序ID</span></span><br><span class="line"><span class="meta">            etf_token_mint_account.key().as_ref(),  // mint账户地址</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,                                   <span class="comment">// 自动寻找bump值</span></span><br><span class="line">        seeds::program = token_metadata_program.<span class="title function_ invoke__">key</span>(), <span class="comment">// 指定种子程序</span></span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> metadata_account: UncheckedAccount&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ETF代币的mint账户</span></span><br><span class="line">    <span class="comment">// 这是实际的SPL Token mint，控制代币的发行</span></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        init,                                   // 创建新账户</span></span><br><span class="line"><span class="meta">        payer = authority,                      // 创建费用支付者</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            EtfToken::SEED_PREFIX.as_bytes(),   // PDA种子：<span class="string">&quot;etf_token_v3&quot;</span></span></span><br><span class="line"><span class="meta">            args.symbol.as_bytes(),             // 使用代币符号作为种子确保唯一性</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,                                   <span class="comment">// 自动寻找bump值</span></span><br><span class="line">        mint::decimals = EtfToken::TOKEN_DECIMALS, <span class="comment">// 设置小数位数为9</span></span><br><span class="line">        mint::authority = etf_token_info.<span class="title function_ invoke__">key</span>(), <span class="comment">// mint权限归ETF信息账户所有</span></span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> etf_token_mint_account: Account&lt;<span class="symbol">&#x27;info</span>, Mint&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 租金系统变量</span></span><br><span class="line">    <span class="comment">// 用于计算账户创建所需的最小余额</span></span><br><span class="line">    <span class="keyword">pub</span> rent: Sysvar&lt;<span class="symbol">&#x27;info</span>, Rent&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 交易授权者和费用支付者</span></span><br><span class="line">    <span class="comment">// 必须签名这笔交易</span></span><br><span class="line">    <span class="meta">#[account(mut)]</span> <span class="comment">// 可变，因为要支付交易费用</span></span><br><span class="line">    <span class="keyword">pub</span> authority: Signer&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 所需的程序账户</span></span><br><span class="line">    <span class="keyword">pub</span> token_metadata_program: Program&lt;<span class="symbol">&#x27;info</span>, Metadata&gt;,    <span class="comment">// Metaplex Token Metadata程序</span></span><br><span class="line">    <span class="keyword">pub</span> token_program: Program&lt;<span class="symbol">&#x27;info</span>, Token&gt;,                <span class="comment">// SPL Token程序</span></span><br><span class="line">    <span class="keyword">pub</span> system_program: Program&lt;<span class="symbol">&#x27;info</span>, System&gt;,              <span class="comment">// Solana系统程序</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键技术点解析</strong>：</p>
<h3 id="1-PDA（Program-Derived-Address）机制"><a href="#1-PDA（Program-Derived-Address）机制" class="headerlink" title="1. PDA（Program Derived Address）机制"></a>1. PDA（Program Derived Address）机制</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">seeds = [</span><br><span class="line">    EtfToken::SEED_PREFIX.<span class="title function_ invoke__">as_bytes</span>(),   <span class="comment">// 固定前缀</span></span><br><span class="line">    etf_token_mint_account.<span class="title function_ invoke__">key</span>().<span class="title function_ invoke__">as_ref</span>(), <span class="comment">// 变量部分</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p><strong>作用</strong>：</p>
<ul>
<li>生成确定性的账户地址</li>
<li>只有程序能控制这些地址</li>
<li>确保每个ETF都有唯一的标识</li>
</ul>
<h3 id="2-元数据标准集成"><a href="#2-元数据标准集成" class="headerlink" title="2. 元数据标准集成"></a>2. 元数据标准集成</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">create_metadata_accounts_v3</span>(<span class="comment">/* ... */</span>, DataV2 &#123;</span><br><span class="line">    name: args.name.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    symbol: args.symbol.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    uri: args.url.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>重要性</strong>：</p>
<ul>
<li>符合Metaplex元数据标准</li>
<li>钱包和交易所能正确显示代币信息</li>
<li>支持NFT市场集成</li>
</ul>
<h3 id="3-权限控制设计"><a href="#3-权限控制设计" class="headerlink" title="3. 权限控制设计"></a>3. 权限控制设计</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mint::authority = etf_token_info.<span class="title function_ invoke__">key</span>(), <span class="comment">// mint权限归PDA所有</span></span><br></pre></td></tr></table></figure>

<p><strong>安全考虑</strong>：</p>
<ul>
<li>防止未授权的代币增发</li>
<li>只有程序逻辑能控制供应量</li>
<li>透明的权限管理</li>
</ul>
<h2 id="步骤3-注册ETF创建指令"><a href="#步骤3-注册ETF创建指令" class="headerlink" title="步骤3: 注册ETF创建指令"></a>步骤3: 注册ETF创建指令</h2><p><strong>目的</strong>：在主程序中注册ETF创建指令，使其可以被客户端调用。</p>
<p><strong>文件位置</strong>：<code>../ibuidl-etf-dapp/anchor/programs/counter/src/lib.rs</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ETF代币创建指令的公共接口</span></span><br><span class="line"><span class="comment">// 这个函数暴露给客户端，用于创建新的ETF代币</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">etf_token_create</span>(ctx: Context&lt;EtfTokenCreate&gt;, args: EtfTokenArgs) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// 调用具体的ETF创建实现逻辑</span></span><br><span class="line">    <span class="comment">// 将复杂的业务逻辑封装在独立的模块中，保持主程序文件的简洁</span></span><br><span class="line">    instructions::<span class="title function_ invoke__">etf_token_create</span>(ctx, args)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>架构设计优势</strong>：</p>
<ul>
<li><strong>模块化</strong>：业务逻辑与接口分离</li>
<li><strong>可维护性</strong>：便于代码组织和更新</li>
<li><strong>可测试性</strong>：独立的功能模块便于单元测试</li>
</ul>
<h2 id="技术深度解析"><a href="#技术深度解析" class="headerlink" title="技术深度解析"></a>技术深度解析</h2><h3 id="1-账户空间计算"><a href="#1-账户空间计算" class="headerlink" title="1. 账户空间计算"></a>1. 账户空间计算</h3><h4 id="A-InitSpace宏的工作原理"><a href="#A-InitSpace宏的工作原理" class="headerlink" title="A. InitSpace宏的工作原理"></a>A. InitSpace宏的工作原理</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(InitSpace)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">EtfToken</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> mint_account: Pubkey,     <span class="comment">// 32字节</span></span><br><span class="line">    <span class="keyword">pub</span> creator: Pubkey,          <span class="comment">// 32字节</span></span><br><span class="line">    <span class="keyword">pub</span> create_at: <span class="type">i64</span>,           <span class="comment">// 8字节</span></span><br><span class="line">    <span class="meta">#[max_len(50)]</span></span><br><span class="line">    <span class="keyword">pub</span> description: <span class="type">String</span>,      <span class="comment">// 4 + 50字节（长度前缀 + 内容）</span></span><br><span class="line">    <span class="meta">#[max_len(10)]</span></span><br><span class="line">    <span class="keyword">pub</span> constitunent: <span class="type">Vec</span>&lt;EtfTokenConstituent&gt;, <span class="comment">// 4 + 10 * 结构体大小</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>计算方式</strong>：</p>
<ul>
<li><strong>固定字段</strong>：32 + 32 + 8 &#x3D; 72字节</li>
<li><strong>变长字符串</strong>：4 + 50 &#x3D; 54字节</li>
<li><strong>数组</strong>：4 + 10 * (32 + 2) &#x3D; 344字节</li>
<li><strong>总计</strong>：72 + 54 + 344 &#x3D; 470字节（约）</li>
</ul>
<h4 id="B-8字节discriminator"><a href="#B-8字节discriminator" class="headerlink" title="B. 8字节discriminator"></a>B. 8字节discriminator</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">space = <span class="number">8</span> + EtfToken::INIT_SPACE,</span><br></pre></td></tr></table></figure>

<p><strong>作用</strong>：</p>
<ul>
<li>账户类型标识符</li>
<li>防止账户类型混淆</li>
<li>Anchor框架自动添加</li>
</ul>
<h3 id="2-种子设计策略"><a href="#2-种子设计策略" class="headerlink" title="2. 种子设计策略"></a>2. 种子设计策略</h3><h4 id="A-多层次种子"><a href="#A-多层次种子" class="headerlink" title="A. 多层次种子"></a>A. 多层次种子</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ETF信息账户种子</span></span><br><span class="line">seeds = [</span><br><span class="line">    EtfToken::SEED_PREFIX.<span class="title function_ invoke__">as_bytes</span>(),      <span class="comment">// 类型标识</span></span><br><span class="line">    etf_token_mint_account.<span class="title function_ invoke__">key</span>().<span class="title function_ invoke__">as_ref</span>(), <span class="comment">// 关联标识</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mint账户种子</span></span><br><span class="line">seeds = [</span><br><span class="line">    EtfToken::SEED_PREFIX.<span class="title function_ invoke__">as_bytes</span>(),      <span class="comment">// 类型标识</span></span><br><span class="line">    args.symbol.<span class="title function_ invoke__">as_bytes</span>(),                <span class="comment">// 唯一标识</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>设计原则</strong>：</p>
<ul>
<li><strong>类型隔离</strong>：不同类型使用不同前缀</li>
<li><strong>唯一性保证</strong>：使用唯一标识符避免冲突</li>
<li><strong>关联性</strong>：相关账户使用相同的关联字段</li>
</ul>
<h3 id="3-错误处理机制"><a href="#3-错误处理机制" class="headerlink" title="3. 错误处理机制"></a>3. 错误处理机制</h3><h4 id="A-账户验证"><a href="#A-账户验证" class="headerlink" title="A. 账户验证"></a>A. 账户验证</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[account(</span></span><br><span class="line"><span class="meta">    init_if_needed,</span></span><br><span class="line"><span class="meta">    payer = authority,</span></span><br><span class="line"><span class="meta">    space = 8 + EtfToken::INIT_SPACE,</span></span><br><span class="line"><span class="meta">    // ...</span></span><br><span class="line"><span class="meta">)]</span></span><br></pre></td></tr></table></figure>

<p><strong>验证层次</strong>：</p>
<ol>
<li><strong>编译时验证</strong>：类型检查和约束验证</li>
<li><strong>运行时验证</strong>：种子、权限、余额检查</li>
<li><strong>业务逻辑验证</strong>：自定义验证规则</li>
</ol>
<h4 id="B-自定义错误"><a href="#B-自定义错误" class="headerlink" title="B. 自定义错误"></a>B. 自定义错误</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[error_code]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">TokenMintError</span> &#123;</span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Lack of necessary accounts&quot;</span>)]</span></span><br><span class="line">    InvalidAccounts,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>最佳实践</strong>：</p>
<ul>
<li>提供清晰的错误信息</li>
<li>使用有意义的错误代码</li>
<li>便于调试和用户反馈</li>
</ul>
<h3 id="4-元数据集成"><a href="#4-元数据集成" class="headerlink" title="4. 元数据集成"></a>4. 元数据集成</h3><h4 id="A-Metaplex标准"><a href="#A-Metaplex标准" class="headerlink" title="A. Metaplex标准"></a>A. Metaplex标准</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DataV2 &#123;</span><br><span class="line">    name: args.name.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    symbol: args.symbol.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    uri: args.url.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    seller_fee_basis_points: <span class="number">0</span>,</span><br><span class="line">    creators: <span class="literal">None</span>,</span><br><span class="line">    collection: <span class="literal">None</span>,</span><br><span class="line">    uses: <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>标准化好处</strong>：</p>
<ul>
<li>钱包兼容性</li>
<li>交易所集成</li>
<li>生态系统互操作性</li>
</ul>
<h3 id="5-权重配置设计"><a href="#5-权重配置设计" class="headerlink" title="5. 权重配置设计"></a>5. 权重配置设计</h3><h4 id="A-百分比系统"><a href="#A-百分比系统" class="headerlink" title="A. 百分比系统"></a>A. 百分比系统</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">EtfTokenConstituent</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> token: Pubkey,    <span class="comment">// 代币地址</span></span><br><span class="line">    <span class="keyword">pub</span> weight: <span class="type">u16</span>,      <span class="comment">// 权重（0-10000，支持0.01%精度）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>实际应用</strong>：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例ETF配置</span></span><br><span class="line"><span class="built_in">vec!</span>[</span><br><span class="line">    EtfTokenConstituent &#123; token: sol_mint, weight: <span class="number">4000</span> &#125;, <span class="comment">// 40%</span></span><br><span class="line">    EtfTokenConstituent &#123; token: usdc_mint, weight: <span class="number">3000</span> &#125;, <span class="comment">// 30%</span></span><br><span class="line">    EtfTokenConstituent &#123; token: btc_mint, weight: <span class="number">2000</span> &#125;, <span class="comment">// 20%</span></span><br><span class="line">    EtfTokenConstituent &#123; token: eth_mint, weight: <span class="number">1000</span> &#125;, <span class="comment">// 10%</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="扩展功能建议"><a href="#扩展功能建议" class="headerlink" title="扩展功能建议"></a>扩展功能建议</h2><h3 id="1-权重验证"><a href="#1-权重验证" class="headerlink" title="1. 权重验证"></a>1. 权重验证</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">EtfTokenArgs</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">validate_weights</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">total_weight</span>: <span class="type">u32</span> = <span class="keyword">self</span>.constitunent.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">map</span>(|c| c.weight <span class="keyword">as</span> <span class="type">u32</span>).<span class="title function_ invoke__">sum</span>();</span><br><span class="line">        require!(total_weight == <span class="number">10000</span>, TokenMintError::InvalidWeights);</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-重复代币检查"><a href="#2-重复代币检查" class="headerlink" title="2. 重复代币检查"></a>2. 重复代币检查</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">validate_unique_tokens</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">seen</span> = std::collections::HashSet::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">constituent</span> <span class="keyword">in</span> &amp;<span class="keyword">self</span>.constitunent &#123;</span><br><span class="line">        require!(seen.<span class="title function_ invoke__">insert</span>(constituent.token), TokenMintError::DuplicateToken);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-费用配置"><a href="#3-费用配置" class="headerlink" title="3. 费用配置"></a>3. 费用配置</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">EtfToken</span> &#123;</span><br><span class="line">    <span class="comment">// ... 现有字段</span></span><br><span class="line">    <span class="keyword">pub</span> management_fee: <span class="type">u16</span>,    <span class="comment">// 管理费率（基点）</span></span><br><span class="line">    <span class="keyword">pub</span> performance_fee: <span class="type">u16</span>,   <span class="comment">// 绩效费率（基点）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-动态权重调整"><a href="#4-动态权重调整" class="headerlink" title="4. 动态权重调整"></a>4. 动态权重调整</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">update_weights</span>(</span><br><span class="line">    ctx: Context&lt;UpdateWeights&gt;, </span><br><span class="line">    new_weights: <span class="type">Vec</span>&lt;EtfTokenConstituent&gt;</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// 只允许创建者更新权重</span></span><br><span class="line">    require!(ctx.accounts.etf_token.creator == ctx.accounts.authority.<span class="title function_ invoke__">key</span>());</span><br><span class="line">    ctx.accounts.etf_token.constitunent = new_weights;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="安全性考虑"><a href="#安全性考虑" class="headerlink" title="安全性考虑"></a>安全性考虑</h2><h3 id="1-权限控制"><a href="#1-权限控制" class="headerlink" title="1. 权限控制"></a>1. 权限控制</h3><ul>
<li><strong>创建者验证</strong>：确保只有授权用户能修改ETF</li>
<li><strong>PDA控制</strong>：关键操作由程序控制的PDA执行</li>
<li><strong>签名验证</strong>：所有敏感操作都需要数字签名</li>
</ul>
<h3 id="2-数据完整性"><a href="#2-数据完整性" class="headerlink" title="2. 数据完整性"></a>2. 数据完整性</h3><ul>
<li><strong>权重验证</strong>：确保权重总和为100%</li>
<li><strong>地址验证</strong>：验证所有代币地址的有效性</li>
<li><strong>范围检查</strong>：防止数值溢出和下溢</li>
</ul>
<h3 id="3-经济安全"><a href="#3-经济安全" class="headerlink" title="3. 经济安全"></a>3. 经济安全</h3><ul>
<li><strong>最小创建成本</strong>：防止垃圾ETF创建</li>
<li><strong>租金考虑</strong>：确保账户有足够余额维持存在</li>
<li><strong>费用设计</strong>：合理的费用结构防止滥用</li>
</ul>
<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><h3 id="1-创建科技股ETF"><a href="#1-创建科技股ETF" class="headerlink" title="1. 创建科技股ETF"></a>1. 创建科技股ETF</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">tech_etf_args</span> = EtfTokenArgs &#123;</span><br><span class="line">    name: <span class="string">&quot;Tech Stocks ETF&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    symbol: <span class="string">&quot;TECH&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    description: <span class="string">&quot;Diversified technology stocks fund&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    url: <span class="string">&quot;https://example.com/tech-etf.json&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    constitunent: <span class="built_in">vec!</span>[</span><br><span class="line">        EtfTokenConstituent &#123; token: aapl_mint, weight: <span class="number">3000</span> &#125;, <span class="comment">// 30%</span></span><br><span class="line">        EtfTokenConstituent &#123; token: msft_mint, weight: <span class="number">2500</span> &#125;, <span class="comment">// 25%</span></span><br><span class="line">        EtfTokenConstituent &#123; token: googl_mint, weight: <span class="number">2000</span> &#125;, <span class="comment">// 20%</span></span><br><span class="line">        EtfTokenConstituent &#123; token: amzn_mint, weight: <span class="number">1500</span> &#125;, <span class="comment">// 15%</span></span><br><span class="line">        EtfTokenConstituent &#123; token: tsla_mint, weight: <span class="number">1000</span> &#125;, <span class="comment">// 10%</span></span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-创建稳定币ETF"><a href="#2-创建稳定币ETF" class="headerlink" title="2. 创建稳定币ETF"></a>2. 创建稳定币ETF</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">stable_etf_args</span> = EtfTokenArgs &#123;</span><br><span class="line">    name: <span class="string">&quot;Stablecoin Basket&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    symbol: <span class="string">&quot;STABLE&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    description: <span class="string">&quot;Diversified stablecoin portfolio&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    url: <span class="string">&quot;https://example.com/stable-etf.json&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    constitunent: <span class="built_in">vec!</span>[</span><br><span class="line">        EtfTokenConstituent &#123; token: usdc_mint, weight: <span class="number">4000</span> &#125;, <span class="comment">// 40%</span></span><br><span class="line">        EtfTokenConstituent &#123; token: usdt_mint, weight: <span class="number">3000</span> &#125;, <span class="comment">// 30%</span></span><br><span class="line">        EtfTokenConstituent &#123; token: dai_mint, weight: <span class="number">2000</span> &#125;,  <span class="comment">// 20%</span></span><br><span class="line">        EtfTokenConstituent &#123; token: busd_mint, weight: <span class="number">1000</span> &#125;, <span class="comment">// 10%</span></span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这个完整的ETF创建教程展示了如何在Solana上构建专业级的金融产品。通过合理的数据结构设计、安全的权限控制和标准化的元数据管理，为用户提供了一个可靠的投资工具创建平台。</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/09/20/Solana-dapp-%E5%89%8D%E7%AB%AF%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B8%8E%E5%90%88%E7%BA%A6%E6%8E%A5%E5%85%A5/" rel="prev" title="Solana-dapp-前端单元测试与合约接入">
                  <i class="fa fa-angle-left"></i> Solana-dapp-前端单元测试与合约接入
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/09/20/Solana%E5%AE%9E%E6%88%98-%E5%88%9B%E5%BB%BAETF%E6%8C%87%E4%BB%A4%E7%9A%84%E8%B0%83%E7%94%A8/" rel="next" title="Solana实战-创建ETF指令的调用">
                  Solana实战-创建ETF指令的调用 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">samxie</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
