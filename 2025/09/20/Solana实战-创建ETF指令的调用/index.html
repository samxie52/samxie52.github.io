<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.24.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="本教程将展示如何使用TypeScript和Anchor框架来调用我们之前创建的ETF代币创建指令.">
<meta property="og:type" content="article">
<meta property="og:title" content="Solana实战-创建ETF指令的调用">
<meta property="og:url" content="http://example.com/2025/09/20/Solana%E5%AE%9E%E6%88%98-%E5%88%9B%E5%BB%BAETF%E6%8C%87%E4%BB%A4%E7%9A%84%E8%B0%83%E7%94%A8/index.html">
<meta property="og:site_name" content="samxie52">
<meta property="og:description" content="本教程将展示如何使用TypeScript和Anchor框架来调用我们之前创建的ETF代币创建指令.">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-09-20T09:25:19.000Z">
<meta property="article:modified_time" content="2025-09-21T02:42:34.735Z">
<meta property="article:author" content="samxie">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2025/09/20/Solana%E5%AE%9E%E6%88%98-%E5%88%9B%E5%BB%BAETF%E6%8C%87%E4%BB%A4%E7%9A%84%E8%B0%83%E7%94%A8/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2025/09/20/Solana%E5%AE%9E%E6%88%98-%E5%88%9B%E5%BB%BAETF%E6%8C%87%E4%BB%A4%E7%9A%84%E8%B0%83%E7%94%A8/","path":"2025/09/20/Solana实战-创建ETF指令的调用/","title":"Solana实战-创建ETF指令的调用"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Solana实战-创建ETF指令的调用 | samxie52</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">samxie52</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A41-%E9%85%8D%E7%BD%AEAnchor%E7%A8%8B%E5%BA%8F%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">2.</span> <span class="nav-text">步骤1: 配置Anchor程序客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Anchor-Provider%E6%A6%82%E5%BF%B5"><span class="nav-number">2.1.</span> <span class="nav-text">1. Anchor Provider概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%A8%8B%E5%BA%8F%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="nav-number">2.2.</span> <span class="nav-text">2. 程序实例化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%92%B1%E5%8C%85%E7%AE%A1%E7%90%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">2.3.</span> <span class="nav-text">3. 钱包管理最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%92%B1%E5%8C%85"><span class="nav-number">2.3.1.</span> <span class="nav-text">开发环境钱包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%92%B1%E5%8C%85"><span class="nav-number">2.3.2.</span> <span class="nav-text">生产环境钱包</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A42-%E5%AE%9E%E7%8E%B0%E5%9C%B0%E5%9D%80%E6%B4%BE%E7%94%9F%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0"><span class="nav-number">3.</span> <span class="nav-text">步骤2: 实现地址派生工具函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-PDA%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">3.1.</span> <span class="nav-text">1. PDA的工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%A7%8D%E5%AD%90%E8%AE%BE%E8%AE%A1%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7"><span class="nav-number">3.2.</span> <span class="nav-text">2. 种子设计的重要性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%94%AF%E4%B8%80%E6%80%A7%E4%BF%9D%E8%AF%81"><span class="nav-number">3.2.1.</span> <span class="nav-text">唯一性保证</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="nav-number">3.2.2.</span> <span class="nav-text">版本管理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="nav-number">3.3.</span> <span class="nav-text">3. 函数重载的优势</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%81%B5%E6%B4%BB%E6%80%A7"><span class="nav-number">3.3.1.</span> <span class="nav-text">灵活性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8"><span class="nav-number">3.3.2.</span> <span class="nav-text">类型安全</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A43-%E5%AE%9E%E7%8E%B0ETF%E4%BB%A3%E5%B8%81%E5%88%9B%E5%BB%BA%E9%80%BB%E8%BE%91"><span class="nav-number">4.</span> <span class="nav-text">步骤3: 实现ETF代币创建逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%85%B3%E8%81%94%E4%BB%A3%E5%B8%81%E8%B4%A6%E6%88%B7%EF%BC%88ATA%EF%BC%89%E6%9C%BA%E5%88%B6"><span class="nav-number">4.1.</span> <span class="nav-text">1. 关联代币账户（ATA）机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFATA%EF%BC%9F"><span class="nav-number">4.1.1.</span> <span class="nav-text">什么是ATA？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88ETF%E9%9C%80%E8%A6%81%E5%A4%9A%E4%B8%AAATA%EF%BC%9F"><span class="nav-number">4.1.2.</span> <span class="nav-text">为什么ETF需要多个ATA？</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BA%A4%E6%98%93%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.2.</span> <span class="nav-text">2. 交易构建模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E6%8C%87%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="nav-number">4.2.1.</span> <span class="nav-text">批量指令执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E9%A1%BA%E5%BA%8F%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7"><span class="nav-number">4.2.2.</span> <span class="nav-text">指令顺序的重要性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5"><span class="nav-number">4.3.</span> <span class="nav-text">3. 错误处理策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%82%E7%AD%89%E6%80%A7%E8%AE%BE%E8%AE%A1"><span class="nav-number">4.3.1.</span> <span class="nav-text">幂等性设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86"><span class="nav-number">4.3.2.</span> <span class="nav-text">具体错误类型处理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C%E7%AE%A1%E7%90%86"><span class="nav-number">4.4.</span> <span class="nav-text">4. 异步操作管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Promise%E5%B9%B6%E5%8F%91%E4%BC%98%E5%8C%96"><span class="nav-number">4.4.1.</span> <span class="nav-text">Promise并发优化</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A44-%E5%AE%9E%E7%8E%B0%E5%AE%8C%E6%95%B4%E7%9A%84%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">5.</span> <span class="nav-text">步骤4: 实现完整的调用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%92%B1%E5%8C%85%E9%80%89%E6%8B%A9%E7%AD%96%E7%95%A5"><span class="nav-number">5.1.</span> <span class="nav-text">1. 钱包选择策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83vs%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83"><span class="nav-number">5.1.1.</span> <span class="nav-text">开发环境vs测试环境</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ETF%E9%85%8D%E7%BD%AE%E8%AE%BE%E8%AE%A1"><span class="nav-number">5.2.</span> <span class="nav-text">2. ETF配置设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9D%83%E9%87%8D%E9%85%8D%E7%BD%AE%E7%AD%96%E7%95%A5"><span class="nav-number">5.2.1.</span> <span class="nav-text">权重配置策略</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%92%8C%E8%B0%83%E8%AF%95"><span class="nav-number">5.3.</span> <span class="nav-text">3. 错误处理和调试</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%A4%E6%98%93%E5%A4%B1%E8%B4%A5%E5%88%86%E6%9E%90"><span class="nav-number">5.3.1.</span> <span class="nav-text">交易失败分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7"><span class="nav-number">5.3.2.</span> <span class="nav-text">调试技巧</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD%E5%92%8C%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="nav-number">6.</span> <span class="nav-text">高级功能和优化建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%85%8D%E7%BD%AE%E9%AA%8C%E8%AF%81"><span class="nav-number">6.1.</span> <span class="nav-text">1. 配置验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%E4%BC%98%E5%8C%96"><span class="nav-number">6.2.</span> <span class="nav-text">2. 批量操作优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BA%A4%E6%98%93%E8%B4%B9%E7%94%A8%E4%BC%B0%E7%AE%97"><span class="nav-number">6.3.</span> <span class="nav-text">3. 交易费用估算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%85%83%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96"><span class="nav-number">6.4.</span> <span class="nav-text">4. 元数据标准化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%92%8C%E7%8A%B6%E6%80%81%E8%B7%9F%E8%B8%AA"><span class="nav-number">6.5.</span> <span class="nav-text">5. 事件监听和状态跟踪</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E4%BA%A4%E6%98%93%E9%87%8D%E8%AF%95%E6%9C%BA%E5%88%B6"><span class="nav-number">6.6.</span> <span class="nav-text">6. 交易重试机制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E7%9A%84%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B%E9%9B%86%E5%90%88"><span class="nav-number">7.</span> <span class="nav-text">完整的使用示例集合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E5%A4%9A%E6%A0%B7%E5%8C%96%E7%9A%84ETF%E7%BB%84%E5%90%88"><span class="nav-number">7.1.</span> <span class="nav-text">1. 创建多样化的ETF组合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%89%B9%E9%87%8F%E5%88%9B%E5%BB%BAETF"><span class="nav-number">7.2.</span> <span class="nav-text">2. 批量创建ETF</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E5%92%8C%E8%B0%83%E8%AF%95%E6%8C%87%E5%8D%97"><span class="nav-number">8.</span> <span class="nav-text">测试和调试指南</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%A4%BA%E4%BE%8B"><span class="nav-number">8.1.</span> <span class="nav-text">1. 单元测试示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95"><span class="nav-number">8.2.</span> <span class="nav-text">2. 集成测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">9.</span> <span class="nav-text">常见问题和解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BD%99%E9%A2%9D%E4%B8%8D%E8%B6%B3%E9%97%AE%E9%A2%98"><span class="nav-number">9.1.</span> <span class="nav-text">1. 余额不足问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-RPC%E9%99%90%E6%B5%81%E9%97%AE%E9%A2%98"><span class="nav-number">9.2.</span> <span class="nav-text">2. RPC限流问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BD%91%E7%BB%9C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">9.3.</span> <span class="nav-text">3. 网络错误处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="nav-number">10.</span> <span class="nav-text">性能优化建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%B9%B6%E8%A1%8C%E5%A4%84%E7%90%86"><span class="nav-number">10.1.</span> <span class="nav-text">1. 并行处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="nav-number">10.2.</span> <span class="nav-text">2. 缓存机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%89%B9%E9%87%8FRPC%E8%B0%83%E7%94%A8"><span class="nav-number">10.3.</span> <span class="nav-text">3. 批量RPC调用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">11.</span> <span class="nav-text">总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%94%A7-%E6%8A%80%E6%9C%AF%E6%A0%88%E6%8E%8C%E6%8F%A1"><span class="nav-number">11.1.</span> <span class="nav-text">🔧 技术栈掌握</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%9A-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E7%90%86%E8%A7%A3"><span class="nav-number">11.2.</span> <span class="nav-text">📚 核心概念理解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%9B%A0%EF%B8%8F-%E5%AE%9E%E8%B7%B5%E6%8A%80%E8%83%BD%E5%9F%B9%E5%85%BB"><span class="nav-number">11.3.</span> <span class="nav-text">🛠️ 实践技能培养</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%9A%80-%E6%89%A9%E5%B1%95%E8%83%BD%E5%8A%9B%E5%BB%BA%E8%AE%BE"><span class="nav-number">11.4.</span> <span class="nav-text">🚀 扩展能力建设</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%99%84%E5%BD%95%EF%BC%9A%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%E6%B8%85%E5%8D%95"><span class="nav-number">12.</span> <span class="nav-text">附录：完整代码清单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#A-package-json%E4%BE%9D%E8%B5%96"><span class="nav-number">12.1.</span> <span class="nav-text">A. package.json依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#B-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">12.2.</span> <span class="nav-text">B. 环境配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-TypeScript%E9%85%8D%E7%BD%AE"><span class="nav-number">12.3.</span> <span class="nav-text">C. TypeScript配置</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">samxie</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/20/Solana%E5%AE%9E%E6%88%98-%E5%88%9B%E5%BB%BAETF%E6%8C%87%E4%BB%A4%E7%9A%84%E8%B0%83%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="samxie">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="samxie52">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Solana实战-创建ETF指令的调用 | samxie52">
      <meta itemprop="description" content="本教程将展示如何使用TypeScript和Anchor框架来调用我们之前创建的ETF代币创建指令.">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Solana实战-创建ETF指令的调用
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-09-20 17:25:19" itemprop="dateCreated datePublished" datetime="2025-09-20T17:25:19+08:00">2025-09-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-21 10:42:34" itemprop="dateModified" datetime="2025-09-21T10:42:34+08:00">2025-09-21</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

            <div class="post-description">本教程将展示如何使用TypeScript和Anchor框架来调用我们之前创建的ETF代币创建指令.</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>什么是客户端调用</strong>？<br>在Solana生态中，智能合约（程序）部署在链上后，需要通过客户端代码来调用其功能。本教程将展示如何使用TypeScript和Anchor框架来调用我们之前创建的ETF代币创建指令。</p>
<p><strong>本教程涵盖的核心技术</strong>：</p>
<ol>
<li><strong>Anchor客户端配置</strong>：设置程序连接和钱包</li>
<li><strong>PDA地址派生</strong>：计算程序派生地址</li>
<li><strong>关联代币账户</strong>：为ETF创建必要的代币账户</li>
<li><strong>交易构建和发送</strong>：组装完整的创建交易</li>
</ol>
<p><strong>学习目标</strong>：</p>
<ul>
<li>理解Solana客户端架构</li>
<li>掌握PDA地址计算方法</li>
<li>学会处理关联代币账户</li>
<li>实现完整的ETF创建流程</li>
</ul>
<h2 id="步骤1-配置Anchor程序客户端"><a href="#步骤1-配置Anchor程序客户端" class="headerlink" title="步骤1: 配置Anchor程序客户端"></a>步骤1: 配置Anchor程序客户端</h2><p><strong>目的</strong>：建立与Solana网络和程序的连接，配置钱包用于签名交易。</p>
<p><strong>文件位置</strong>：<code>../ibuidl-etf-dapp/anchor/example/api/const.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Program</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Counter</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../target/types/counter&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 📡 获取环境配置的提供者（Provider）</span></span><br><span class="line"><span class="comment">// Provider封装了与Solana网络的连接配置，包括RPC端点、钱包等</span></span><br><span class="line"><span class="keyword">const</span> provider = anchor.<span class="property">AnchorProvider</span>.<span class="title function_">env</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🔧 设置全局提供者，让Anchor知道使用哪个网络连接</span></span><br><span class="line">anchor.<span class="title function_">setProvider</span>(provider);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🏗️ 获取程序实例</span></span><br><span class="line"><span class="comment">// Counter是通过anchor build生成的TypeScript类型定义</span></span><br><span class="line"><span class="comment">// 这个实例提供了所有程序指令的类型安全调用方法</span></span><br><span class="line"><span class="keyword">const</span> program = anchor.<span class="property">workspace</span>.<span class="property">Counter</span> <span class="keyword">as</span> <span class="title class_">Program</span>&lt;<span class="title class_">Counter</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出供其他模块使用</span></span><br><span class="line"><span class="keyword">export</span> &#123; program, provider &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🔑 使用默认钱包（通常是本地开发环境的钱包）</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useDefaultWallet</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// local()方法会读取本地Solana配置中的默认钱包</span></span><br><span class="line">    <span class="comment">// 通常是 ~/.config/solana/id.json 文件中的密钥对</span></span><br><span class="line">    <span class="keyword">const</span> wallet = anchor.<span class="property">Wallet</span>.<span class="title function_">local</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wallet</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🎭 使用预设的访客钱包</span></span><br><span class="line"><span class="comment">// Pubkey: jyre3oLXdJhtT958Vx9w8Syf5mUuhXTRiqW8v47ZVcd</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useVisitorWallet</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 🔐 从固定的私钥数组创建密钥对</span></span><br><span class="line">    <span class="comment">// 注意：生产环境中绝不应该硬编码私钥！</span></span><br><span class="line">    <span class="keyword">const</span> keypair = anchor.<span class="property">web3</span>.<span class="property">Keypair</span>.<span class="title function_">fromSecretKey</span>(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([</span><br><span class="line">            <span class="number">76</span>, <span class="number">39</span>, <span class="number">178</span>, <span class="number">2</span>, <span class="number">80</span>, <span class="number">192</span>, <span class="number">236</span>, <span class="number">106</span>,</span><br><span class="line">            <span class="number">176</span>, <span class="number">133</span>, <span class="number">251</span>, <span class="number">247</span>, <span class="number">21</span>, <span class="number">204</span>, <span class="number">188</span>, <span class="number">229</span>,</span><br><span class="line">            <span class="number">249</span>, <span class="number">243</span>, <span class="number">3</span>, <span class="number">61</span>, <span class="number">192</span>, <span class="number">237</span>, <span class="number">105</span>, <span class="number">245</span>,</span><br><span class="line">            <span class="number">199</span>, <span class="number">113</span>, <span class="number">185</span>, <span class="number">29</span>, <span class="number">121</span>, <span class="number">208</span>, <span class="number">216</span>, <span class="number">79</span>,</span><br><span class="line">            <span class="number">11</span>, <span class="number">2</span>, <span class="number">174</span>, <span class="number">91</span>, <span class="number">154</span>, <span class="number">3</span>, <span class="number">48</span>, <span class="number">129</span>,</span><br><span class="line">            <span class="number">231</span>, <span class="number">156</span>, <span class="number">187</span>, <span class="number">50</span>, <span class="number">99</span>, <span class="number">160</span>, <span class="number">80</span>, <span class="number">116</span>,</span><br><span class="line">            <span class="number">78</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">169</span>, <span class="number">0</span>, <span class="number">147</span>, <span class="number">34</span>, <span class="number">221</span>,</span><br><span class="line">            <span class="number">142</span>, <span class="number">199</span>, <span class="number">21</span>, <span class="number">64</span>, <span class="number">136</span>, <span class="number">132</span>, <span class="number">130</span>, <span class="number">2</span></span><br><span class="line">        ])</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 🎒 创建钱包实例</span></span><br><span class="line">    <span class="comment">// Wallet类包装了密钥对，提供签名功能</span></span><br><span class="line">    <span class="keyword">const</span> wallet = <span class="keyword">new</span> anchor.<span class="title class_">Wallet</span>(keypair);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wallet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>技术要点解析</strong>：</p>
<h3 id="1-Anchor-Provider概念"><a href="#1-Anchor-Provider概念" class="headerlink" title="1. Anchor Provider概念"></a>1. Anchor Provider概念</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> provider = anchor.<span class="property">AnchorProvider</span>.<span class="title function_">env</span>();</span><br></pre></td></tr></table></figure>

<p><strong>Provider的作用</strong>：</p>
<ul>
<li><strong>网络连接</strong>：管理与Solana RPC节点的连接</li>
<li><strong>钱包集成</strong>：处理交易签名</li>
<li><strong>配置管理</strong>：统一管理网络和钱包配置</li>
</ul>
<p><strong>环境变量配置</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ~/.bashrc 或 ~/.zshrc 中设置</span></span><br><span class="line"><span class="built_in">export</span> ANCHOR_PROVIDER_URL=<span class="string">&quot;https://api.devnet.solana.com&quot;</span></span><br><span class="line"><span class="built_in">export</span> ANCHOR_WALLET=<span class="string">&quot;~/.config/solana/id.json&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-程序实例化"><a href="#2-程序实例化" class="headerlink" title="2. 程序实例化"></a>2. 程序实例化</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> program = anchor.<span class="property">workspace</span>.<span class="property">Counter</span> <span class="keyword">as</span> <span class="title class_">Program</span>&lt;<span class="title class_">Counter</span>&gt;;</span><br></pre></td></tr></table></figure>

<p><strong>类型安全的好处</strong>：</p>
<ul>
<li><strong>自动补全</strong>：IDE可以提供指令和账户的自动补全</li>
<li><strong>类型检查</strong>：编译时发现参数类型错误</li>
<li><strong>文档集成</strong>：鼠标悬停显示参数说明</li>
</ul>
<h3 id="3-钱包管理最佳实践"><a href="#3-钱包管理最佳实践" class="headerlink" title="3. 钱包管理最佳实践"></a>3. 钱包管理最佳实践</h3><h4 id="开发环境钱包"><a href="#开发环境钱包" class="headerlink" title="开发环境钱包"></a>开发环境钱包</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wallet = anchor.<span class="property">Wallet</span>.<span class="title function_">local</span>(); <span class="comment">// ✅ 开发环境使用</span></span><br></pre></td></tr></table></figure>

<h4 id="生产环境钱包"><a href="#生产环境钱包" class="headerlink" title="生产环境钱包"></a>生产环境钱包</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 生产环境绝不这样做</span></span><br><span class="line"><span class="keyword">const</span> hardcodedWallet = <span class="keyword">new</span> anchor.<span class="title class_">Wallet</span>(keypair);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 生产环境推荐做法</span></span><br><span class="line"><span class="keyword">const</span> wallet = <span class="keyword">new</span> anchor.<span class="title class_">Wallet</span>(</span><br><span class="line">    anchor.<span class="property">web3</span>.<span class="property">Keypair</span>.<span class="title function_">fromSecretKey</span>(</span><br><span class="line">        <span class="title class_">Buffer</span>.<span class="title function_">from</span>(process.<span class="property">env</span>.<span class="property">PRIVATE_KEY</span>, <span class="string">&#x27;base64&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="步骤2-实现地址派生工具函数"><a href="#步骤2-实现地址派生工具函数" class="headerlink" title="步骤2: 实现地址派生工具函数"></a>步骤2: 实现地址派生工具函数</h2><p><strong>目的</strong>：实现PDA（程序派生地址）的计算逻辑，确保客户端能正确找到链上的ETF账户。</p>
<p><strong>文件位置</strong>：<code>../ibuidl-etf-dapp/anchor/example/api/address.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; program &#125; <span class="keyword">from</span> <span class="string">&quot;./const&quot;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PublicKey</span>&#125; <span class="keyword">from</span> <span class="string">&quot;@solana/web3.js&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 🏭 派生ETF代币的mint账户地址</span></span><br><span class="line"><span class="comment">// 这个函数计算ETF代币mint账户的PDA地址</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deriveEtfTokenMintAccount</span>(<span class="params"><span class="attr">symbol</span>: <span class="built_in">string</span></span>): [anchor.<span class="property">web3</span>.<span class="property">PublicKey</span>, <span class="built_in">number</span>] &#123;</span><br><span class="line">    <span class="comment">// 🔍 使用findProgramAddressSync寻找有效的PDA</span></span><br><span class="line">    <span class="comment">// 这个函数会尝试不同的bump值，直到找到一个有效的地址</span></span><br><span class="line">    <span class="keyword">return</span> anchor.<span class="property">web3</span>.<span class="property">PublicKey</span>.<span class="title function_">findProgramAddressSync</span>(</span><br><span class="line">        [</span><br><span class="line">            <span class="comment">// 🏷️ 种子1：固定的类型标识符</span></span><br><span class="line">            <span class="comment">// 必须与Rust程序中定义的SEED_PREFIX完全一致</span></span><br><span class="line">            <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&quot;etf_token_v3&quot;</span>),</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 🏷️ 种子2：代币符号，确保每个符号都有唯一地址</span></span><br><span class="line">            <span class="comment">// 将字符串转换为Buffer，作为PDA种子的一部分</span></span><br><span class="line">            <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="built_in">symbol</span>)</span><br><span class="line">        ],</span><br><span class="line">        program.<span class="property">programId</span>, <span class="comment">// 使用我们程序的ID来派生地址</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🗂️ 派生ETF信息存储账户地址</span></span><br><span class="line"><span class="comment">// 支持两种调用方式：通过symbol或直接通过mintAccount</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deriveEtfTokenInfoAccount</span>(<span class="params"><span class="attr">symbol</span>: <span class="built_in">string</span></span>): [anchor.<span class="property">web3</span>.<span class="property">PublicKey</span>, <span class="built_in">number</span>];</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deriveEtfTokenInfoAccount</span>(<span class="params"><span class="attr">mintAccount</span>: <span class="title class_">PublicKey</span></span>): [anchor.<span class="property">web3</span>.<span class="property">PublicKey</span>, <span class="built_in">number</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 📋 函数重载的具体实现</span></span><br><span class="line"><span class="comment">// TypeScript的函数重载允许同一函数接受不同类型的参数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deriveEtfTokenInfoAccount</span>(<span class="params"><span class="attr">seeds</span>: <span class="built_in">string</span> | <span class="title class_">PublicKey</span></span>): [anchor.<span class="property">web3</span>.<span class="property">PublicKey</span>, <span class="built_in">number</span>] &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">mintAccount</span>: <span class="title class_">PublicKey</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 🔀 根据参数类型进行不同处理</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> seeds === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// 如果传入的是字符串（symbol），先派生对应的mint账户地址</span></span><br><span class="line">        [mintAccount,] = <span class="title function_">deriveEtfTokenMintAccount</span>(seeds);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果传入的是PublicKey，直接使用</span></span><br><span class="line">        mintAccount = seeds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 🏗️ 使用mint账户地址作为种子派生ETF信息账户地址</span></span><br><span class="line">    <span class="comment">// 这确保了每个ETF的信息账户与其mint账户唯一关联</span></span><br><span class="line">    <span class="keyword">return</span> anchor.<span class="property">web3</span>.<span class="property">PublicKey</span>.<span class="title function_">findProgramAddressSync</span>(</span><br><span class="line">        [</span><br><span class="line">            <span class="comment">// 🏷️ 种子1：固定的类型标识符</span></span><br><span class="line">            <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&quot;etf_token_v3&quot;</span>),</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 🏷️ 种子2：mint账户地址，建立关联关系</span></span><br><span class="line">            mintAccount.<span class="title function_">toBuffer</span>()</span><br><span class="line">        ],</span><br><span class="line">        program.<span class="property">programId</span>, <span class="comment">// 使用程序ID派生</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>PDA机制深度解析</strong>：</p>
<h3 id="1-PDA的工作原理"><a href="#1-PDA的工作原理" class="headerlink" title="1. PDA的工作原理"></a>1. PDA的工作原理</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">PublicKey</span>.<span class="title function_">findProgramAddressSync</span>(seeds, programId)</span><br></pre></td></tr></table></figure>

<p><strong>寻址过程</strong>：</p>
<ol>
<li>将种子和程序ID组合</li>
<li>尝试不同的bump值（255到0）</li>
<li>找到第一个不在Ed25519曲线上的点</li>
<li>返回地址和对应的bump值</li>
</ol>
<p><strong>为什么需要bump值</strong>？</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数学原理：确保地址不在椭圆曲线上</span></span><br><span class="line"><span class="comment">// 这样就无法生成对应的私钥，只有程序能控制这个地址</span></span><br><span class="line"><span class="keyword">const</span> [pda, bump] = <span class="title class_">PublicKey</span>.<span class="title function_">findProgramAddressSync</span>(seeds, programId);</span><br></pre></td></tr></table></figure>

<h3 id="2-种子设计的重要性"><a href="#2-种子设计的重要性" class="headerlink" title="2. 种子设计的重要性"></a>2. 种子设计的重要性</h3><h4 id="唯一性保证"><a href="#唯一性保证" class="headerlink" title="唯一性保证"></a>唯一性保证</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 好的种子设计</span></span><br><span class="line">[<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&quot;etf_token_v3&quot;</span>), <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="built_in">symbol</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 可能冲突的设计</span></span><br><span class="line">[<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&quot;etf&quot;</span>), <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="built_in">symbol</span>)]</span><br></pre></td></tr></table></figure>

<h4 id="版本管理"><a href="#版本管理" class="headerlink" title="版本管理"></a>版本管理</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支持程序升级时的数据迁移</span></span><br><span class="line"><span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&quot;etf_token_v3&quot;</span>) <span class="comment">// v3版本的ETF结构</span></span><br></pre></td></tr></table></figure>

<h3 id="3-函数重载的优势"><a href="#3-函数重载的优势" class="headerlink" title="3. 函数重载的优势"></a>3. 函数重载的优势</h3><h4 id="灵活性"><a href="#灵活性" class="headerlink" title="灵活性"></a>灵活性</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两种调用方式都支持</span></span><br><span class="line"><span class="keyword">const</span> [infoAccount1] = <span class="title function_">deriveEtfTokenInfoAccount</span>(<span class="string">&quot;TECH&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> [infoAccount2] = <span class="title function_">deriveEtfTokenInfoAccount</span>(mintAccount);</span><br></pre></td></tr></table></figure>

<h4 id="类型安全"><a href="#类型安全" class="headerlink" title="类型安全"></a>类型安全</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TypeScript会进行类型检查</span></span><br><span class="line"><span class="title function_">deriveEtfTokenInfoAccount</span>(<span class="number">123</span>); <span class="comment">// ❌ 编译错误</span></span><br><span class="line"><span class="title function_">deriveEtfTokenInfoAccount</span>(<span class="string">&quot;TECH&quot;</span>); <span class="comment">// ✅ 正确</span></span><br></pre></td></tr></table></figure>

<h2 id="步骤3-实现ETF代币创建逻辑"><a href="#步骤3-实现ETF代币创建逻辑" class="headerlink" title="步骤3: 实现ETF代币创建逻辑"></a>步骤3: 实现ETF代币创建逻辑</h2><p><strong>目的</strong>：实现完整的ETF创建流程，包括关联代币账户创建、交易构建和发送。</p>
<p><strong>文件位置</strong>：<code>../ibuidl-etf-dapp/anchor/example/api/etf_token.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; program, provider &#125; <span class="keyword">from</span> <span class="string">&quot;./const&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PublicKey</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@solana/web3.js&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  createAssociatedTokenAccountInstruction,</span><br><span class="line">  getAccount,</span><br><span class="line">  getAssociatedTokenAddressSync,</span><br><span class="line">  getMint,</span><br><span class="line">  <span class="title class_">TokenAccountNotFoundError</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@solana/spl-token&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; deriveEtfTokenMintAccount, deriveEtfTokenInfoAccount &#125; <span class="keyword">from</span> <span class="string">&quot;./address&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🏗️ 创建ETF代币mint账户的主要函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createTokenMintAccount</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">wallet</span>: anchor.<span class="title class_">Wallet</span>,      <span class="comment">// 交易签名者的钱包</span></span></span><br><span class="line"><span class="params">    <span class="attr">name</span>: <span class="built_in">string</span>,               <span class="comment">// ETF名称，如&quot;科技股ETF&quot;</span></span></span><br><span class="line"><span class="params">    <span class="attr">symbol</span>: <span class="built_in">string</span>,             <span class="comment">// ETF符号，如&quot;TECH&quot;</span></span></span><br><span class="line"><span class="params">    <span class="attr">description</span>: <span class="built_in">string</span>,        <span class="comment">// ETF描述信息</span></span></span><br><span class="line"><span class="params">    <span class="attr">url</span>: <span class="built_in">string</span>,               <span class="comment">// 元数据JSON文件的URL</span></span></span><br><span class="line"><span class="params">    <span class="attr">constituent</span>: &#123;token: PublicKey, weight: <span class="built_in">number</span>&#125;[] <span class="comment">// 组成代币配置</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 🎯 步骤1: 派生ETF mint账户地址</span></span><br><span class="line">    <span class="keyword">const</span> [etfAddress] = <span class="title function_">deriveEtfTokenMintAccount</span>(<span class="built_in">symbol</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ETF Address: <span class="subst">$&#123;etfAddress&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 🔍 步骤2: 检查ETF是否已经存在</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 尝试获取mint账户信息</span></span><br><span class="line">        <span class="comment">// 如果成功，说明ETF已存在，直接返回</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">getMint</span>(provider.<span class="property">connection</span>, etfAddress);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ETF already exists, skipping creation&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="comment">// 如果失败，说明ETF不存在，需要创建</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ETF not exists, creating it...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 🗂️ 步骤3: 派生ETF信息存储账户地址</span></span><br><span class="line">    <span class="keyword">const</span> [etfInfoAddress] = <span class="title function_">deriveEtfTokenInfoAccount</span>(etfAddress);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 📋 步骤4: 创建交易对象</span></span><br><span class="line">    <span class="comment">// Transaction用于包含多个指令，原子性执行</span></span><br><span class="line">    <span class="keyword">const</span> tx = <span class="keyword">new</span> anchor.<span class="property">web3</span>.<span class="title class_">Transaction</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 🪙 步骤5: 为每个组成代币创建关联代币账户</span></span><br><span class="line">    <span class="comment">// 关联代币账户（ATA）用于ETF持有各种底层代币</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> &#123;token&#125; <span class="keyword">of</span> constituent) &#123;</span><br><span class="line">        <span class="comment">// 🔗 计算关联代币账户地址</span></span><br><span class="line">        <span class="comment">// getAssociatedTokenAddressSync根据所有者和mint计算ATA地址</span></span><br><span class="line">        <span class="comment">// 这里ETF mint账户作为所有者，组成代币作为mint</span></span><br><span class="line">        <span class="keyword">const</span> address = <span class="title function_">getAssociatedTokenAddressSync</span>(</span><br><span class="line">            token,      <span class="comment">// mint账户（组成代币的mint）</span></span><br><span class="line">            etfAddress, <span class="comment">// 所有者（ETF mint账户）</span></span><br><span class="line">            <span class="literal">true</span>        <span class="comment">// allowOwnerOffCurve: 允许PDA作为所有者</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 🔍 检查关联代币账户是否已存在</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">getAccount</span>(provider.<span class="property">connection</span>, address);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Found existing associated token account: <span class="subst">$&#123;address&#125;</span>`</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="comment">// 🏗️ 如果账户不存在，添加创建指令到交易中</span></span><br><span class="line">            <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="title class_">TokenAccountNotFoundError</span>) &#123;</span><br><span class="line">                tx.<span class="title function_">add</span>(</span><br><span class="line">                    <span class="title function_">createAssociatedTokenAccountInstruction</span>(</span><br><span class="line">                        wallet.<span class="property">payer</span>.<span class="property">publicKey</span>, <span class="comment">// 支付创建费用的账户</span></span><br><span class="line">                        address,                <span class="comment">// 要创建的ATA地址</span></span><br><span class="line">                        etfAddress,            <span class="comment">// ATA的所有者（ETF mint）</span></span><br><span class="line">                        token,                 <span class="comment">// ATA对应的mint（组成代币）</span></span><br><span class="line">                    )</span><br><span class="line">                );</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Added instruction to create ATA: <span class="subst">$&#123;address&#125;</span>`</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 如果是其他错误，重新抛出</span></span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 🎯 步骤6: 构建ETF创建指令</span></span><br><span class="line">    <span class="keyword">const</span> ix = <span class="keyword">await</span> program.<span class="property">methods</span></span><br><span class="line">        .<span class="title function_">etfTokenCreate</span>(&#123;</span><br><span class="line">            name,           <span class="comment">// ETF名称</span></span><br><span class="line">            <span class="built_in">symbol</span>,         <span class="comment">// ETF符号</span></span><br><span class="line">            description,    <span class="comment">// ETF描述</span></span><br><span class="line">            url,           <span class="comment">// 元数据URL</span></span><br><span class="line">            constituent    <span class="comment">// 组成代币配置</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">transaction</span>(); <span class="comment">// 转换为Transaction对象</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ➕ 步骤7: 将ETF创建指令添加到交易中</span></span><br><span class="line">    tx.<span class="title function_">add</span>(ix);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 🚀 步骤8: 发送并确认交易</span></span><br><span class="line">    <span class="comment">// sendAndConfirmTransaction会等待交易被确认后返回</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> anchor.<span class="property">web3</span>.<span class="title function_">sendAndConfirmTransaction</span>(</span><br><span class="line">        provider.<span class="property">connection</span>,  <span class="comment">// RPC连接</span></span><br><span class="line">        tx,                  <span class="comment">// 要发送的交易</span></span><br><span class="line">        [wallet.<span class="property">payer</span>]       <span class="comment">// 签名者数组</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>核心技术概念解析</strong>：</p>
<h3 id="1-关联代币账户（ATA）机制"><a href="#1-关联代币账户（ATA）机制" class="headerlink" title="1. 关联代币账户（ATA）机制"></a>1. 关联代币账户（ATA）机制</h3><h4 id="什么是ATA？"><a href="#什么是ATA？" class="headerlink" title="什么是ATA？"></a>什么是ATA？</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ataAddress = <span class="title function_">getAssociatedTokenAddressSync</span>(mint, owner, allowOwnerOffCurve);</span><br></pre></td></tr></table></figure>

<p><strong>ATA的作用</strong>：</p>
<ul>
<li>每个钱包对每种代币都有一个确定的ATA地址</li>
<li>简化代币转账，无需记住复杂的代币账户地址</li>
<li>标准化代币账户管理</li>
</ul>
<h4 id="为什么ETF需要多个ATA？"><a href="#为什么ETF需要多个ATA？" class="headerlink" title="为什么ETF需要多个ATA？"></a>为什么ETF需要多个ATA？</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ETF需要持有多种底层代币</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> &#123;token&#125; <span class="keyword">of</span> constituent) &#123;</span><br><span class="line">    <span class="keyword">const</span> ataAddress = <span class="title function_">getAssociatedTokenAddressSync</span>(token, etfAddress, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// 为每种组成代币创建对应的ATA</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>实际场景</strong>：</p>
<ul>
<li>如果ETF包含SOL、USDC、BTC三种代币</li>
<li>就需要创建三个不同的ATA来分别持有这些代币</li>
</ul>
<h3 id="2-交易构建模式"><a href="#2-交易构建模式" class="headerlink" title="2. 交易构建模式"></a>2. 交易构建模式</h3><h4 id="批量指令执行"><a href="#批量指令执行" class="headerlink" title="批量指令执行"></a>批量指令执行</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tx = <span class="keyword">new</span> anchor.<span class="property">web3</span>.<span class="title class_">Transaction</span>();</span><br><span class="line">tx.<span class="title function_">add</span>(instruction1);</span><br><span class="line">tx.<span class="title function_">add</span>(instruction2);</span><br><span class="line"><span class="comment">// 所有指令要么全部成功，要么全部失败</span></span><br></pre></td></tr></table></figure>

<p><strong>原子性保证</strong>：</p>
<ul>
<li>如果任何一个指令失败，整个交易回滚</li>
<li>确保ETF创建的完整性</li>
</ul>
<h4 id="指令顺序的重要性"><a href="#指令顺序的重要性" class="headerlink" title="指令顺序的重要性"></a>指令顺序的重要性</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 正确顺序：先创建ATA，再创建ETF</span></span><br><span class="line">tx.<span class="title function_">add</span>(createATAInstruction);</span><br><span class="line">tx.<span class="title function_">add</span>(createETFInstruction);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 错误顺序：可能导致ETF创建失败</span></span><br><span class="line">tx.<span class="title function_">add</span>(createETFInstruction);</span><br><span class="line">tx.<span class="title function_">add</span>(createATAInstruction);</span><br></pre></td></tr></table></figure>

<h3 id="3-错误处理策略"><a href="#3-错误处理策略" class="headerlink" title="3. 错误处理策略"></a>3. 错误处理策略</h3><h4 id="幂等性设计"><a href="#幂等性设计" class="headerlink" title="幂等性设计"></a>幂等性设计</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">getMint</span>(provider.<span class="property">connection</span>, etfAddress);</span><br><span class="line">    <span class="keyword">return</span>; <span class="comment">// ETF已存在，直接返回</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// ETF不存在，继续创建</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>幂等性的好处</strong>：</p>
<ul>
<li>多次调用相同参数的函数，结果保持一致</li>
<li>避免重复创建导致的错误</li>
<li>提高系统健壮性</li>
</ul>
<h4 id="具体错误类型处理"><a href="#具体错误类型处理" class="headerlink" title="具体错误类型处理"></a>具体错误类型处理</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="title class_">TokenAccountNotFoundError</span>) &#123;</span><br><span class="line">    <span class="comment">// 具体的错误类型，采用相应的处理策略</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> e; <span class="comment">// 未知错误，重新抛出</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-异步操作管理"><a href="#4-异步操作管理" class="headerlink" title="4. 异步操作管理"></a>4. 异步操作管理</h3><h4 id="Promise并发优化"><a href="#Promise并发优化" class="headerlink" title="Promise并发优化"></a>Promise并发优化</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🐌 串行执行（较慢）</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> &#123;token&#125; <span class="keyword">of</span> constituent) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">checkAndCreateATA</span>(token);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🚀 并行执行（更快）</span></span><br><span class="line"><span class="keyword">const</span> promises = constituent.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123;token&#125;</span>) =&gt;</span> <span class="title function_">checkAndCreateATA</span>(token));</span><br><span class="line"><span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(promises);</span><br></pre></td></tr></table></figure>

<p><strong>性能考虑</strong>：</p>
<ul>
<li>网络请求是主要的性能瓶颈</li>
<li>合理使用并发可以显著提高速度</li>
<li>但要注意RPC限流问题</li>
</ul>
<h2 id="步骤4-实现完整的调用示例"><a href="#步骤4-实现完整的调用示例" class="headerlink" title="步骤4: 实现完整的调用示例"></a>步骤4: 实现完整的调用示例</h2><p><strong>目的</strong>：提供完整的ETF创建使用示例，演示如何组合所有功能模块。</p>
<p><strong>文件位置</strong>：<code>../ibuidl-etf-dapp/anchor/example/index.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; deriveEtfTokenMintAccount &#125; <span class="keyword">from</span> <span class="string">&quot;./api/address&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useDefaultWallet, useVisitorWallet &#125; <span class="keyword">from</span> <span class="string">&quot;./api/const&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createTokenMintAccount &#125; <span class="keyword">from</span> <span class="string">&quot;./api/etf_token&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🚀 主函数：演示ETF创建的完整流程</span></span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 🔑 步骤1: 获取钱包实例</span></span><br><span class="line">    <span class="keyword">const</span> defaultWallet = <span class="title function_">useDefaultWallet</span>();   <span class="comment">// 本地默认钱包</span></span><br><span class="line">    <span class="keyword">const</span> visitorWallet = <span class="title function_">useVisitorWallet</span>();   <span class="comment">// 预设的测试钱包</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 📊 步骤2: 定义ETF基本信息</span></span><br><span class="line">    <span class="comment">// 这里创建一个名为&quot;yama3&quot;的测试ETF</span></span><br><span class="line">    <span class="keyword">const</span> [name, <span class="built_in">symbol</span>, description, url] = [</span><br><span class="line">        <span class="string">&quot;yama3&quot;</span>,                    <span class="comment">// ETF名称</span></span><br><span class="line">        <span class="string">&quot;YAMA3&quot;</span>,                   <span class="comment">// ETF交易符号</span></span><br><span class="line">        <span class="string">&quot;yama3 description&quot;</span>,       <span class="comment">// ETF描述</span></span><br><span class="line">        <span class="string">&quot;https://note-public-img.oss-cn-beijing.aliyuncs.com/nya/nya.json&quot;</span> <span class="comment">// 元数据URL</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 🏗️ 步骤3: 调用创建函数</span></span><br><span class="line">        <span class="keyword">const</span> transactionSignature = <span class="keyword">await</span> <span class="title function_">createTokenMintAccount</span>(</span><br><span class="line">            defaultWallet,  <span class="comment">// 使用默认钱包签名交易</span></span><br><span class="line">            name,           <span class="comment">// ETF名称</span></span><br><span class="line">            <span class="built_in">symbol</span>,         <span class="comment">// ETF符号</span></span><br><span class="line">            description,    <span class="comment">// ETF描述</span></span><br><span class="line">            url,           <span class="comment">// 元数据URL</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 📈 ETF组成配置：定义包含哪些代币及其权重</span></span><br><span class="line">            [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 第一个组成代币：占10%权重</span></span><br><span class="line">                    <span class="attr">token</span>: <span class="keyword">new</span> anchor.<span class="property">web3</span>.<span class="title class_">PublicKey</span>(<span class="string">&quot;7mAKyqdEovoH5VJaRCFRVAuo4dHH2sk79s2pvxjF24mM&quot;</span>),</span><br><span class="line">                    <span class="attr">weight</span>: <span class="number">10</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 第二个组成代币：占90%权重</span></span><br><span class="line">                    <span class="attr">token</span>: <span class="keyword">new</span> anchor.<span class="property">web3</span>.<span class="title class_">PublicKey</span>(<span class="string">&quot;9z65UmYiVSpFbLHqA5di8K8ZvHkqAXdKd7NroNWdemZJ&quot;</span>),</span><br><span class="line">                    <span class="attr">weight</span>: <span class="number">90</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ✅ 成功处理</span></span><br><span class="line">        <span class="keyword">if</span> (transactionSignature) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;🎉 ETF创建成功!&quot;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`📋 交易签名: <span class="subst">$&#123;transactionSignature&#125;</span>`</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 🔗 派生ETF地址用于验证</span></span><br><span class="line">            <span class="keyword">const</span> [etfMintAddress] = <span class="title function_">deriveEtfTokenMintAccount</span>(<span class="built_in">symbol</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`🏷️  ETF Mint地址: <span class="subst">$&#123;etfMintAddress.toString()&#125;</span>`</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 🌐 提供Solana Explorer链接</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`🔍 在Explorer中查看: https://explorer.solana.com/tx/<span class="subst">$&#123;transactionSignature&#125;</span>?cluster=devnet`</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ℹ️  ETF已存在，跳过创建&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="comment">// ❌ 错误处理</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;💥 ETF创建失败:&quot;</span>, error);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 🔍 详细错误信息分析</span></span><br><span class="line">        <span class="keyword">if</span> (error <span class="keyword">instanceof</span> anchor.<span class="property">web3</span>.<span class="property">SendTransactionError</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;📋 交易错误详情:&quot;</span>, error.<span class="property">logs</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error.<span class="property">message</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;📝 错误消息:&quot;</span>, error.<span class="property">message</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p><strong>完整流程分析</strong>：</p>
<h3 id="1-钱包选择策略"><a href="#1-钱包选择策略" class="headerlink" title="1. 钱包选择策略"></a>1. 钱包选择策略</h3><h4 id="开发环境vs测试环境"><a href="#开发环境vs测试环境" class="headerlink" title="开发环境vs测试环境"></a>开发环境vs测试环境</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🏠 开发环境：使用本地配置的钱包</span></span><br><span class="line"><span class="keyword">const</span> wallet = <span class="title function_">useDefaultWallet</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🧪 测试环境：使用预设的测试钱包</span></span><br><span class="line"><span class="keyword">const</span> wallet = <span class="title function_">useVisitorWallet</span>();</span><br></pre></td></tr></table></figure>

<p><strong>选择原则</strong>：</p>
<ul>
<li><strong>开发环境</strong>：使用<code>solana-keygen new</code>创建的本地钱包</li>
<li><strong>测试环境</strong>：使用固定的测试钱包确保结果可重现</li>
<li><strong>生产环境</strong>：使用硬件钱包或安全的密钥管理服务</li>
</ul>
<h3 id="2-ETF配置设计"><a href="#2-ETF配置设计" class="headerlink" title="2. ETF配置设计"></a>2. ETF配置设计</h3><h4 id="权重配置策略"><a href="#权重配置策略" class="headerlink" title="权重配置策略"></a>权重配置策略</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123; <span class="attr">token</span>: tokenA, <span class="attr">weight</span>: <span class="number">10</span> &#125;,  <span class="comment">// 10%</span></span><br><span class="line">    &#123; <span class="attr">token</span>: tokenB, <span class="attr">weight</span>: <span class="number">90</span> &#125;,  <span class="comment">// 90%</span></span><br><span class="line">]</span><br><span class="line"><span class="comment">// 总权重：100%</span></span><br></pre></td></tr></table></figure>

<p><strong>实际应用场景</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🏢 科技股ETF配置</span></span><br><span class="line">[</span><br><span class="line">    &#123; <span class="attr">token</span>: <span class="variable constant_">AAPL_MINT</span>, <span class="attr">weight</span>: <span class="number">30</span> &#125;, <span class="comment">// 苹果30%</span></span><br><span class="line">    &#123; <span class="attr">token</span>: <span class="variable constant_">MSFT_MINT</span>, <span class="attr">weight</span>: <span class="number">25</span> &#125;, <span class="comment">// 微软25%</span></span><br><span class="line">    &#123; <span class="attr">token</span>: <span class="variable constant_">GOOGL_MINT</span>, <span class="attr">weight</span>: <span class="number">20</span> &#125;, <span class="comment">// 谷歌20%</span></span><br><span class="line">    &#123; <span class="attr">token</span>: <span class="variable constant_">TSLA_MINT</span>, <span class="attr">weight</span>: <span class="number">15</span> &#125;, <span class="comment">// 特斯拉15%</span></span><br><span class="line">    &#123; <span class="attr">token</span>: <span class="variable constant_">NVDA_MINT</span>, <span class="attr">weight</span>: <span class="number">10</span> &#125;, <span class="comment">// 英伟达10%</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 💰 稳定币ETF配置</span></span><br><span class="line">[</span><br><span class="line">    &#123; <span class="attr">token</span>: <span class="variable constant_">USDC_MINT</span>, <span class="attr">weight</span>: <span class="number">40</span> &#125;, <span class="comment">// USDC 40%</span></span><br><span class="line">    &#123; <span class="attr">token</span>: <span class="variable constant_">USDT_MINT</span>, <span class="attr">weight</span>: <span class="number">30</span> &#125;, <span class="comment">// USDT 30%</span></span><br><span class="line">    &#123; <span class="attr">token</span>: <span class="variable constant_">DAI_MINT</span>, <span class="attr">weight</span>: <span class="number">20</span> &#125;,  <span class="comment">// DAI 20%</span></span><br><span class="line">    &#123; <span class="attr">token</span>: <span class="variable constant_">BUSD_MINT</span>, <span class="attr">weight</span>: <span class="number">10</span> &#125;, <span class="comment">// BUSD 10%</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="3-错误处理和调试"><a href="#3-错误处理和调试" class="headerlink" title="3. 错误处理和调试"></a>3. 错误处理和调试</h3><h4 id="交易失败分析"><a href="#交易失败分析" class="headerlink" title="交易失败分析"></a>交易失败分析</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (error <span class="keyword">instanceof</span> anchor.<span class="property">web3</span>.<span class="property">SendTransactionError</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Transaction logs:&quot;</span>, error.<span class="property">logs</span>);</span><br><span class="line">    <span class="comment">// 通过日志分析具体的失败原因</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>常见错误类型</strong>：</p>
<ol>
<li><strong>余额不足</strong>：钱包SOL余额不够支付交易费用</li>
<li><strong>账户已存在</strong>：尝试创建已存在的账户</li>
<li><strong>权限错误</strong>：签名者权限不足</li>
<li><strong>网络错误</strong>：RPC连接超时或失败</li>
</ol>
<h4 id="调试技巧"><a href="#调试技巧" class="headerlink" title="调试技巧"></a>调试技巧</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🔍 添加详细日志</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Creating ETF with config:&quot;</span>, &#123;</span><br><span class="line">    name, <span class="built_in">symbol</span>, description,</span><br><span class="line">    <span class="attr">constituent</span>: constituent.<span class="title function_">map</span>(<span class="function"><span class="params">c</span> =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">token</span>: c.<span class="property">token</span>.<span class="title function_">toString</span>(),</span><br><span class="line">        <span class="attr">weight</span>: c.<span class="property">weight</span></span><br><span class="line">    &#125;))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 📊 检查权重总和</span></span><br><span class="line"><span class="keyword">const</span> totalWeight = constituent.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, c</span>) =&gt;</span> sum + c.<span class="property">weight</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Total weight: <span class="subst">$&#123;totalWeight&#125;</span>%`</span>);</span><br></pre></td></tr></table></figure>

<h2 id="高级功能和优化建议"><a href="#高级功能和优化建议" class="headerlink" title="高级功能和优化建议"></a>高级功能和优化建议</h2><h3 id="1-配置验证"><a href="#1-配置验证" class="headerlink" title="1. 配置验证"></a>1. 配置验证</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加到createTokenMintAccount函数开头</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validateETFConfig</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">name</span>: <span class="built_in">string</span>, </span></span><br><span class="line"><span class="params">    <span class="attr">symbol</span>: <span class="built_in">string</span>, </span></span><br><span class="line"><span class="params">    <span class="attr">constituent</span>: &#123;token: PublicKey, weight: <span class="built_in">number</span>&#125;[]</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 验证名称长度</span></span><br><span class="line">    <span class="keyword">if</span> (name.<span class="property">length</span> === <span class="number">0</span> || name.<span class="property">length</span> &gt; <span class="number">50</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;ETF名称长度必须在1-50个字符之间&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证符号格式</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/^[A-Z]&#123;2,10&#125;$/</span>.<span class="title function_">test</span>(<span class="built_in">symbol</span>)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;ETF符号必须是2-10个大写字母&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证权重总和</span></span><br><span class="line">    <span class="keyword">const</span> totalWeight = constituent.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, c</span>) =&gt;</span> sum + c.<span class="property">weight</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (totalWeight !== <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`权重总和必须为100%，当前为<span class="subst">$&#123;totalWeight&#125;</span>%`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证最少组成代币数量</span></span><br><span class="line">    <span class="keyword">if</span> (constituent.<span class="property">length</span> &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;ETF至少需要包含2种代币&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证代币地址唯一性</span></span><br><span class="line">    <span class="keyword">const</span> tokenSet = <span class="keyword">new</span> <span class="title class_">Set</span>(constituent.<span class="title function_">map</span>(<span class="function"><span class="params">c</span> =&gt;</span> c.<span class="property">token</span>.<span class="title function_">toString</span>()));</span><br><span class="line">    <span class="keyword">if</span> (tokenSet.<span class="property">size</span> !== constituent.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;ETF不能包含重复的代币&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-批量操作优化"><a href="#2-批量操作优化" class="headerlink" title="2. 批量操作优化"></a>2. 批量操作优化</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 并行检查所有ATA账户</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">checkATAsBatch</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">connection</span>: <span class="title class_">Connection</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">etfAddress</span>: <span class="title class_">PublicKey</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">tokens</span>: <span class="title class_">PublicKey</span>[]</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> ataAddresses = tokens.<span class="title function_">map</span>(<span class="function"><span class="params">token</span> =&gt;</span> </span><br><span class="line">        <span class="title function_">getAssociatedTokenAddressSync</span>(token, etfAddress, <span class="literal">true</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 批量获取账户信息</span></span><br><span class="line">    <span class="keyword">const</span> accountInfos = <span class="keyword">await</span> connection.<span class="title function_">getMultipleAccountsInfo</span>(ataAddresses);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ataAddresses.<span class="title function_">map</span>(<span class="function">(<span class="params">address, index</span>) =&gt;</span> (&#123;</span><br><span class="line">        address,</span><br><span class="line">        <span class="attr">exists</span>: accountInfos[index] !== <span class="literal">null</span></span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-交易费用估算"><a href="#3-交易费用估算" class="headerlink" title="3. 交易费用估算"></a>3. 交易费用估算</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">estimateCreationCost</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">connection</span>: <span class="title class_">Connection</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">constituent</span>: &#123;token: PublicKey, weight: <span class="built_in">number</span>&#125;[]</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取当前的租金费率</span></span><br><span class="line">    <span class="keyword">const</span> rentExemptBalance = <span class="keyword">await</span> connection.<span class="title function_">getMinimumBalanceForRentExemption</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算需要创建的账户数量</span></span><br><span class="line">    <span class="keyword">const</span> numATAs = constituent.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">const</span> numDataAccounts = <span class="number">2</span>; <span class="comment">// ETF info + mint账户</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 估算总成本</span></span><br><span class="line">    <span class="keyword">const</span> estimatedCost = &#123;</span><br><span class="line">        <span class="attr">rent</span>: rentExemptBalance * (numATAs + numDataAccounts),</span><br><span class="line">        <span class="attr">transactionFee</span>: <span class="number">5000</span>, <span class="comment">// 约0.000005 SOL</span></span><br><span class="line">        <span class="attr">total</span>: <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    estimatedCost.<span class="property">total</span> = estimatedCost.<span class="property">rent</span> + estimatedCost.<span class="property">transactionFee</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> estimatedCost;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-元数据标准化"><a href="#4-元数据标准化" class="headerlink" title="4. 元数据标准化"></a>4. 元数据标准化</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建符合Metaplex标准的元数据JSON</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateETFMetadata</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">name</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">symbol</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">description</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">constituent</span>: &#123;token: PublicKey, weight: <span class="built_in">number</span>&#125;[],</span></span><br><span class="line"><span class="params">    <span class="attr">imageUrl</span>?: <span class="built_in">string</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        name,</span><br><span class="line">        <span class="built_in">symbol</span>,</span><br><span class="line">        description,</span><br><span class="line">        <span class="attr">image</span>: imageUrl || <span class="string">&quot;https://example.com/default-etf-logo.png&quot;</span>,</span><br><span class="line">        <span class="attr">attributes</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">trait_type</span>: <span class="string">&quot;Type&quot;</span>,</span><br><span class="line">                <span class="attr">value</span>: <span class="string">&quot;ETF&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">trait_type</span>: <span class="string">&quot;Components&quot;</span>,</span><br><span class="line">                <span class="attr">value</span>: constituent.<span class="property">length</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">trait_type</span>: <span class="string">&quot;Created&quot;</span>,</span><br><span class="line">                <span class="attr">value</span>: <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>()</span><br><span class="line">            &#125;,</span><br><span class="line">            ...constituent.<span class="title function_">map</span>(<span class="function">(<span class="params">comp, index</span>) =&gt;</span> (&#123;</span><br><span class="line">                <span class="attr">trait_type</span>: <span class="string">`Component <span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>`</span>,</span><br><span class="line">                <span class="attr">value</span>: <span class="string">`<span class="subst">$&#123;comp.token.toString().slice(<span class="number">0</span>, <span class="number">8</span>)&#125;</span>... (<span class="subst">$&#123;comp.weight&#125;</span>%)`</span></span><br><span class="line">            &#125;))</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">properties</span>: &#123;</span><br><span class="line">            <span class="attr">category</span>: <span class="string">&quot;ETF&quot;</span>,</span><br><span class="line">            <span class="attr">files</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">uri</span>: imageUrl || <span class="string">&quot;https://example.com/default-etf-logo.png&quot;</span>,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&quot;image/png&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">constituent</span>: constituent.<span class="title function_">map</span>(<span class="function"><span class="params">comp</span> =&gt;</span> (&#123;</span><br><span class="line">                <span class="attr">token</span>: comp.<span class="property">token</span>.<span class="title function_">toString</span>(),</span><br><span class="line">                <span class="attr">weight</span>: comp.<span class="property">weight</span>,</span><br><span class="line">                <span class="attr">percentage</span>: comp.<span class="property">weight</span> / <span class="number">100</span></span><br><span class="line">            &#125;))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-事件监听和状态跟踪"><a href="#5-事件监听和状态跟踪" class="headerlink" title="5. 事件监听和状态跟踪"></a>5. 事件监听和状态跟踪</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听ETF创建事件</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">watchETFCreation</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">connection</span>: <span class="title class_">Connection</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">etfMintAddress</span>: <span class="title class_">PublicKey</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">callback</span>: (status: <span class="built_in">string</span>) =&gt; <span class="built_in">void</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">callback</span>(<span class="string">&quot;🔍 开始监听ETF创建进度...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听账户变化</span></span><br><span class="line">    <span class="keyword">const</span> subscriptionId = connection.<span class="title function_">onAccountChange</span>(</span><br><span class="line">        etfMintAddress,</span><br><span class="line">        <span class="function">(<span class="params">accountInfo</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (accountInfo.<span class="property">data</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="title function_">callback</span>(<span class="string">&quot;✅ ETF Mint账户创建成功!&quot;</span>);</span><br><span class="line">                connection.<span class="title function_">removeAccountChangeListener</span>(subscriptionId);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 超时处理</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        connection.<span class="title function_">removeAccountChangeListener</span>(subscriptionId);</span><br><span class="line">        <span class="title function_">callback</span>(<span class="string">&quot;⏰ 监听超时，请检查交易状态&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">30000</span>); <span class="comment">// 30秒超时</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-交易重试机制"><a href="#6-交易重试机制" class="headerlink" title="6. 交易重试机制"></a>6. 交易重试机制</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createETFWithRetry</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">wallet</span>: anchor.<span class="title class_">Wallet</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">name</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">symbol</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">description</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">url</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">constituent</span>: &#123;token: PublicKey, weight: <span class="built_in">number</span>&#125;[],</span></span><br><span class="line"><span class="params">    <span class="attr">maxRetries</span>: <span class="built_in">number</span> = <span class="number">3</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">string</span> | <span class="literal">undefined</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">lastError</span>: <span class="title class_">Error</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> attempt = <span class="number">1</span>; attempt &lt;= maxRetries; attempt++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`🔄 尝试创建ETF (第<span class="subst">$&#123;attempt&#125;</span>次)`</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">createTokenMintAccount</span>(</span><br><span class="line">                wallet, name, <span class="built_in">symbol</span>, description, url, constituent</span><br><span class="line">            );</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`✅ 第<span class="subst">$&#123;attempt&#125;</span>次尝试成功!`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            lastError = error <span class="keyword">as</span> <span class="title class_">Error</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`❌ 第<span class="subst">$&#123;attempt&#125;</span>次尝试失败: <span class="subst">$&#123;error.message&#125;</span>`</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (attempt &lt; maxRetries) &#123;</span><br><span class="line">                <span class="comment">// 指数退避：等待时间逐渐增加</span></span><br><span class="line">                <span class="keyword">const</span> waitTime = <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, attempt) * <span class="number">1000</span>;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`⏳ 等待 <span class="subst">$&#123;waitTime&#125;</span>ms 后重试...`</span>);</span><br><span class="line">                <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, waitTime));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`创建失败，已重试<span class="subst">$&#123;maxRetries&#125;</span>次: <span class="subst">$&#123;lastError.message&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="完整的使用示例集合"><a href="#完整的使用示例集合" class="headerlink" title="完整的使用示例集合"></a>完整的使用示例集合</h2><h3 id="1-创建多样化的ETF组合"><a href="#1-创建多样化的ETF组合" class="headerlink" title="1. 创建多样化的ETF组合"></a>1. 创建多样化的ETF组合</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 🏢 科技股ETF</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createTechETF</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> techETF = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;Technology Stocks ETF&quot;</span>,</span><br><span class="line">        <span class="attr">symbol</span>: <span class="string">&quot;TECH&quot;</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&quot;A diversified portfolio of leading technology companies&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;https://your-domain.com/metadata/tech-etf.json&quot;</span>,</span><br><span class="line">        <span class="attr">constituent</span>: [</span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;TokenA_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">30</span> &#125;, <span class="comment">// 大型科技股</span></span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;TokenB_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">25</span> &#125;, <span class="comment">// 云计算</span></span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;TokenC_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">20</span> &#125;, <span class="comment">// 人工智能</span></span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;TokenD_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">15</span> &#125;, <span class="comment">// 半导体</span></span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;TokenE_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">10</span> &#125;, <span class="comment">// 新兴科技</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">createTokenMintAccount</span>(</span><br><span class="line">        <span class="title function_">useDefaultWallet</span>(),</span><br><span class="line">        techETF.<span class="property">name</span>,</span><br><span class="line">        techETF.<span class="property">symbol</span>,</span><br><span class="line">        techETF.<span class="property">description</span>,</span><br><span class="line">        techETF.<span class="property">url</span>,</span><br><span class="line">        techETF.<span class="property">constituent</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 🏥 医疗健康ETF</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createHealthETF</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> healthETF = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;Healthcare Innovation ETF&quot;</span>,</span><br><span class="line">        <span class="attr">symbol</span>: <span class="string">&quot;HEALTH&quot;</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&quot;Investment in pharmaceutical and biotech companies&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;https://your-domain.com/metadata/health-etf.json&quot;</span>,</span><br><span class="line">        <span class="attr">constituent</span>: [</span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;PharmA_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">35</span> &#125;, <span class="comment">// 制药巨头</span></span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;BiotechB_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">25</span> &#125;, <span class="comment">// 生物技术</span></span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;MedDeviceC_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">20</span> &#125;, <span class="comment">// 医疗设备</span></span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;HealthTechD_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">20</span> &#125;, <span class="comment">// 健康科技</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">createTokenMintAccount</span>(</span><br><span class="line">        <span class="title function_">useDefaultWallet</span>(),</span><br><span class="line">        healthETF.<span class="property">name</span>,</span><br><span class="line">        healthETF.<span class="property">symbol</span>,</span><br><span class="line">        healthETF.<span class="property">description</span>,</span><br><span class="line">        healthETF.<span class="property">url</span>,</span><br><span class="line">        healthETF.<span class="property">constituent</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 💰 稳定收益ETF</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createStableETF</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> stableETF = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;Stable Income ETF&quot;</span>,</span><br><span class="line">        <span class="attr">symbol</span>: <span class="string">&quot;STABLE&quot;</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&quot;Conservative portfolio focused on stable returns&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;https://your-domain.com/metadata/stable-etf.json&quot;</span>,</span><br><span class="line">        <span class="attr">constituent</span>: [</span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;USDC_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">40</span> &#125;, <span class="comment">// USDC稳定币</span></span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;USDT_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">30</span> &#125;, <span class="comment">// USDT稳定币</span></span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;DAI_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">20</span> &#125;,  <span class="comment">// DAI去中心化稳定币</span></span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;BUSD_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">10</span> &#125;, <span class="comment">// BUSD稳定币</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">createTokenMintAccount</span>(</span><br><span class="line">        <span class="title function_">useDefaultWallet</span>(),</span><br><span class="line">        stableETF.<span class="property">name</span>,</span><br><span class="line">        stableETF.<span class="property">symbol</span>,</span><br><span class="line">        stableETF.<span class="property">description</span>,</span><br><span class="line">        stableETF.<span class="property">url</span>,</span><br><span class="line">        stableETF.<span class="property">constituent</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-批量创建ETF"><a href="#2-批量创建ETF" class="headerlink" title="2. 批量创建ETF"></a>2. 批量创建ETF</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createMultipleETFs</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> etfConfigs = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;DeFi Leaders ETF&quot;</span>,</span><br><span class="line">            <span class="attr">symbol</span>: <span class="string">&quot;DEFI&quot;</span>,</span><br><span class="line">            <span class="attr">description</span>: <span class="string">&quot;Top DeFi protocol tokens&quot;</span>,</span><br><span class="line">            <span class="attr">constituent</span>: [</span><br><span class="line">                &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;UNI_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">25</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;AAVE_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">25</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;COMP_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">25</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;MKR_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">25</span> &#125;,</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;Gaming Tokens ETF&quot;</span>,</span><br><span class="line">            <span class="attr">symbol</span>: <span class="string">&quot;GAME&quot;</span>,</span><br><span class="line">            <span class="attr">description</span>: <span class="string">&quot;Blockchain gaming and metaverse tokens&quot;</span>,</span><br><span class="line">            <span class="attr">constituent</span>: [</span><br><span class="line">                &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;AXS_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">30</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;SAND_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">25</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;MANA_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">25</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&quot;ENJ_PublicKey&quot;</span>), <span class="attr">weight</span>: <span class="number">20</span> &#125;,</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> results = [];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> config <span class="keyword">of</span> etfConfigs) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`🚀 创建 <span class="subst">$&#123;config.<span class="built_in">symbol</span>&#125;</span> ETF...`</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">createETFWithRetry</span>(</span><br><span class="line">                <span class="title function_">useDefaultWallet</span>(),</span><br><span class="line">                config.<span class="property">name</span>,</span><br><span class="line">                config.<span class="property">symbol</span>,</span><br><span class="line">                config.<span class="property">description</span>,</span><br><span class="line">                <span class="string">`https://your-domain.com/metadata/<span class="subst">$&#123;config.<span class="built_in">symbol</span>.toLowerCase()&#125;</span>-etf.json`</span>,</span><br><span class="line">                config.<span class="property">constituent</span></span><br><span class="line">            );</span><br><span class="line">            </span><br><span class="line">            results.<span class="title function_">push</span>(&#123;</span><br><span class="line">                <span class="attr">symbol</span>: config.<span class="property">symbol</span>,</span><br><span class="line">                <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">transactionSignature</span>: result</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`✅ <span class="subst">$&#123;config.<span class="built_in">symbol</span>&#125;</span> 创建成功!`</span>);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`❌ <span class="subst">$&#123;config.<span class="built_in">symbol</span>&#125;</span> 创建失败:`</span>, error.<span class="property">message</span>);</span><br><span class="line">            results.<span class="title function_">push</span>(&#123;</span><br><span class="line">                <span class="attr">symbol</span>: config.<span class="property">symbol</span>,</span><br><span class="line">                <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">error</span>: error.<span class="property">message</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 避免RPC限流，在创建之间添加延迟</span></span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">2000</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> results;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试和调试指南"><a href="#测试和调试指南" class="headerlink" title="测试和调试指南"></a>测试和调试指南</h2><h3 id="1-单元测试示例"><a href="#1-单元测试示例" class="headerlink" title="1. 单元测试示例"></a>1. 单元测试示例</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; expect &#125; <span class="keyword">from</span> <span class="string">&#x27;chai&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Connection</span>, <span class="title class_">PublicKey</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@solana/web3.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;ETF Creation Tests&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">connection</span>: <span class="title class_">Connection</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">before</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        connection = <span class="keyword">new</span> <span class="title class_">Connection</span>(<span class="string">&#x27;https://api.devnet.solana.com&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;应该正确派生ETF mint地址&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="built_in">symbol</span> = <span class="string">&#x27;TEST&#x27;</span>;</span><br><span class="line">        <span class="keyword">const</span> [mintAddress, bump] = <span class="title function_">deriveEtfTokenMintAccount</span>(<span class="built_in">symbol</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="title function_">expect</span>(mintAddress).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">instanceOf</span>(<span class="title class_">PublicKey</span>);</span><br><span class="line">        <span class="title function_">expect</span>(bump).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">a</span>(<span class="string">&#x27;number&#x27;</span>);</span><br><span class="line">        <span class="title function_">expect</span>(bump).<span class="property">to</span>.<span class="property">be</span>.<span class="property">at</span>.<span class="title function_">least</span>(<span class="number">0</span>).<span class="property">and</span>.<span class="property">at</span>.<span class="title function_">most</span>(<span class="number">255</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;应该验证ETF配置参数&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> validConfig = [</span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&#x27;11111111111111111111111111111112&#x27;</span>), <span class="attr">weight</span>: <span class="number">50</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&#x27;11111111111111111111111111111113&#x27;</span>), <span class="attr">weight</span>: <span class="number">50</span> &#125;,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="title function_">expect</span>(<span class="function">() =&gt;</span> <span class="title function_">validateETFConfig</span>(<span class="string">&#x27;TestETF&#x27;</span>, <span class="string">&#x27;TEST&#x27;</span>, validConfig)).<span class="property">to</span>.<span class="property">not</span>.<span class="keyword">throw</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> invalidConfig = [</span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&#x27;11111111111111111111111111111112&#x27;</span>), <span class="attr">weight</span>: <span class="number">60</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&#x27;11111111111111111111111111111113&#x27;</span>), <span class="attr">weight</span>: <span class="number">50</span> &#125;, <span class="comment">// 总和110%</span></span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="title function_">expect</span>(<span class="function">() =&gt;</span> <span class="title function_">validateETFConfig</span>(<span class="string">&#x27;TestETF&#x27;</span>, <span class="string">&#x27;TEST&#x27;</span>, invalidConfig)).<span class="property">to</span>.<span class="keyword">throw</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2-集成测试"><a href="#2-集成测试" class="headerlink" title="2. 集成测试"></a>2. 集成测试</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;ETF Integration Tests&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;应该成功创建完整的ETF&#x27;</span>, <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">timeout</span>(<span class="number">60000</span>); <span class="comment">// 增加超时时间</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> testWallet = <span class="title function_">useVisitorWallet</span>();</span><br><span class="line">        <span class="keyword">const</span> <span class="built_in">symbol</span> = <span class="string">`TEST<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>`</span>; <span class="comment">// 使用时间戳确保唯一性</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">createTokenMintAccount</span>(</span><br><span class="line">            testWallet,</span><br><span class="line">            <span class="string">&#x27;Test ETF&#x27;</span>,</span><br><span class="line">            <span class="built_in">symbol</span>,</span><br><span class="line">            <span class="string">&#x27;Integration test ETF&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;https://example.com/test.json&#x27;</span>,</span><br><span class="line">            [</span><br><span class="line">                &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&#x27;So11111111111111111111111111111111111111112&#x27;</span>), <span class="attr">weight</span>: <span class="number">70</span> &#125;, <span class="comment">// SOL</span></span><br><span class="line">                &#123; <span class="attr">token</span>: <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&#x27;EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v&#x27;</span>), <span class="attr">weight</span>: <span class="number">30</span> &#125;, <span class="comment">// USDC</span></span><br><span class="line">            ]</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="title function_">expect</span>(result).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">a</span>(<span class="string">&#x27;string&#x27;</span>); <span class="comment">// 交易签名</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证ETF确实被创建</span></span><br><span class="line">        <span class="keyword">const</span> [mintAddress] = <span class="title function_">deriveEtfTokenMintAccount</span>(<span class="built_in">symbol</span>);</span><br><span class="line">        <span class="keyword">const</span> mintInfo = <span class="keyword">await</span> connection.<span class="title function_">getAccountInfo</span>(mintAddress);</span><br><span class="line">        <span class="title function_">expect</span>(mintInfo).<span class="property">to</span>.<span class="property">not</span>.<span class="property">be</span>.<span class="property">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="常见问题和解决方案"><a href="#常见问题和解决方案" class="headerlink" title="常见问题和解决方案"></a>常见问题和解决方案</h2><h3 id="1-余额不足问题"><a href="#1-余额不足问题" class="headerlink" title="1. 余额不足问题"></a>1. 余额不足问题</h3><p><strong>问题</strong>：交易失败，提示”insufficient funds”</p>
<p><strong>解决方案</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">checkWalletBalance</span>(<span class="params"><span class="attr">wallet</span>: anchor.<span class="title class_">Wallet</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> balance = <span class="keyword">await</span> provider.<span class="property">connection</span>.<span class="title function_">getBalance</span>(wallet.<span class="property">payer</span>.<span class="property">publicKey</span>);</span><br><span class="line">    <span class="keyword">const</span> minRequired = <span class="number">0.1</span> * anchor.<span class="property">web3</span>.<span class="property">LAMPORTS_PER_SOL</span>; <span class="comment">// 0.1 SOL</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (balance &lt; minRequired) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">            <span class="string">`钱包余额不足! 当前余额: <span class="subst">$&#123;balance / anchor.web3.LAMPORTS_PER_SOL&#125;</span> SOL, `</span> +</span><br><span class="line">            <span class="string">`建议最少: <span class="subst">$&#123;minRequired / anchor.web3.LAMPORTS_PER_SOL&#125;</span> SOL`</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`✅ 钱包余额充足: <span class="subst">$&#123;balance / anchor.web3.LAMPORTS_PER_SOL&#125;</span> SOL`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-RPC限流问题"><a href="#2-RPC限流问题" class="headerlink" title="2. RPC限流问题"></a>2. RPC限流问题</h3><p><strong>问题</strong>：频繁调用时遇到429错误</p>
<p><strong>解决方案</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RateLimitedConnection</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">connection</span>: <span class="title class_">Connection</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">requestQueue</span>: <span class="title class_">Array</span>&lt;<span class="function">() =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&gt; = [];</span><br><span class="line">    <span class="keyword">private</span> processing = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> requestsPerSecond = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">endpoint</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">connection</span> = <span class="keyword">new</span> <span class="title class_">Connection</span>(endpoint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> execute&lt;T&gt;(<span class="attr">request</span>: <span class="function">() =&gt;</span> <span class="title class_">Promise</span>&lt;T&gt;): <span class="title class_">Promise</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">requestQueue</span>.<span class="title function_">push</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">request</span>();</span><br><span class="line">                    <span class="title function_">resolve</span>(result);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(error);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">processQueue</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">async</span> <span class="title function_">processQueue</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">processing</span> || <span class="variable language_">this</span>.<span class="property">requestQueue</span>.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">processing</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="variable language_">this</span>.<span class="property">requestQueue</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> request = <span class="variable language_">this</span>.<span class="property">requestQueue</span>.<span class="title function_">shift</span>()!;</span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">request</span>();</span><br><span class="line">            <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span> / <span class="variable language_">this</span>.<span class="property">requestsPerSecond</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">processing</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-网络错误处理"><a href="#3-网络错误处理" class="headerlink" title="3. 网络错误处理"></a>3. 网络错误处理</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> robustNetworkCall&lt;T&gt;(</span><br><span class="line">    <span class="attr">operation</span>: <span class="function">() =&gt;</span> <span class="title class_">Promise</span>&lt;T&gt;,</span><br><span class="line">    <span class="attr">maxRetries</span>: <span class="built_in">number</span> = <span class="number">3</span>,</span><br><span class="line">    <span class="attr">baseDelay</span>: <span class="built_in">number</span> = <span class="number">1000</span></span><br><span class="line">): <span class="title class_">Promise</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> attempt = <span class="number">1</span>; attempt &lt;= maxRetries; attempt++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">operation</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="keyword">const</span> isLastAttempt = attempt === maxRetries;</span><br><span class="line">            <span class="keyword">const</span> isNetworkError = error.<span class="property">message</span>.<span class="title function_">includes</span>(<span class="string">&#x27;fetch&#x27;</span>) || </span><br><span class="line">                                  error.<span class="property">message</span>.<span class="title function_">includes</span>(<span class="string">&#x27;network&#x27;</span>) ||</span><br><span class="line">                                  error.<span class="property">code</span> === <span class="string">&#x27;NETWORK_ERROR&#x27;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (isNetworkError &amp;&amp; !isLastAttempt) &#123;</span><br><span class="line">                <span class="keyword">const</span> delay = baseDelay * <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, attempt - <span class="number">1</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`🌐 网络错误，<span class="subst">$&#123;delay&#125;</span>ms后重试... (<span class="subst">$&#123;attempt&#125;</span>/<span class="subst">$&#123;maxRetries&#125;</span>)`</span>);</span><br><span class="line">                <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, delay));</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;不应该到达这里&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="性能优化建议"><a href="#性能优化建议" class="headerlink" title="性能优化建议"></a>性能优化建议</h2><h3 id="1-并行处理"><a href="#1-并行处理" class="headerlink" title="1. 并行处理"></a>1. 并行处理</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 串行处理（慢）</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createETFsSerially</span>(<span class="params"><span class="attr">configs</span>: <span class="title class_">ETFConfig</span>[]</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> results = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> config <span class="keyword">of</span> configs) &#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">createTokenMintAccount</span>(...);</span><br><span class="line">        results.<span class="title function_">push</span>(result);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> results;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 并行处理（快）</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createETFsParallel</span>(<span class="params"><span class="attr">configs</span>: <span class="title class_">ETFConfig</span>[]</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> promises = configs.<span class="title function_">map</span>(<span class="function"><span class="params">config</span> =&gt;</span> </span><br><span class="line">        <span class="title function_">createTokenMintAccount</span>(...)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">allSettled</span>(promises);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-缓存机制"><a href="#2-缓存机制" class="headerlink" title="2. 缓存机制"></a>2. 缓存机制</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ETFAddressCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> cache = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">PublicKey</span>&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getETFMintAddress</span>(<span class="attr">symbol</span>: <span class="built_in">string</span>): <span class="title class_">PublicKey</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">has</span>(<span class="built_in">symbol</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">get</span>(<span class="built_in">symbol</span>)!;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> [address] = <span class="title function_">deriveEtfTokenMintAccount</span>(<span class="built_in">symbol</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">set</span>(<span class="built_in">symbol</span>, address);</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addressCache = <span class="keyword">new</span> <span class="title class_">ETFAddressCache</span>();</span><br></pre></td></tr></table></figure>

<h3 id="3-批量RPC调用"><a href="#3-批量RPC调用" class="headerlink" title="3. 批量RPC调用"></a>3. 批量RPC调用</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">batchGetETFInfo</span>(<span class="params"><span class="attr">symbols</span>: <span class="built_in">string</span>[]</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> addresses = symbols.<span class="title function_">map</span>(<span class="function"><span class="params">symbol</span> =&gt;</span> </span><br><span class="line">        addressCache.<span class="title function_">getETFMintAddress</span>(<span class="built_in">symbol</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一次RPC调用获取多个账户信息</span></span><br><span class="line">    <span class="keyword">const</span> accountInfos = <span class="keyword">await</span> provider.<span class="property">connection</span>.<span class="title function_">getMultipleAccountsInfo</span>(addresses);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> symbols.<span class="title function_">map</span>(<span class="function">(<span class="params"><span class="built_in">symbol</span>, index</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="built_in">symbol</span>,</span><br><span class="line">        <span class="attr">address</span>: addresses[index],</span><br><span class="line">        <span class="attr">exists</span>: accountInfos[index] !== <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">data</span>: accountInfos[index]?.<span class="property">data</span></span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本教程详细介绍了Solana ETF代币创建指令的完整客户端调用流程，包括：</p>
<h3 id="🔧-技术栈掌握"><a href="#🔧-技术栈掌握" class="headerlink" title="🔧 技术栈掌握"></a>🔧 技术栈掌握</h3><ul>
<li><strong>Anchor框架</strong>：现代Solana开发的标准工具</li>
<li><strong>TypeScript</strong>：类型安全的JavaScript超集</li>
<li><strong>SPL Token</strong>：Solana的代币标准</li>
<li><strong>PDA机制</strong>：程序派生地址的应用</li>
</ul>
<h3 id="📚-核心概念理解"><a href="#📚-核心概念理解" class="headerlink" title="📚 核心概念理解"></a>📚 核心概念理解</h3><ul>
<li><strong>关联代币账户(ATA)</strong>：简化代币管理的标准化机制</li>
<li><strong>交易原子性</strong>：确保多指令操作的一致性</li>
<li><strong>元数据标准</strong>：与生态系统的互操作性</li>
</ul>
<h3 id="🛠️-实践技能培养"><a href="#🛠️-实践技能培养" class="headerlink" title="🛠️ 实践技能培养"></a>🛠️ 实践技能培养</h3><ul>
<li><strong>错误处理</strong>：优雅处理各种异常情况</li>
<li><strong>性能优化</strong>：合理使用并发和缓存</li>
<li><strong>调试技巧</strong>：快速定位和解决问题</li>
</ul>
<h3 id="🚀-扩展能力建设"><a href="#🚀-扩展能力建设" class="headerlink" title="🚀 扩展能力建设"></a>🚀 扩展能力建设</h3><ul>
<li><strong>模块化设计</strong>：便于维护和扩展的代码结构</li>
<li><strong>测试驱动</strong>：确保代码质量的测试策略</li>
<li><strong>生产就绪</strong>：满足实际应用需求的健壮性</li>
</ul>
<p>通过本教程的学习，你已经具备了在Solana上开发复杂DeFi产品的基础能力。ETF创建只是一个起点，你可以基于这些概念和技术进一步开发更高级的金融产品，如：</p>
<ul>
<li><strong>动态再平衡ETF</strong>：根据市场情况自动调整权重</li>
<li><strong>指数基金</strong>：跟踪特定指数的投资产品</li>
<li><strong>主题基金</strong>：围绕特定主题或行业的投资组合</li>
<li><strong>算法交易ETF</strong>：结合算法交易策略的智能基金</li>
</ul>
<p>继续探索Solana DeFi生态，你将发现更多有趣的可能性！</p>
<h2 id="附录：完整代码清单"><a href="#附录：完整代码清单" class="headerlink" title="附录：完整代码清单"></a>附录：完整代码清单</h2><h3 id="A-package-json依赖"><a href="#A-package-json依赖" class="headerlink" title="A. package.json依赖"></a>A. package.json依赖</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@coral-xyz/anchor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.29.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@solana/web3.js&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.87.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@solana/spl-token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.3.11&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@types/node&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^20.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;typescript&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ts-node&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^10.9.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;chai&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.3.7&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mocha&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^10.2.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="B-环境配置"><a href="#B-环境配置" class="headerlink" title="B. 环境配置"></a>B. 环境配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .env文件</span></span><br><span class="line">ANCHOR_PROVIDER_URL=https://api.devnet.solana.com</span><br><span class="line">ANCHOR_WALLET=~/.config/solana/id.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果使用自定义RPC</span></span><br><span class="line"><span class="comment"># ANCHOR_PROVIDER_URL=https://your-custom-rpc.com</span></span><br></pre></td></tr></table></figure>

<h3 id="C-TypeScript配置"><a href="#C-TypeScript配置" class="headerlink" title="C. TypeScript配置"></a>C. TypeScript配置</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ES2020&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;commonjs&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ES2020&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;outDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rootDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./src&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;forceConsistentCasingInFileNames&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/**/*&quot;</span><span class="punctuation">,</span> <span class="string">&quot;example/**/*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;node_modules&quot;</span><span class="punctuation">,</span> <span class="string">&quot;dist&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这份完整的指南为Solana ETF开发提供了从基础概念到高级实践的全方位覆盖，是入门到精通的理想学习资源。</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/09/20/Solana%E5%AE%9E%E6%88%98-ETF%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0/" rel="prev" title="Solana实战-ETF的介绍和创建指令实现">
                  <i class="fa fa-angle-left"></i> Solana实战-ETF的介绍和创建指令实现
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">samxie</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
